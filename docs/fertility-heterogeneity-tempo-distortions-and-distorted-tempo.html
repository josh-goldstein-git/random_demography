<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Fertility Heterogeneity: Tempo Distortions and Distorted Tempo | Mathematical Demography</title>
  <meta name="description" content="This is a book from the Mathematical Demography lecture notes." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Fertility Heterogeneity: Tempo Distortions and Distorted Tempo | Mathematical Demography" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a book from the Mathematical Demography lecture notes." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Fertility Heterogeneity: Tempo Distortions and Distorted Tempo | Mathematical Demography" />
  
  <meta name="twitter:description" content="This is a book from the Mathematical Demography lecture notes." />
  

<meta name="author" content="Josh R. Goldstein" />


<meta name="date" content="2020-12-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mortality-plateaus.html"/>
<link rel="next" href="fisher-wright.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Random Demography</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction to Demographic Heterogeneity</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#outline"><i class="fa fa-check"></i><b>2.1</b> Outline</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#part-i.-conceptual-introduction"><i class="fa fa-check"></i><b>2.2</b> Part I. Conceptual Introduction</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#what-is-demographic-heterogeneity"><i class="fa fa-check"></i><b>2.2.1</b> What is Demographic Heterogeneity?</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#analogies"><i class="fa fa-check"></i><b>2.2.2</b> Analogies</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#whats-new"><i class="fa fa-check"></i><b>2.2.3</b> What’s new?</a></li>
<li class="chapter" data-level="2.2.4" data-path="intro.html"><a href="intro.html#application"><i class="fa fa-check"></i><b>2.2.4</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#part-ii.-formal-analysis"><i class="fa fa-check"></i><b>2.3</b> Part II. Formal Analysis</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#outline-1"><i class="fa fa-check"></i><b>2.3.1</b> Outline</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro.html"><a href="intro.html#keyfitz-result"><i class="fa fa-check"></i><b>2.3.2</b> Keyfitz result</a></li>
<li class="chapter" data-level="2.3.3" data-path="intro.html"><a href="intro.html#us-mexico-example"><i class="fa fa-check"></i><b>2.3.3</b> US-Mexico Example</a></li>
<li class="chapter" data-level="2.3.4" data-path="intro.html"><a href="intro.html#the-origin-of-professor-wachters-poisson-exponential-model"><i class="fa fa-check"></i><b>2.3.4</b> The Origin of Professor Wachter’s Poisson-Exponential Model</a></li>
<li class="chapter" data-level="2.3.5" data-path="intro.html"><a href="intro.html#some-commentary"><i class="fa fa-check"></i><b>2.3.5</b> Some commentary</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#conclusions"><i class="fa fa-check"></i><b>2.4</b> Conclusions</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#questions"><i class="fa fa-check"></i><b>2.5</b> Questions</a></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#solutions"><i class="fa fa-check"></i><b>2.6</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="frailty.html"><a href="frailty.html"><i class="fa fa-check"></i><b>3</b> Multiplicative Fixed Frailty</a><ul>
<li class="chapter" data-level="3.1" data-path="frailty.html"><a href="frailty.html#outline-2"><i class="fa fa-check"></i><b>3.1</b> Outline</a><ul>
<li class="chapter" data-level="3.1.1" data-path="frailty.html"><a href="frailty.html#review-of-mortality-mathematics"><i class="fa fa-check"></i><b>3.1.1</b> Review of mortality mathematics</a></li>
<li class="chapter" data-level="3.1.2" data-path="frailty.html"><a href="frailty.html#application-what-is-ellx"><i class="fa fa-check"></i><b>3.1.2</b> Application: what is <span class="math inline">\(\ell&#39;(x)\)</span>?</a></li>
<li class="chapter" data-level="3.1.3" data-path="frailty.html"><a href="frailty.html#extending-keyfitz-to-mortality"><i class="fa fa-check"></i><b>3.1.3</b> Extending Keyfitz to mortality</a></li>
<li class="chapter" data-level="3.1.4" data-path="frailty.html"><a href="frailty.html#multiplicative-fixed-frailty"><i class="fa fa-check"></i><b>3.1.4</b> Multiplicative Fixed frailty</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="frailty.html"><a href="frailty.html#part-i.-results-from-fixed-frailty"><i class="fa fa-check"></i><b>3.2</b> Part I. Results from Fixed Frailty</a><ul>
<li class="chapter" data-level="3.2.1" data-path="frailty.html"><a href="frailty.html#a-simulation"><i class="fa fa-check"></i><b>3.2.1</b> A simulation</a></li>
<li class="chapter" data-level="3.2.2" data-path="frailty.html"><a href="frailty.html#lets-derive-pop-survival-note-bars-barell"><i class="fa fa-check"></i><b>3.2.2</b> Let’s derive pop survival (Note: <span class="math inline">\(\bar{s} = \bar{\ell}\)</span>)</a></li>
<li class="chapter" data-level="3.2.3" data-path="frailty.html"><a href="frailty.html#now-population-hazards-stepping-stones"><i class="fa fa-check"></i><b>3.2.3</b> Now population hazards (stepping stones)</a></li>
<li class="chapter" data-level="3.2.4" data-path="frailty.html"><a href="frailty.html#rodriguez-question"><i class="fa fa-check"></i><b>3.2.4</b> Rodriguez question</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="frailty.html"><a href="frailty.html#part-ii.-introduction-to-gamma-frailty"><i class="fa fa-check"></i><b>3.3</b> Part II. Introduction to Gamma Frailty</a><ul>
<li class="chapter" data-level="3.3.1" data-path="frailty.html"><a href="frailty.html#the-gamma-distribution"><i class="fa fa-check"></i><b>3.3.1</b> The Gamma distribution</a></li>
<li class="chapter" data-level="3.3.2" data-path="frailty.html"><a href="frailty.html#gamma-in-r"><i class="fa fa-check"></i><b>3.3.2</b> Gamma in R</a></li>
<li class="chapter" data-level="3.3.3" data-path="frailty.html"><a href="frailty.html#population-survival-of-gamma-frailty"><i class="fa fa-check"></i><b>3.3.3</b> Population Survival of Gamma Frailty</a></li>
<li class="chapter" data-level="3.3.4" data-path="frailty.html"><a href="frailty.html#interpreting-gamma-frailty-survival"><i class="fa fa-check"></i><b>3.3.4</b> Interpreting Gamma-frailty survival</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="frailty.html"><a href="frailty.html#conclusions-1"><i class="fa fa-check"></i><b>3.4</b> Conclusions</a></li>
<li class="chapter" data-level="3.5" data-path="frailty.html"><a href="frailty.html#questions-1"><i class="fa fa-check"></i><b>3.5</b> Questions</a></li>
<li class="chapter" data-level="3.6" data-path="frailty.html"><a href="frailty.html#solutions-1"><i class="fa fa-check"></i><b>3.6</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html"><i class="fa fa-check"></i><b>4</b> Gamma Frailty with Applications</a><ul>
<li class="chapter" data-level="4.1" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#from-survival-to-hazards"><i class="fa fa-check"></i><b>4.1</b> From survival to hazards</a><ul>
<li class="chapter" data-level="4.1.1" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#what-happens-to-frailty-of-survivors"><i class="fa fa-check"></i><b>4.1.1</b> What happens to frailty of survivors?</a></li>
<li class="chapter" data-level="4.1.2" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#average-frailty-in-terms-of-survival"><i class="fa fa-check"></i><b>4.1.2</b> Average frailty in terms of survival</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#censoc-selection-and-observed-frailty"><i class="fa fa-check"></i><b>4.2</b> CenSoc: Selection and observed frailty</a><ul>
<li class="chapter" data-level="4.2.1" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#data"><i class="fa fa-check"></i><b>4.2.1</b> Data</a></li>
<li class="chapter" data-level="4.2.2" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#estimation"><i class="fa fa-check"></i><b>4.2.2</b> Estimation</a></li>
<li class="chapter" data-level="4.2.3" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#discuss-our-conclusions-and-possible-future-directions-to-follow."><i class="fa fa-check"></i><b>4.2.3</b> Discuss our conclusions and possible future directions to follow.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#questions-2"><i class="fa fa-check"></i><b>4.3</b> Questions</a></li>
<li class="chapter" data-level="4.4" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#solutions-2"><i class="fa fa-check"></i><b>4.4</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html"><i class="fa fa-check"></i><b>5</b> Convergence and cross-overs</a><ul>
<li class="chapter" data-level="5.1" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#outline-3"><i class="fa fa-check"></i><b>5.1</b> Outline</a></li>
<li class="chapter" data-level="5.2" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#what-happens-to-mortality-disparities-at-older-ages"><i class="fa fa-check"></i><b>5.2</b> What happens to mortality disparities at older ages?</a><ul>
<li class="chapter" data-level="5.2.1" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#a-possible-null-model"><i class="fa fa-check"></i><b>5.2.1</b> A possible null-model</a></li>
<li class="chapter" data-level="5.2.2" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#a-result-5e---vaupel2014unobserved-eq-38"><i class="fa fa-check"></i><b>5.2.2</b> A result: (5E - <span class="citation">Vaupel and Missov (<span>2014</span>)</span> (Eq 38))</a></li>
<li class="chapter" data-level="5.2.3" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#inversion"><i class="fa fa-check"></i><b>5.2.3</b> Inversion</a></li>
<li class="chapter" data-level="5.2.4" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#an-example-1"><i class="fa fa-check"></i><b>5.2.4</b> An example</a></li>
<li class="chapter" data-level="5.2.5" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#application-1"><i class="fa fa-check"></i><b>5.2.5</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#student-presentation"><i class="fa fa-check"></i><b>5.3</b> Student Presentation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html"><i class="fa fa-check"></i><b>6</b> Mortality plateaus</a><ul>
<li class="chapter" data-level="6.1" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#outline-4"><i class="fa fa-check"></i><b>6.1</b> Outline</a></li>
<li class="chapter" data-level="6.2" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#heterogeneity-slows-mortality-improvement"><i class="fa fa-check"></i><b>6.2</b> Heterogeneity slows mortality improvement</a><ul>
<li class="chapter" data-level="6.2.1" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#an-example-2"><i class="fa fa-check"></i><b>6.2.1</b> An example</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#conclusions-2"><i class="fa fa-check"></i><b>6.3</b> Conclusions</a></li>
<li class="chapter" data-level="6.4" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#hazards-and-plateaus-by-professor-ken-wachter"><i class="fa fa-check"></i><b>6.4</b> Hazards and Plateaus by Professor Ken Wachter</a><ul>
<li class="chapter" data-level="6.4.1" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#outline-5"><i class="fa fa-check"></i><b>6.4.1</b> Outline</a></li>
<li class="chapter" data-level="6.4.2" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#extremes-of-longevity-in-humans-and-other-species"><i class="fa fa-check"></i><b>6.4.2</b> Extremes of Longevity in Humans and Other Species</a></li>
<li class="chapter" data-level="6.4.3" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#gamma-gompertz-fixed-frailty-hazards"><i class="fa fa-check"></i><b>6.4.3</b> Gamma-Gompertz Fixed Frailty Hazards</a></li>
<li class="chapter" data-level="6.4.4" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#less-restrictive-frailty-models"><i class="fa fa-check"></i><b>6.4.4</b> Less Restrictive Frailty Models</a></li>
<li class="chapter" data-level="6.4.5" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#mutation-accumulation-gompertz-hazards-with-plateaus"><i class="fa fa-check"></i><b>6.4.5</b> Mutation Accumulation, Gompertz Hazards with Plateaus</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#key-points"><i class="fa fa-check"></i><b>6.5</b> Key points</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><i class="fa fa-check"></i><b>7</b> Fertility Heterogeneity: Tempo Distortions and Distorted Tempo</a><ul>
<li class="chapter" data-level="7.1" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#outline-6"><i class="fa fa-check"></i><b>7.1</b> Outline</a></li>
<li class="chapter" data-level="7.2" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#introduction-1"><i class="fa fa-check"></i><b>7.2</b> Introduction</a><ul>
<li class="chapter" data-level="7.2.1" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#fertility-postponement-a-very-simple-example"><i class="fa fa-check"></i><b>7.2.1</b> Fertility postponement, a very simple example</a></li>
<li class="chapter" data-level="7.2.2" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#continuous-postponement-a-shiny-simulation"><i class="fa fa-check"></i><b>7.2.2</b> Continuous postponement, a shiny simulation</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#period-shifts-bongaarts-and-feeneys-model"><i class="fa fa-check"></i><b>7.3</b> Period Shifts: Bongaarts and Feeney’s model</a><ul>
<li class="chapter" data-level="7.3.1" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#a-derivation-due-to-rodriguez-note-not-sure-what-the-reference-is-here"><i class="fa fa-check"></i><b>7.3.1</b> A derivation: due to Rodriguez <em>NOTE: not sure what the reference is here</em></a></li>
<li class="chapter" data-level="7.3.2" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#tempo-adjusted-tfr"><i class="fa fa-check"></i><b>7.3.2</b> Tempo-adjusted TFR:</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#an-application-to-the-united-states"><i class="fa fa-check"></i><b>7.4</b> An Application to the United States</a><ul>
<li class="chapter" data-level="7.4.1" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#conclusions-3"><i class="fa fa-check"></i><b>7.4.1</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#two-americas"><i class="fa fa-check"></i><b>7.5</b> Two Americas</a><ul>
<li class="chapter" data-level="7.5.1" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#mixture"><i class="fa fa-check"></i><b>7.5.1</b> Mixture</a></li>
<li class="chapter" data-level="7.5.2" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#an-algorithm-for-tempo-adjustment-of-mixtures"><i class="fa fa-check"></i><b>7.5.2</b> An algorithm for tempo adjustment of mixtures</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#conclusions-4"><i class="fa fa-check"></i><b>7.6</b> Conclusions</a><ul>
<li class="chapter" data-level="7.6.1" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#caveats"><i class="fa fa-check"></i><b>7.6.1</b> Caveats</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#questions-3"><i class="fa fa-check"></i><b>7.7</b> Questions</a></li>
<li class="chapter" data-level="7.8" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#solutions-3"><i class="fa fa-check"></i><b>7.8</b> Solutions</a><ul>
<li class="chapter" data-level="7.8.1" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#what-is-a-bienayme-galton-watson-branching-process"><i class="fa fa-check"></i><b>7.8.1</b> What is a (Bienayme)-Galton-Watson branching process?</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#simulations-of-parents-having-children"><i class="fa fa-check"></i><b>7.9</b> Simulations of parents having children</a></li>
<li class="chapter" data-level="7.10" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#the-probability-generating-function-our-mathematical-tool"><i class="fa fa-check"></i><b>7.10</b> The Probability Generating Function: Our mathematical tool</a></li>
<li class="chapter" data-level="7.11" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#extinction"><i class="fa fa-check"></i><b>7.11</b> Extinction</a></li>
<li class="chapter" data-level="7.12" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#good-and-bad-set-ups-for-branching-process"><i class="fa fa-check"></i><b>7.12</b> Good and bad set-ups for branching process</a></li>
<li class="chapter" data-level="7.13" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#the-distribution-of-offspring-of-all-generations"><i class="fa fa-check"></i><b>7.13</b> The distribution of offspring of all generations</a><ul>
<li class="chapter" data-level="7.13.1" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#proving-mathbbe-z_n-mn"><i class="fa fa-check"></i><b>7.13.1</b> Proving <span class="math inline">\(\mathbb{E} Z_n = m^n\)</span></a></li>
<li class="chapter" data-level="7.13.2" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#variance-result."><i class="fa fa-check"></i><b>7.13.2</b> Variance result.</a></li>
</ul></li>
<li class="chapter" data-level="7.14" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#geometric-offspring-distribution"><i class="fa fa-check"></i><b>7.14</b> Geometric offspring distribution</a><ul>
<li class="chapter" data-level="7.14.1" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#the-geometric-distributions-simple-pgf"><i class="fa fa-check"></i><b>7.14.1</b> The Geometric Distribution’s simple PGF</a></li>
<li class="chapter" data-level="7.14.2" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#a-plot-of-keyfitzs-numbers-for-generations-1-2-and-3.-is-it-exponential-for-k-0"><i class="fa fa-check"></i><b>7.14.2</b> A plot of Keyfitz’s numbers for generations 1, 2, and 3. Is it exponential for <span class="math inline">\(k &gt; 0\)</span>?</a></li>
</ul></li>
<li class="chapter" data-level="7.15" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#branching-processes-and-covid-19"><i class="fa fa-check"></i><b>7.15</b> Branching Processes and Covid-19</a></li>
<li class="chapter" data-level="7.16" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#problems"><i class="fa fa-check"></i><b>7.16</b> Problems</a></li>
<li class="chapter" data-level="7.17" data-path="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#solutions-4"><i class="fa fa-check"></i><b>7.17</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="fisher-wright.html"><a href="fisher-wright.html"><i class="fa fa-check"></i><b>8</b> Fisher-Wright</a><ul>
<li class="chapter" data-level="8.1" data-path="fisher-wright.html"><a href="fisher-wright.html#outline-7"><i class="fa fa-check"></i><b>8.1</b> Outline</a></li>
<li class="chapter" data-level="8.2" data-path="fisher-wright.html"><a href="fisher-wright.html#parallel"><i class="fa fa-check"></i><b>8.2</b> Parallel</a><ul>
<li class="chapter" data-level="8.2.1" data-path="fisher-wright.html"><a href="fisher-wright.html#another-cell-phone-example"><i class="fa fa-check"></i><b>8.2.1</b> Another cell phone example</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="fisher-wright.html"><a href="fisher-wright.html#mutation"><i class="fa fa-check"></i><b>8.3</b> Mutation</a></li>
<li class="chapter" data-level="8.4" data-path="fisher-wright.html"><a href="fisher-wright.html#fixation"><i class="fa fa-check"></i><b>8.4</b> Fixation</a><ul>
<li class="chapter" data-level="8.4.1" data-path="fisher-wright.html"><a href="fisher-wright.html#probability-that-a-particular-line-will-fix"><i class="fa fa-check"></i><b>8.4.1</b> Probability that a particular line will “fix”</a></li>
<li class="chapter" data-level="8.4.2" data-path="fisher-wright.html"><a href="fisher-wright.html#expected-time-until-fixation"><i class="fa fa-check"></i><b>8.4.2</b> Expected time until fixation?</a></li>
<li class="chapter" data-level="8.4.3" data-path="fisher-wright.html"><a href="fisher-wright.html#path-to-fixation-a-measure-of-homogeneityheterogeneity"><i class="fa fa-check"></i><b>8.4.3</b> Path to fixation: a measure of homogeneity/heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="fisher-wright.html"><a href="fisher-wright.html#baby-names"><i class="fa fa-check"></i><b>8.5</b> Baby Names</a><ul>
<li class="chapter" data-level="8.5.1" data-path="fisher-wright.html"><a href="fisher-wright.html#basic-idea"><i class="fa fa-check"></i><b>8.5.1</b> Basic idea</a></li>
<li class="chapter" data-level="8.5.2" data-path="fisher-wright.html"><a href="fisher-wright.html#fisher-wright-simulation-of-baby-names-hahn-and-bentley"><i class="fa fa-check"></i><b>8.5.2</b> Fisher-Wright simulation of Baby Names (Hahn and Bentley)</a></li>
<li class="chapter" data-level="8.5.3" data-path="fisher-wright.html"><a href="fisher-wright.html#drawing-their-picture-with-simulation"><i class="fa fa-check"></i><b>8.5.3</b> Drawing their picture with simulation</a></li>
<li class="chapter" data-level="8.5.4" data-path="fisher-wright.html"><a href="fisher-wright.html#fw-babyname-simulation-of-equilibrium-frequencies"><i class="fa fa-check"></i><b>8.5.4</b> FW babyname simulation of equilibrium frequencies</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="fisher-wright.html"><a href="fisher-wright.html#now-we-can-simulate-babynames"><i class="fa fa-check"></i><b>8.6</b> Now we can simulate babynames</a></li>
<li class="chapter" data-level="8.7" data-path="fisher-wright.html"><a href="fisher-wright.html#conclusions-5"><i class="fa fa-check"></i><b>8.7</b> Conclusions</a><ul>
<li class="chapter" data-level="8.7.1" data-path="fisher-wright.html"><a href="fisher-wright.html#some-potential-criticism"><i class="fa fa-check"></i><b>8.7.1</b> Some potential criticism</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="coalescent.html"><a href="coalescent.html"><i class="fa fa-check"></i><b>9</b> Coalescent</a><ul>
<li class="chapter" data-level="9.1" data-path="coalescent.html"><a href="coalescent.html#outline-8"><i class="fa fa-check"></i><b>9.1</b> Outline</a></li>
<li class="chapter" data-level="9.2" data-path="coalescent.html"><a href="coalescent.html#the-coalescent-expectations-of-the-past"><i class="fa fa-check"></i><b>9.2</b> The Coalescent: Expectations of the Past</a></li>
<li class="chapter" data-level="9.3" data-path="coalescent.html"><a href="coalescent.html#our-first-question-when-was-mrca"><i class="fa fa-check"></i><b>9.3</b> Our first question: When was MRCA?</a></li>
<li class="chapter" data-level="9.4" data-path="coalescent.html"><a href="coalescent.html#mutation-and-inference-of-tmrca-and-n"><i class="fa fa-check"></i><b>9.4</b> Mutation and inference of TMRCA and <span class="math inline">\(N\)</span></a><ul>
<li class="chapter" data-level="9.4.1" data-path="coalescent.html"><a href="coalescent.html#inference-of-population-size-simulation"><i class="fa fa-check"></i><b>9.4.1</b> Inference of population size (Simulation)</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="coalescent.html"><a href="coalescent.html#coalescence-of-a-sample-of-n-individuals"><i class="fa fa-check"></i><b>9.5</b> Coalescence of a sample of <span class="math inline">\(n\)</span> individuals</a></li>
<li class="chapter" data-level="9.6" data-path="coalescent.html"><a href="coalescent.html#an-application-of-coalescent-theory"><i class="fa fa-check"></i><b>9.6</b> An application of coalescent theory</a><ul>
<li class="chapter" data-level="9.6.1" data-path="coalescent.html"><a href="coalescent.html#coalesence-when-population-is-changing"><i class="fa fa-check"></i><b>9.6.1</b> Coalesence when population is changing</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="coalescent.html"><a href="coalescent.html#reconstruction-ancient-european-population-sizes-using-batinis-sample-of-mitochondrial-dna"><i class="fa fa-check"></i><b>9.7</b> Reconstruction Ancient European Population Sizes using Batini’s sample of Mitochondrial DNA"</a><ul>
<li class="chapter" data-level="9.7.1" data-path="coalescent.html"><a href="coalescent.html#summary-of-batini-et-al."><i class="fa fa-check"></i><b>9.7.1</b> Summary of Batini et al.</a></li>
<li class="chapter" data-level="9.7.2" data-path="coalescent.html"><a href="coalescent.html#ancient-population-estimates"><i class="fa fa-check"></i><b>9.7.2</b> Ancient population estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="student-presentations.html"><a href="student-presentations.html"><i class="fa fa-check"></i><b>10</b> Student Presentations</a><ul>
<li class="chapter" data-level="10.1" data-path="student-presentations.html"><a href="student-presentations.html#mortality-crossovers"><i class="fa fa-check"></i><b>10.1</b> Mortality Crossovers</a><ul>
<li class="chapter" data-level="10.1.1" data-path="student-presentations.html"><a href="student-presentations.html#outline-9"><i class="fa fa-check"></i><b>10.1.1</b> Outline</a></li>
<li class="chapter" data-level="10.1.2" data-path="student-presentations.html"><a href="student-presentations.html#mortality-crossovers-reality-or-bad-data-coale1986mortality"><i class="fa fa-check"></i><b>10.1.2</b> <em>Mortality Crossovers: Reality or Bad Data?</em> <span class="citation">(Coale and Kisker <span>1986</span>)</span></a></li>
<li class="chapter" data-level="10.1.3" data-path="student-presentations.html"><a href="student-presentations.html#methods-for-evaluating-the-heterogeneity-of-aging-processes-in-human-populations-using-vital-statistics-data-explaining-the-blackwhite-mortality-crossover-by-a-model-of-mortality-selection-manton1981methods"><i class="fa fa-check"></i><b>10.1.3</b> <em>Methods for Evaluating the Heterogeneity of Aging Processes in Human Populations Using Vital Statistics Data: Explaining the Black/White Mortality Crossover by a Model of Mortality Selection</em> <span class="citation">(Manton and Stallard <span>1981</span>)</span></a></li>
<li class="chapter" data-level="10.1.4" data-path="student-presentations.html"><a href="student-presentations.html#censoc-mortality-crossovers"><i class="fa fa-check"></i><b>10.1.4</b> CenSoc Mortality Crossovers</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="student-presentations.html"><a href="student-presentations.html#plateaus"><i class="fa fa-check"></i><b>10.2</b> Plateaus</a></li>
<li class="chapter" data-level="10.3" data-path="student-presentations.html"><a href="student-presentations.html#rising-inequality"><i class="fa fa-check"></i><b>10.3</b> Rising Inequality</a><ul>
<li class="chapter" data-level="10.3.1" data-path="student-presentations.html"><a href="student-presentations.html#trends-in-mortality-differentials-and-life-expectancy-for-male-social-security-covered-workers-by-socioeconomic-status-waldron2007trends"><i class="fa fa-check"></i><b>10.3.1</b> <em>Trends in mortality differentials and life expectancy for male social security-covered workers, by socioeconomic status</em> <span class="citation">(Waldron <span>2007</span>)</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="demographic-theory-and-covid-19.html"><a href="demographic-theory-and-covid-19.html"><i class="fa fa-check"></i><b>11</b> Demographic theory and COVID-19</a><ul>
<li class="chapter" data-level="11.1" data-path="demographic-theory-and-covid-19.html"><a href="demographic-theory-and-covid-19.html#outline-10"><i class="fa fa-check"></i><b>11.1</b> Outline</a></li>
<li class="chapter" data-level="11.2" data-path="demographic-theory-and-covid-19.html"><a href="demographic-theory-and-covid-19.html#motivating-questions"><i class="fa fa-check"></i><b>11.2</b> Motivating questions</a></li>
<li class="chapter" data-level="11.3" data-path="demographic-theory-and-covid-19.html"><a href="demographic-theory-and-covid-19.html#population-aging"><i class="fa fa-check"></i><b>11.3</b> Population aging</a><ul>
<li class="chapter" data-level="11.3.1" data-path="demographic-theory-and-covid-19.html"><a href="demographic-theory-and-covid-19.html#stable-theory"><i class="fa fa-check"></i><b>11.3.1</b> Stable theory</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="demographic-theory-and-covid-19.html"><a href="demographic-theory-and-covid-19.html#keyfitzs-entropy"><i class="fa fa-check"></i><b>11.4</b> Keyfitz’s entropy</a></li>
<li class="chapter" data-level="11.5" data-path="demographic-theory-and-covid-19.html"><a href="demographic-theory-and-covid-19.html#loss-of-person-years-remaining"><i class="fa fa-check"></i><b>11.5</b> Loss of person years remaining</a></li>
<li class="chapter" data-level="11.6" data-path="demographic-theory-and-covid-19.html"><a href="demographic-theory-and-covid-19.html#stationary-theory"><i class="fa fa-check"></i><b>11.6</b> Stationary theory</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mathematical Demography</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fertility-heterogeneity-tempo-distortions-and-distorted-tempo" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Fertility Heterogeneity: Tempo Distortions and Distorted Tempo</h1>
<div id="outline-6" class="section level2">
<h2><span class="header-section-number">7.1</span> Outline</h2>
<ul>
<li>Introduction and a tempo simulation</li>
<li>Bongaarts and Feeney’s formula</li>
<li>An application to the United States</li>
<li>Two Americas?</li>
<li>EM algorithm for unmixing mixtures</li>
<li>An application to two Americas.</li>
</ul>
<p>Additional resources:</p>
<ul>
<li><span class="citation">Sullivan (<a href="#ref-sullivan2005age" role="doc-biblioref">2005</a>)</span>: An early paper (by a Berkeley Demog student!) focusing on ﬁrst birth hazards.</li>
<li><span class="citation">Burkimsher (<a href="#ref-burkimsher2017evolution" role="doc-biblioref">2017</a>)</span>: A descriptive paper, which you can mostly skip. But see especially section 7, where she argues that her ﬁndings contradict Sullivan for the United States.</li>
<li><span class="citation">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009elements" role="doc-biblioref">2009</a>)</span>: A textbook example of expectation-maximization algorithm applied to mixture of two normals in Section 8.5.</li>
<li>Victor Lavrenko. Youtube video : “EM algorithm: how it works” <a href="https://www.youtube.com/watch?v=REypj2sy_5U" class="uri">https://www.youtube.com/watch?v=REypj2sy_5U</a>.</li>
<li><span class="citation">Bongaarts and Feeney (<a href="#ref-bongaarts1998quantum" role="doc-biblioref">1998</a>)</span></li>
</ul>
</div>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">7.2</span> Introduction</h2>
<p>What we see is superficial. Heterogeneous models reveal what’s “really” going on. (Or do they?).</p>
<ul>
<li>Until the past sections, population hazards mislead.</li>
<li>However in this section, homogeneous fertility misleads.</li>
</ul>
<p>We now reverse perspectives:</p>
<ul>
<li>We see differences we see in genotypes, in lineages, in names.</li>
<li>These could be due to “real” differences (heterogeneity).</li>
<li>But they could also be due to luck: everyone is the same but stochastic outcomes differ.</li>
<li>Our models of individual-level randomness will have predicted dynamics, which are themselves interesting but can also be used as a “null” to compare to observations.</li>
</ul>
<div id="fertility-postponement-a-very-simple-example" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Fertility postponement, a very simple example</h3>
<p>Baseline</p>
<ul>
<li>A population has a history of 1 birth per day</li>
<li>When women turn age 25, they have a daughter.</li>
<li>This gives us a constant stream of births, 365 per year.</li>
</ul>
<p>Postponement</p>
<ul>
<li>Starting on Jan. 1, 2020, everyone postpones childbearing an additional month, until they are aged 25 1/12.</li>
<li>How many births will there be in 2020?</li>
<li>How many births in 2021?</li>
</ul>
<p>As everybody postpones childbearing for a month, then the first birth of 2020 occurs on February 1st so that 31 babies have not been born by then.</p>
<p>This means that during 2020 there are <span class="math inline">\(365-31=334\)</span> births. For this year, births and total fertility rate decrease. However, the postponement doesn’t affect the birth stream in 2021 as there will still be one birth per day, even if in the absence of postponing these some of the births should’ve occured in 2020.</p>
</div>
<div id="continuous-postponement-a-shiny-simulation" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Continuous postponement, a shiny simulation</h3>
<p>To answer these questions, we can use the following shiny app.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb107-1"></a>knitr<span class="op">::</span><span class="kw">include_url</span>(<span class="st">&#39;https://shiny.demog.berkeley.edu/josh/tempo/&#39;</span>, <span class="dt">height =</span> <span class="st">&#39;600px&#39;</span>)</span></code></pre></div>
<iframe src="https://shiny.demog.berkeley.edu/josh/tempo/" width="672" height="600px">
</iframe>
<ul>
<li><p><span class="math inline">\(R(t)\)</span> Cumulative postponment</p></li>
<li><p><span class="math inline">\(r(t)\)</span> Incremental postponement <span class="math inline">\(r(t) = R&#39;(t)\)</span></p>
<p>What is a formula for recovering original birth stream?
<span class="math display">\[\begin{align}
\hat{B}_{orig} &amp;= B_{obs} \times (1 + R&#39;(t)) \\
\text{or}\\
\hat{B}_{orig} &amp;= B_{obs} \times 1/  \left[1 - R&#39;(t)\right]?
\end{align}\]</span></p>
<p>Note: this idea of ``recovering original’’ is one way to think
about tempo adjustment.</p></li>
</ul>
<p>We can think of the original version as that which should have ocurred in the absence of postponement. Intuitively, it should be higher than the observed birth stream, but how much larger? The table below shows an example of how to recover the original births where each formula refers to the equations above.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb108-1"></a>  <span class="kw">library</span>(tidyverse)</span>
<span id="cb108-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb108-2"></a>  rt &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.4</span>,<span class="fl">0.1</span>)</span>
<span id="cb108-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb108-3"></a>  b_obs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">91</span>,<span class="dv">84</span>, <span class="dv">77</span>, <span class="dv">72</span> ) </span>
<span id="cb108-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb108-4"></a>  b_orig1 &lt;-<span class="st"> </span>b_obs<span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>rt)</span>
<span id="cb108-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb108-5"></a>  b_orig2 &lt;-<span class="st"> </span>b_obs<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>rt)</span>
<span id="cb108-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb108-6"></a>  b_orig &lt;-<span class="st"> </span><span class="kw">tibble</span>(rt,b_obs, b_orig1, b_orig2)</span>
<span id="cb108-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb108-7"></a>  <span class="kw">names</span>(b_orig) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;r(t)&quot;</span>,<span class="st">&quot;B(obs)&quot;</span>, <span class="st">&quot;B(orig) formula 1&quot;</span>, <span class="st">&quot;B(orig) formula 2&quot;</span>)</span>
<span id="cb108-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb108-8"></a>  knitr<span class="op">::</span><span class="kw">kable</span>(b_orig) <span class="op">%&gt;%</span></span>
<span id="cb108-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb108-9"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
r(t)
</th>
<th style="text-align:right;">
B(obs)
</th>
<th style="text-align:right;">
B(orig) formula 1
</th>
<th style="text-align:right;">
B(orig) formula 2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
100.1
</td>
<td style="text-align:right;">
101.1111
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
100.8
</td>
<td style="text-align:right;">
105.0000
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
77
</td>
<td style="text-align:right;">
100.1
</td>
<td style="text-align:right;">
110.0000
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
100.8
</td>
<td style="text-align:right;">
120.0000
</td>
</tr>
</tbody>
</table>
<p>The correct formula is equation 2. <strong>NOTE: is this correct? If so, why?</strong></p>
</div>
</div>
<div id="period-shifts-bongaarts-and-feeneys-model" class="section level2">
<h2><span class="header-section-number">7.3</span> Period Shifts: Bongaarts and Feeney’s model</h2>
<p>In a bigger microsimulation</p>
<ul>
<li>Each period will have births across a range of ages</li>
<li>We’ll randomly generate the original planned birthdays</li>
<li>Then we’ll shift by a continuous function <span class="math inline">\(R(t)\)</span>.</li>
</ul>
<p>The birth rate of women, <span class="math inline">\(f(a,t)\)</span>, aged <span class="math inline">\(a\)</span> in period <span class="math inline">\(t\)</span> is:
<span class="math display">\[
  f(a,t) = f_0(a - R(t)) (1- R&#39;(t)) q(t)
  \]</span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(f_0\)</span>: constant baseline schedule (can be normalized to sum to 1).</li>
<li><span class="math inline">\(q(t)\)</span>: period intensity parameter: “quantum”</li>
<li><span class="math inline">\(R(t)\)</span>: cumulative shift.</li>
</ul>
<p>An example</p>
<p><span class="math display">\[
f(a,t) = f_0(a - R(t)) (1- R&#39;(t)) q(t)
\]</span></p>
<ul>
<li><span class="math inline">\(R_{2019} = 3\)</span></li>
<li><span class="math inline">\(R&#39;_{2019} = 0.1\)</span></li>
<li><span class="math inline">\(q(2019) = 1\)</span></li>
</ul>
<p>Give an expression for <span class="math inline">\(f(28,2019)\)</span></p>
<p><span class="math display">\[ \begin{aligned} 
 f(28,2019) &amp;= f_{0}(28-3)\times(1-0.1)\times(1) \\
  &amp; = (0.9)f_{0}(25)
 \end{aligned}\]</span></p>
<p>Therefore, the fertility rate for a 28 year-old in 2019 would be 0.9 of the baseline fertility rate at age 25. Another way of thinking about it is that had there been no postponement, the fertility rate that we are observing in 2019 for this 28 year-old would actually be similar to that of a 25 year old.</p>
<p>Small changes in the stock can have huge effect in the flows.</p>
<div id="a-derivation-due-to-rodriguez-note-not-sure-what-the-reference-is-here" class="section level3">
<h3><span class="header-section-number">7.3.1</span> A derivation: due to Rodriguez <em>NOTE: not sure what the reference is here</em></h3>
<p>Assume no quantum effects (i.e, no <span class="math inline">\(q(t)\)</span>). Take a cohort with cumulative fertility</p>
<p><span class="math display">\[
  F_0(a) = \int_0^a f(x) \,dx
  \]</span></p>
<p>Now put in shifts so that observed fertility is from an age <span class="math inline">\(R(t)\)</span> years earlier. (“28” is the new “25”!)
<span class="math display">\[
  F(a,t) = F_0(a - R(t))  = F_0(a - R(c + a))
  \]</span></p>
<p>Differentiate with respect to age (which for a cohort is also time <span class="math inline">\(t\)</span>), using chain rule</p>
<p><span class="math display">\[ \begin{aligned}
  \frac{d }{dt}F(a,t)= f(a,t) &amp;= F&#39;_{0}(a-R(c+a))\times(1-R&#39;(c+a)) \\
  &amp;= f_0(a - R(t)) \left[1 - R&#39;(t)\right]
  \end{aligned}\]</span></p>
<p>Let’s re-notate our constant quantum result
<span class="math display">\[
  f_0(a,t | R(t) ) = f_0(a - R(t)) \left[1 - R&#39;(t)\right]
  \]</span>
Then we can incorporate period quantum on the shifted surface:
<span class="math display">\[
  f(a,t) = f_0(a,t | R(t) ) q(t) = f_0(a - R(t)) \left[1 - R&#39;(t)\right]q(t)
  \]</span></p>
<p>Note: If we vary quantum before shifts, then <span class="math inline">\(q(t)\)</span> will bleed into neighboring years. (a small effect, but makes model
messier). <strong>NOTE: I don’t understand this, could you explain Josh?</strong></p>
</div>
<div id="tempo-adjusted-tfr" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Tempo-adjusted TFR:</h3>
<ul>
<li><p>counter-factual</p></li>
<li><p>TFR in absence of timing changes</p>
<p><span class="math display">\[
TFR(t) = \int_0^\infty f(a,t) \, da
\]</span></p>
<p>Substituting our shifted birth rates with quantum
<span class="math display">\[
\begin{aligned}
TFR(t) &amp;= \int_0^\infty f_0(a - R(t)) \left[1 - R&#39;(t)\right]q(t) da \\
&amp;=\left[1 - R&#39;(t)\right]q(t) \int_0^\infty f_0(a - R(t))  da \\
&amp;= TFR_0 \left[1 - R&#39;(t)\right] q(t)\\
\end{aligned}
\]</span>
Without loss of generality, define <span class="math inline">\(TFR_0 = 1\)</span>, then</p>
<p><span class="math display">\[
q(t) =   \frac{TFR(t)} {1 - R&#39;(t)} \equiv TFR^*(t) 
\]</span>
The observed <span class="math inline">\(TFR(t)\)</span> deflated by the rate of change (<span class="math inline">\(1 - R&#39;(t)\)</span>) is the BF formula.</p></li>
</ul>
<p>How do period schedules change?</p>
<p><span class="math display">\[
  f(a,t) = f_0(a - R(t)) \left[1 - R&#39;(t)\right]q(t)
  \]</span></p>
<p>What is <span class="math inline">\({\partial \over \partial t} \log f(a,t)\)</span>?</p>
<p>Solving</p>
<p><span class="math display">\[
  \begin{aligned}
  {\partial \over \partial t} \log f(a,t) &amp; = \frac{d}{dt}log(f_{0}(a-R(t))) + \frac{d}{dt}log(1-R&#39;(t)) + \frac{d}{dt}log(q(t)) \\
  &amp; = \frac{-f&#39;_{0}(a-R(t)) R&#39;(t)}{f_{0}(a-R(t))} - \frac{R&#39;&#39;(t)}{1-R&#39;(t)}+ \frac{q&#39;(t)}{q(t)}
  \end{aligned}
  \]</span></p>
<p>If we sketch this, where the age is on the x-axis, then the last two components affect the intercept of the curve. If births are postponed, <span class="math inline">\(R&#39;(t)&gt;0\)</span> but if they are actually advanced then <span class="math inline">\(R&#39;(t)&lt;0\)</span>, which affects the slope, <span class="math inline">\(\frac{\partial}{\partial t}\log f(a,t)\)</span>.</p>
<p><strong>Uniform shifts</strong></p>
<ul>
<li>BF model assumes all ages shift by <span class="math inline">\(R(t)\)</span>.</li>
<li>BF model assumes all ages rise or fall by same quantum <span class="math inline">\(q(t)\)</span></li>
<li>Violating these assumptions means change in mean age will not just reflect “tempo”.</li>
<li>Example: What happens if people have fewer higher order births?</li>
</ul>
<p><strong>BF recommendation for achieving uniformity</strong></p>
<p>Separate estimates for each birth order, and then combine:
<span class="math display">\[
  TFR^*(t) = \sum_i TFR_i^*(t) = \sum_i {TFR_i(t) \over 1 - r_i(t)}
  \]</span></p>
<p>This will protect against order-specific quantum effects.</p>
</div>
</div>
<div id="an-application-to-the-united-states" class="section level2">
<h2><span class="header-section-number">7.4</span> An Application to the United States</h2>
<p>Tempo adjustment of US fertility using HFD data using Bongaarts-Feeney formula:</p>
<p><em>1. Read in data and format into an array.</em></p>
<p>Below we show the period fertility rates for all parities at each age for 1933 and 1934 of US women.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-1"></a><span class="kw">library</span>(data.table)</span>
<span id="cb109-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb109-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-3"></a><span class="kw">library</span>(knitr)</span>
<span id="cb109-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-4"></a></span>
<span id="cb109-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-5"></a><span class="kw">source</span>(<span class="st">&quot;https://raw.githubusercontent.com/josh-goldstein-git/random_demography/master/bookdown-master/codes/tempo_functions.R&quot;</span>)</span>
<span id="cb109-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-6"></a><span class="kw">source</span>(<span class="st">&quot;https://raw.githubusercontent.com/josh-goldstein-git/random_demography/master/bookdown-master/codes/utility_functions.R&quot;</span>)</span>
<span id="cb109-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-7"></a></span>
<span id="cb109-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-8"></a><span class="co">## age specific fertility rates by birth order for all countries and times</span></span>
<span id="cb109-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-9"></a><span class="co">## RR means &quot;rectangles&quot; on Lexis surface</span></span>
<span id="cb109-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-10"></a>dt &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;https://raw.githubusercontent.com/josh-goldstein-git/random_demography/master/bookdown-master/data/zip_w/asfrRRbo.txt&quot;</span>, <span class="dt">showProgress =</span> <span class="ot">FALSE</span>)</span>
<span id="cb109-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-11"></a></span>
<span id="cb109-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-12"></a>dt &lt;-<span class="st"> </span>dt[Code <span class="op">==</span><span class="st"> &quot;USA&quot;</span>] <span class="co">## keep only US</span></span>
<span id="cb109-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-13"></a>dt &lt;-<span class="st"> </span>dt[Age <span class="op">%in%</span><span class="st"> </span><span class="dv">15</span><span class="op">:</span><span class="dv">49</span>] <span class="co">## keep only ages 15 to 49</span></span>
<span id="cb109-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-14"></a></span>
<span id="cb109-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-15"></a><span class="co">## put all order fertility into a matrix</span></span>
<span id="cb109-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-16"></a>fat &lt;-<span class="st"> </span>dt[, <span class="kw">xtabs</span>(ASFR <span class="op">~</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Year)] <span class="co"># age (rows) by cohort year (column) matrix of ASFR</span></span>
<span id="cb109-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-17"></a>fat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">unclass</span>(fat)) </span>
<span id="cb109-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-18"></a>fat1 &lt;-<span class="st"> </span>dt[, <span class="kw">xtabs</span>(ASFR1 <span class="op">~</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Year)] <span class="co">#age specific fertility rates for parity = 1 </span></span>
<span id="cb109-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-19"></a>fat2 &lt;-<span class="st"> </span>dt[, <span class="kw">xtabs</span>(ASFR2 <span class="op">~</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Year)]</span>
<span id="cb109-20"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-20"></a>fat3 &lt;-<span class="st"> </span>dt[, <span class="kw">xtabs</span>(ASFR3 <span class="op">~</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Year)]</span>
<span id="cb109-21"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-21"></a>fat4 &lt;-<span class="st"> </span>dt[, <span class="kw">xtabs</span>(ASFR4 <span class="op">~</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Year)]</span>
<span id="cb109-22"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-22"></a>fat5p &lt;-<span class="st"> </span>dt[, <span class="kw">xtabs</span>(ASFR5p <span class="op">~</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Year)]</span>
<span id="cb109-23"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-23"></a>year.vec &lt;-<span class="st"> </span><span class="kw">colnames</span>(fat)</span>
<span id="cb109-24"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-24"></a>age.vec &lt;-<span class="st"> </span><span class="kw">rownames</span>(fat)</span>
<span id="cb109-25"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-25"></a>parity.vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;all&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb109-26"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-26"></a>fat.array &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>, <span class="dt">dim =</span> <span class="kw">c</span>(<span class="kw">nrow</span>(fat), <span class="kw">ncol</span>(fat), <span class="kw">length</span>(parity.vec)))</span>
<span id="cb109-27"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-27"></a><span class="kw">dimnames</span>(fat.array) &lt;-<span class="st"> </span><span class="kw">list</span>(age.vec, year.vec, parity.vec)</span>
<span id="cb109-28"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-28"></a>fat.array[,,<span class="st">&quot;all&quot;</span>] &lt;-<span class="st"> </span>fat</span>
<span id="cb109-29"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-29"></a>fat.array[,,<span class="st">&quot;1&quot;</span>] &lt;-<span class="st"> </span>fat1</span>
<span id="cb109-30"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-30"></a>fat.array[,,<span class="st">&quot;2&quot;</span>] &lt;-<span class="st"> </span>fat2</span>
<span id="cb109-31"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-31"></a>fat.array[,,<span class="st">&quot;3&quot;</span>] &lt;-<span class="st"> </span>fat3</span>
<span id="cb109-32"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-32"></a>fat.array[,,<span class="st">&quot;4&quot;</span>] &lt;-<span class="st"> </span>fat4</span>
<span id="cb109-33"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-33"></a>fat.array[,,<span class="st">&quot;5&quot;</span>] &lt;-<span class="st"> </span>fat5p</span>
<span id="cb109-34"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-34"></a></span>
<span id="cb109-35"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-35"></a><span class="kw">kable</span>(fat.array[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,<span class="st">&quot;all&quot;</span>], <span class="dt">caption=</span><span class="st">&quot;An extract of period age-specific fertility rates&quot;</span>)<span class="op">%&gt;%</span></span>
<span id="cb109-36"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb109-36"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F) </span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-81">Table 7.1: </span>An extract of period age-specific fertility rates
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
1933
</th>
<th style="text-align:right;">
1934
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
15
</td>
<td style="text-align:right;">
0.00672
</td>
<td style="text-align:right;">
0.00715
</td>
</tr>
<tr>
<td style="text-align:left;">
16
</td>
<td style="text-align:right;">
0.01875
</td>
<td style="text-align:right;">
0.01991
</td>
</tr>
<tr>
<td style="text-align:left;">
17
</td>
<td style="text-align:right;">
0.03846
</td>
<td style="text-align:right;">
0.04062
</td>
</tr>
<tr>
<td style="text-align:left;">
18
</td>
<td style="text-align:right;">
0.06586
</td>
<td style="text-align:right;">
0.06957
</td>
</tr>
<tr>
<td style="text-align:left;">
19
</td>
<td style="text-align:right;">
0.08719
</td>
<td style="text-align:right;">
0.09155
</td>
</tr>
<tr>
<td style="text-align:left;">
20
</td>
<td style="text-align:right;">
0.10136
</td>
<td style="text-align:right;">
0.10749
</td>
</tr>
<tr>
<td style="text-align:left;">
21
</td>
<td style="text-align:right;">
0.10639
</td>
<td style="text-align:right;">
0.11296
</td>
</tr>
<tr>
<td style="text-align:left;">
22
</td>
<td style="text-align:right;">
0.11349
</td>
<td style="text-align:right;">
0.11807
</td>
</tr>
<tr>
<td style="text-align:left;">
23
</td>
<td style="text-align:right;">
0.11785
</td>
<td style="text-align:right;">
0.12034
</td>
</tr>
<tr>
<td style="text-align:left;">
24
</td>
<td style="text-align:right;">
0.11476
</td>
<td style="text-align:right;">
0.12208
</td>
</tr>
<tr>
<td style="text-align:left;">
25
</td>
<td style="text-align:right;">
0.11388
</td>
<td style="text-align:right;">
0.11536
</td>
</tr>
<tr>
<td style="text-align:left;">
26
</td>
<td style="text-align:right;">
0.10873
</td>
<td style="text-align:right;">
0.11399
</td>
</tr>
<tr>
<td style="text-align:left;">
27
</td>
<td style="text-align:right;">
0.10118
</td>
<td style="text-align:right;">
0.10487
</td>
</tr>
<tr>
<td style="text-align:left;">
28
</td>
<td style="text-align:right;">
0.10283
</td>
<td style="text-align:right;">
0.10554
</td>
</tr>
<tr>
<td style="text-align:left;">
29
</td>
<td style="text-align:right;">
0.09094
</td>
<td style="text-align:right;">
0.09483
</td>
</tr>
<tr>
<td style="text-align:left;">
30
</td>
<td style="text-align:right;">
0.09009
</td>
<td style="text-align:right;">
0.09330
</td>
</tr>
<tr>
<td style="text-align:left;">
31
</td>
<td style="text-align:right;">
0.06941
</td>
<td style="text-align:right;">
0.07239
</td>
</tr>
<tr>
<td style="text-align:left;">
32
</td>
<td style="text-align:right;">
0.07813
</td>
<td style="text-align:right;">
0.07541
</td>
</tr>
<tr>
<td style="text-align:left;">
33
</td>
<td style="text-align:right;">
0.07614
</td>
<td style="text-align:right;">
0.06993
</td>
</tr>
<tr>
<td style="text-align:left;">
34
</td>
<td style="text-align:right;">
0.06013
</td>
<td style="text-align:right;">
0.07248
</td>
</tr>
<tr>
<td style="text-align:left;">
35
</td>
<td style="text-align:right;">
0.06009
</td>
<td style="text-align:right;">
0.05676
</td>
</tr>
<tr>
<td style="text-align:left;">
36
</td>
<td style="text-align:right;">
0.05416
</td>
<td style="text-align:right;">
0.05401
</td>
</tr>
<tr>
<td style="text-align:left;">
37
</td>
<td style="text-align:right;">
0.04748
</td>
<td style="text-align:right;">
0.04670
</td>
</tr>
<tr>
<td style="text-align:left;">
38
</td>
<td style="text-align:right;">
0.04755
</td>
<td style="text-align:right;">
0.04769
</td>
</tr>
<tr>
<td style="text-align:left;">
39
</td>
<td style="text-align:right;">
0.03724
</td>
<td style="text-align:right;">
0.03752
</td>
</tr>
<tr>
<td style="text-align:left;">
40
</td>
<td style="text-align:right;">
0.03078
</td>
<td style="text-align:right;">
0.03024
</td>
</tr>
<tr>
<td style="text-align:left;">
41
</td>
<td style="text-align:right;">
0.01967
</td>
<td style="text-align:right;">
0.01963
</td>
</tr>
<tr>
<td style="text-align:left;">
42
</td>
<td style="text-align:right;">
0.01877
</td>
<td style="text-align:right;">
0.01874
</td>
</tr>
<tr>
<td style="text-align:left;">
43
</td>
<td style="text-align:right;">
0.01283
</td>
<td style="text-align:right;">
0.01235
</td>
</tr>
<tr>
<td style="text-align:left;">
44
</td>
<td style="text-align:right;">
0.00808
</td>
<td style="text-align:right;">
0.00789
</td>
</tr>
<tr>
<td style="text-align:left;">
45
</td>
<td style="text-align:right;">
0.00526
</td>
<td style="text-align:right;">
0.00491
</td>
</tr>
<tr>
<td style="text-align:left;">
46
</td>
<td style="text-align:right;">
0.00245
</td>
<td style="text-align:right;">
0.00242
</td>
</tr>
<tr>
<td style="text-align:left;">
47
</td>
<td style="text-align:right;">
0.00127
</td>
<td style="text-align:right;">
0.00122
</td>
</tr>
<tr>
<td style="text-align:left;">
48
</td>
<td style="text-align:right;">
0.00081
</td>
<td style="text-align:right;">
0.00087
</td>
</tr>
<tr>
<td style="text-align:left;">
49
</td>
<td style="text-align:right;">
0.00037
</td>
<td style="text-align:right;">
0.00037
</td>
</tr>
</tbody>
</table>
<p><em>2. Fit bongaarts feeney without birth order</em></p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb110-1"></a>tfr.vec &lt;-<span class="st"> </span><span class="kw">colSums</span>(fat)          <span class="co"># total fertility rate for each cohort</span></span>
<span id="cb110-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb110-2"></a>mu.vec &lt;-<span class="st"> </span><span class="kw">apply</span>(fat, <span class="dv">2</span>, get.mean) <span class="co"># mean age at childbearing</span></span>
<span id="cb110-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb110-3"></a>rt.vec &lt;-<span class="st"> </span><span class="kw">center.diff</span>(mu.vec)     <span class="co"># increments of postponement</span></span>
<span id="cb110-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb110-4"></a>adj.tfr.vec &lt;-<span class="st"> </span>tfr.vec <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rt.vec) <span class="co"># Assuming no quantum effect, tempo-adjusted TFR</span></span></code></pre></div>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb111-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb111-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb111-2"></a><span class="kw">plot</span>(<span class="kw">names</span>(mu.vec), mu.vec, <span class="dt">xlab =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean age of childbearing&quot;</span>)</span>
<span id="cb111-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb111-3"></a><span class="kw">plot</span>(<span class="kw">names</span>(mu.vec), rt.vec, <span class="dt">xlab =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">ylab=</span> <span class="st">&quot;Shifts&quot;</span>)</span>
<span id="cb111-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb111-4"></a><span class="kw">abline</span>(<span class="dt">h =</span><span class="dv">0</span>)</span>
<span id="cb111-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb111-5"></a><span class="kw">plot</span>(year.vec, tfr.vec, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">ylab=</span> <span class="st">&quot;TFR&quot;</span>)</span>
<span id="cb111-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb111-6"></a><span class="kw">lines</span>(year.vec, adj.tfr.vec, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb111-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb111-7"></a><span class="kw">abline</span>(<span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">1945</span>, <span class="dv">2008</span>))</span>
<span id="cb111-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb111-8"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;Observed TFR&quot;</span>, <span class="st">&quot;Tempo-adjusted TFR&quot;</span>), <span class="dt">lty=</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-83"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-83-1.png" alt="Adjusted TFR" width="672" />
<p class="caption">
Figure 7.1: Adjusted TFR
</p>
</div>
<ul>
<li>We see fertility since 1980 has been depressed by postponment</li>
<li>We see weird dynamics around end of WW2 and great recession.</li>
<li>What’s going on? Here is a closeup</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-84"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-84-1.png" alt="Observed and tempo-adjusted TFRs" width="672" />
<p class="caption">
Figure 7.2: Observed and tempo-adjusted TFRs
</p>
</div>
<ul>
<li>Now let’s look at turbulence around WWII</li>
</ul>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb112-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-2"></a><span class="kw">plot</span>(age.vec, fat[,<span class="st">&quot;1944&quot;</span>], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.23</span>),</span>
<span id="cb112-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-3"></a>     <span class="dt">ylab =</span> <span class="st">&quot;f(a)&quot;</span>,</span>
<span id="cb112-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-4"></a>     <span class="dt">xlab =</span> <span class="st">&quot;age a&quot;</span>)</span>
<span id="cb112-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-5"></a><span class="kw">lines</span>(age.vec, fat[,<span class="st">&quot;1945&quot;</span>], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb112-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-6"></a><span class="kw">lines</span>(age.vec, fat[,<span class="st">&quot;1946&quot;</span>], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">col =</span> <span class="st">&#39;orange&#39;</span>)</span>
<span id="cb112-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-7"></a><span class="kw">lines</span>(age.vec, fat[,<span class="st">&quot;1947&quot;</span>], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb112-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-8"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>,</span>
<span id="cb112-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-9"></a>       <span class="dt">legend =</span> <span class="dv">1944</span><span class="op">:</span><span class="dv">1947</span>,</span>
<span id="cb112-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-10"></a>       <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb112-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-11"></a>       <span class="dt">lty =</span> <span class="dv">1</span>)</span>
<span id="cb112-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-12"></a><span class="kw">title</span>(<span class="st">&quot;Age specific fertility&quot;</span>)</span>
<span id="cb112-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-13"></a></span>
<span id="cb112-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-14"></a><span class="kw">plot</span>(<span class="dv">1943</span><span class="op">:</span><span class="dv">1947</span>, mu.vec[<span class="kw">paste</span>(<span class="dv">1943</span><span class="op">:</span><span class="dv">1947</span>)],</span>
<span id="cb112-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-15"></a>     <span class="dt">ylab =</span> <span class="st">&quot;mu(t)&quot;</span>,</span>
<span id="cb112-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-16"></a>     <span class="dt">xlab =</span> <span class="st">&quot;t&quot;</span>,</span>
<span id="cb112-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-17"></a>     <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb112-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-18"></a>     <span class="dt">pch =</span> <span class="dv">19</span>)</span>
<span id="cb112-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-19"></a><span class="kw">title</span>(<span class="st">&quot;Mean ages&quot;</span>)</span>
<span id="cb112-20"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-20"></a></span>
<span id="cb112-21"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-21"></a><span class="kw">plot</span>(<span class="dv">1943</span><span class="op">:</span><span class="dv">1947</span>, rt.vec[<span class="kw">paste</span>(<span class="dv">1943</span><span class="op">:</span><span class="dv">1947</span>)],</span>
<span id="cb112-22"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-22"></a>     <span class="dt">ylab =</span> <span class="st">&quot;r(t)&quot;</span>,</span>
<span id="cb112-23"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-23"></a>     <span class="dt">xlab =</span> <span class="st">&quot;t&quot;</span>,</span>
<span id="cb112-24"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-24"></a>     <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb112-25"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-25"></a>     <span class="dt">pch =</span> <span class="dv">19</span>)</span>
<span id="cb112-26"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-26"></a><span class="kw">title</span>(<span class="st">&quot;Changes in mean, centered&quot;</span>)</span>
<span id="cb112-27"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-27"></a></span>
<span id="cb112-28"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-28"></a><span class="kw">plot</span>(<span class="dv">1943</span><span class="op">:</span><span class="dv">1947</span>, tfr.vec[<span class="kw">paste</span>(<span class="dv">1943</span><span class="op">:</span><span class="dv">1947</span>)],</span>
<span id="cb112-29"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-29"></a>     <span class="dt">ylab =</span> <span class="st">&quot;tfr&quot;</span>,</span>
<span id="cb112-30"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-30"></a>     <span class="dt">xlab =</span> <span class="st">&quot;t&quot;</span>,</span>
<span id="cb112-31"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-31"></a>     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb112-32"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-32"></a>     <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="cb112-33"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-33"></a><span class="kw">lines</span>(<span class="dv">1943</span><span class="op">:</span><span class="dv">1947</span>, adj.tfr.vec[<span class="kw">paste</span>(<span class="dv">1943</span><span class="op">:</span><span class="dv">1947</span>)],</span>
<span id="cb112-34"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-34"></a>      <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb112-35"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-35"></a><span class="kw">title</span>(<span class="st">&quot;TFR and adjTFR&quot;</span>)</span>
<span id="cb112-36"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb112-36"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;Observed TFR&quot;</span>, <span class="st">&quot;Tempo-adjusted TFR&quot;</span>), <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-85"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-85-1.png" alt="Change in fertility rates around WWII" width="672" />
<p class="caption">
Figure 7.3: Change in fertility rates around WWII
</p>
</div>
<ul>
<li>From 1945 to 1946, fertility goes up a lot, but more at younger ages. So mean goes down. BF adjustment over-compensates, and has quantum declining.</li>
</ul>
<p>What’s happening from 1944-45?</p>
<p><em>3. Fit bongaarts feeney with birth order</em></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb113-1"></a>out &lt;-<span class="st"> </span><span class="kw">bf.fit</span>(fat.array)  <span class="co">#function to obtain BF tempo-adjusted TFR</span></span>
<span id="cb113-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb113-2"></a>adj.tfr.bo.vec &lt;-<span class="st">  </span>out<span class="op">$</span>tfr.star.out[, <span class="st">&quot;bf.tfr.star&quot;</span>] <span class="co"># sum of parity specific tempo-adjusted TFRs</span></span></code></pre></div>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb114-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb114-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb114-2"></a><span class="kw">plot</span>(year.vec, tfr.vec, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">xlab=</span><span class="st">&quot;Year&quot;</span>, <span class="dt">ylab=</span> <span class="st">&quot;TFR&quot;</span>)</span>
<span id="cb114-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb114-3"></a><span class="kw">lines</span>(year.vec, adj.tfr.vec, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb114-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb114-4"></a><span class="kw">lines</span>(year.vec, adj.tfr.bo.vec, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb114-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb114-5"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>,</span>
<span id="cb114-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb114-6"></a>       <span class="kw">c</span>(<span class="st">&quot;tfr&quot;</span>, <span class="st">&quot;tfr* (all parities)&quot;</span>, <span class="st">&quot;tfr* (sum of parities)&quot;</span>),</span>
<span id="cb114-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb114-7"></a>       <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>),</span>
<span id="cb114-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb114-8"></a>       <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb114-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb114-9"></a>       <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-87"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-87-1.png" alt="TFR by parities" width="672" />
<p class="caption">
Figure 7.4: TFR by parities
</p>
</div>
<p><em>4. Use HFD data to verify adjusted TFR.</em></p>
<p>HFD uses a tempo-adjusted TFR that is the sum of the parity specific adjusted BF TFR.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb115-1"></a><span class="co">## let&#39;s check against hfd</span></span>
<span id="cb115-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb115-2"></a>hfd.adj.dt &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;https://raw.githubusercontent.com/josh-goldstein-git/random_demography/master/bookdown-master/data/zip_w/adjtfrRR.txt&quot;</span>, <span class="dt">showProgress =</span> <span class="ot">FALSE</span>, <span class="dt">skip =</span> <span class="dv">2</span>)</span>
<span id="cb115-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb115-3"></a>hfd.adj.dt &lt;-<span class="st"> </span>hfd.adj.dt[Code <span class="op">==</span><span class="st"> &quot;USA&quot;</span>]</span></code></pre></div>
<p>We find that:</p>
<ul>
<li>Taking birth order into account smooths out WW2 turbulence (large fluctuations) but increases the variation during the Great Recession.<br />
</li>
<li>The baby boom appears to initially be even greater than observed when we take into account birth order, but then it fall more than observed.</li>
<li>Finally, the baby bust was not as bad as it seemed.</li>
</ul>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb116-1"></a><span class="kw">plot</span>(year.vec, tfr.vec, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">xlab=</span><span class="st">&quot;Year&quot;</span>, <span class="dt">ylab=</span> <span class="st">&quot;TFR&quot;</span>)</span>
<span id="cb116-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb116-2"></a><span class="kw">lines</span>(year.vec, adj.tfr.vec, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb116-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb116-3"></a><span class="kw">lines</span>(year.vec, adj.tfr.bo.vec, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb116-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb116-4"></a><span class="kw">lines</span>(hfd.adj.dt<span class="op">$</span>Year, hfd.adj.dt<span class="op">$</span>adjTFR, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb116-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb116-5"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>,</span>
<span id="cb116-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb116-6"></a>       <span class="kw">c</span>(<span class="st">&quot;tfr&quot;</span>, <span class="st">&quot;tfr* (all parities)&quot;</span>, <span class="st">&quot;tfr* (sum of parities)&quot;</span>, <span class="st">&quot;HFD adj TFR&quot;</span>),</span>
<span id="cb116-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb116-7"></a>       <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb116-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb116-8"></a>       <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb116-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb116-9"></a>       <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-89"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-89-1.png" alt="TFR by parities using HFD data" width="672" />
<p class="caption">
Figure 7.5: TFR by parities using HFD data
</p>
</div>
<div id="conclusions-3" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Conclusions</h3>
<ul>
<li>Baby boom smaller if we account for “pre-ponement”.<br />
</li>
<li>Fertility lull in 1970s and 80s disappears if we account for
“postponement”.</li>
<li>Birth order disaggregation improves estimates of shifts from
changes in mean age</li>
<li>What happened with the recession?</li>
</ul>
</div>
</div>
<div id="two-americas" class="section level2">
<h2><span class="header-section-number">7.5</span> Two Americas</h2>
<p>Let’s look at births (all orders). Here we have some animations of the ASFR over time.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-1"></a>my.year.vec &lt;-<span class="st"> </span><span class="dv">1975</span><span class="op">:</span><span class="dv">2017</span></span>
<span id="cb117-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-2"></a><span class="co"># library(devtools)</span></span>
<span id="cb117-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-3"></a><span class="co"># install_github(&quot;dgrtwo/gganimate&quot;)</span></span>
<span id="cb117-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-4"></a><span class="co"># install.packages(&quot;transformr&quot;)</span></span>
<span id="cb117-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-5"></a><span class="co"># install.packages(&quot;animation&quot;)</span></span>
<span id="cb117-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-6"></a><span class="kw">library</span>(gganimate)</span>
<span id="cb117-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-7"></a><span class="kw">library</span>(data.table)</span>
<span id="cb117-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-8"></a><span class="kw">library</span>(mixtools)</span>
<span id="cb117-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-9"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb117-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-10"></a></span>
<span id="cb117-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-11"></a><span class="kw">source</span>(<span class="st">&quot;https://raw.githubusercontent.com/josh-goldstein-git/random_demography/master/bookdown-master/codes/tempo_mixed_functions.R&quot;</span>)</span>
<span id="cb117-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-12"></a><span class="kw">source</span>(<span class="st">&quot;https://raw.githubusercontent.com/josh-goldstein-git/random_demography/master/bookdown-master/codes/tempo_functions.R&quot;</span>)</span>
<span id="cb117-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-13"></a></span>
<span id="cb117-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-14"></a><span class="co"># plot1 &lt;- ggplot(data=dt[Year %in% my.year.vec,2:4], aes(x=Age, y= ASFR)) + </span></span>
<span id="cb117-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-15"></a><span class="co">#   geom_line(aes(group=Year))+</span></span>
<span id="cb117-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-16"></a><span class="co">#   transition_time(Year)+</span></span>
<span id="cb117-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-17"></a><span class="co">#   labs(title = &quot;Year: {frame_time}&quot;)</span></span>
<span id="cb117-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-18"></a></span>
<span id="cb117-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb117-19"></a><span class="co"># anim_save(&quot;plot1.gif&quot;, plot1)</span></span></code></pre></div>
<p><img src="plot1.gif" /></p>
<p>During the earlier years, the mean childbearing age seems to be in the early 20s. However with time, the AFR seems to become bimodal. So what is happening here? Are there two underlying groups of women that experience different fertility rates. Now fit mixing model and redo the animation.</p>
<p><strong>NOTE: Not sure of all the lines in this mixture code. Josh, could you add some notes please?</strong></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-1"></a><span class="co">## takes few minutes to run</span></span>
<span id="cb118-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-2"></a>my.fat &lt;-<span class="st"> </span>fat[, <span class="kw">paste</span>(my.year.vec)]</span>
<span id="cb118-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-3"></a>out &lt;-<span class="st"> </span><span class="kw">get.mixed.tfr.star</span>(my.fat)</span>
<span id="cb118-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-4"></a><span class="co">##</span></span>
<span id="cb118-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-5"></a>out.all &lt;-<span class="st"> </span>out</span>
<span id="cb118-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-6"></a></span>
<span id="cb118-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-7"></a><span class="co">#Mixture simulation </span></span>
<span id="cb118-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-8"></a><span class="cf">if</span> (<span class="dv">0</span>) {</span>
<span id="cb118-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-9"></a>mu.mat &lt;-<span class="st"> </span><span class="kw">get.coefs.mixed</span>(out.all<span class="op">$</span>fert.fit.list.variable.sigma)<span class="op">$</span>mu.mat</span>
<span id="cb118-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-10"></a>lambda.mat &lt;-<span class="st"> </span><span class="kw">get.coefs.mixed</span>(out.all<span class="op">$</span>fert.fit.list.variable.sigma)<span class="op">$</span>lambda.mat</span>
<span id="cb118-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-11"></a>sigma.mat &lt;-<span class="st"> </span><span class="kw">get.coefs.mixed</span>(out.all<span class="op">$</span>fert.fit.list.variable.sigma)<span class="op">$</span>sigma.mat</span>
<span id="cb118-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-12"></a>}</span>
<span id="cb118-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-13"></a>mu.mat &lt;-<span class="st"> </span><span class="kw">get.coefs.mixed</span>(out.all<span class="op">$</span>fert.fit.list)<span class="op">$</span>mu.mat</span>
<span id="cb118-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-14"></a>lambda.mat &lt;-<span class="st"> </span><span class="kw">get.coefs.mixed</span>(out.all<span class="op">$</span>fert.fit.list)<span class="op">$</span>lambda.mat</span>
<span id="cb118-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-15"></a>sigma.mat &lt;-<span class="st"> </span><span class="kw">get.coefs.mixed</span>(out.all<span class="op">$</span>fert.fit.list)<span class="op">$</span>sigma.ma</span>
<span id="cb118-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-16"></a></span>
<span id="cb118-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-17"></a><span class="co">#Temporary comment out until we figure out what these graphs actually are</span></span>
<span id="cb118-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-18"></a><span class="co"># matplot(my.year.vec, t(mu.mat))</span></span>
<span id="cb118-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-19"></a><span class="co"># abline(v = 2015)## problem here</span></span>
<span id="cb118-20"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-20"></a><span class="co"># points(c(2015, 2015), c(21.5, 30.3))</span></span>
<span id="cb118-21"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-21"></a><span class="co"># </span></span>
<span id="cb118-22"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-22"></a><span class="co"># matplot(my.year.vec, t(lambda.mat))</span></span>
<span id="cb118-23"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-23"></a><span class="co"># abline(v = 2015)## problem here</span></span>
<span id="cb118-24"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-24"></a><span class="co"># points(c(2015, 2015), c(21.5, 30.3))</span></span>
<span id="cb118-25"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-25"></a></span>
<span id="cb118-26"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-26"></a><span class="co">## interpolate 1915</span></span>
<span id="cb118-27"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-27"></a></span>
<span id="cb118-28"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-28"></a><span class="kw">colnames</span>(lambda.mat) &lt;-<span class="st"> </span>my.year.vec</span>
<span id="cb118-29"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-29"></a><span class="kw">colnames</span>(mu.mat) &lt;-<span class="st"> </span>my.year.vec</span>
<span id="cb118-30"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-30"></a>lambda.mat[,<span class="st">&quot;2015&quot;</span>] &lt;-<span class="st"> </span>(lambda.mat[,<span class="st">&quot;2014&quot;</span>] <span class="op">+</span><span class="st"> </span>lambda.mat[,<span class="st">&quot;2016&quot;</span>])<span class="op">/</span><span class="dv">2</span></span>
<span id="cb118-31"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb118-31"></a>mu.mat[,<span class="st">&quot;2015&quot;</span>]     &lt;-<span class="st"> </span>(mu.mat[,<span class="st">&quot;2014&quot;</span>]     <span class="op">+</span><span class="st"> </span>mu.mat[,<span class="st">&quot;2016&quot;</span>])<span class="op">/</span><span class="dv">2</span></span></code></pre></div>
<p>Now we create the animation with the normal distributions inside as well as the observed ASFR.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-1"></a><span class="co"># Obtaining different ASFRs per group (1 and 2)</span></span>
<span id="cb119-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-2"></a>my.dt &lt;-<span class="st"> </span>dt[Year <span class="op">%in%</span><span class="st"> </span>my.year.vec,]</span>
<span id="cb119-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-3"></a></span>
<span id="cb119-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(my.year.vec)){</span>
<span id="cb119-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-5"></a>    my.year &lt;-<span class="st"> </span>my.year.vec[i]</span>
<span id="cb119-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-6"></a>    year.vec &lt;-<span class="st"> </span><span class="kw">colnames</span>(my.fat)</span>
<span id="cb119-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-7"></a>    fx &lt;-<span class="st"> </span>my.fat[,<span class="kw">paste</span>(my.year)]</span>
<span id="cb119-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-8"></a>    <span class="co"># fx &lt;- fx/sum(fx)</span></span>
<span id="cb119-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-9"></a>    x &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">names</span>(fx))</span>
<span id="cb119-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-10"></a>    <span class="co">## par(mfrow = c(1,1))</span></span>
<span id="cb119-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-11"></a>    <span class="co"># plot(x, fx,</span></span>
<span id="cb119-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-12"></a>    <span class="co">#      ylim = c(0, .3),</span></span>
<span id="cb119-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-13"></a>    <span class="co">#      ylab = &quot;normalized fx&quot;)</span></span>
<span id="cb119-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-14"></a>    s &lt;-<span class="st"> </span>year.vec <span class="op">==</span><span class="st"> </span>my.year</span>
<span id="cb119-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-15"></a>    this.tfr &lt;-<span class="st"> </span><span class="kw">sum</span>(fx)</span>
<span id="cb119-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-16"></a>    fx1.hat &lt;-<span class="st"> </span><span class="kw">dnorm</span>(x, <span class="dt">mean =</span> mu.mat[<span class="dv">1</span>,s], <span class="dt">sd =</span> sigma.mat[<span class="dv">1</span>,s]) <span class="op">*</span></span>
<span id="cb119-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-17"></a><span class="st">        </span>lambda.mat[<span class="dv">1</span>,s]<span class="op">*</span><span class="st"> </span>this.tfr</span>
<span id="cb119-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-18"></a>    <span class="co"># lines(x, fx1.hat, col = &quot;red&quot;)</span></span>
<span id="cb119-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-19"></a>    fx2.hat &lt;-<span class="st"> </span><span class="kw">dnorm</span>(x, <span class="dt">mean =</span> mu.mat[<span class="dv">2</span>,s], <span class="dt">sd =</span> sigma.mat[<span class="dv">2</span>,s]) <span class="op">*</span></span>
<span id="cb119-20"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-20"></a><span class="st">        </span>lambda.mat[<span class="dv">2</span>,s] <span class="op">*</span><span class="st"> </span>this.tfr</span>
<span id="cb119-21"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-21"></a>    <span class="co"># lines(x, fx2.hat, col = &quot;blue&quot;)</span></span>
<span id="cb119-22"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-22"></a>    <span class="co"># lines(x, fx1.hat + fx2.hat)</span></span>
<span id="cb119-23"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-23"></a>    <span class="co"># title(last.year)</span></span>
<span id="cb119-24"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-24"></a>    my.dt &lt;-<span class="st"> </span>my.dt[Year<span class="op">==</span>my.year, fx <span class="op">:</span><span class="er">=</span><span class="st"> </span>fx]</span>
<span id="cb119-25"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-25"></a>    my.dt &lt;-<span class="st"> </span>my.dt[Year<span class="op">==</span>my.year, fx1 <span class="op">:</span><span class="er">=</span><span class="st"> </span>fx1.hat]</span>
<span id="cb119-26"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-26"></a>    my.dt &lt;-<span class="st"> </span>my.dt[Year<span class="op">==</span>my.year, fx2 <span class="op">:</span><span class="er">=</span><span class="st"> </span>fx2.hat]</span>
<span id="cb119-27"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-27"></a>    my.dt &lt;-<span class="st"> </span>my.dt[Year<span class="op">==</span>my.year, fx1fx2 <span class="op">:</span><span class="er">=</span><span class="st"> </span>fx1.hat <span class="op">+</span><span class="st"> </span>fx2.hat]</span>
<span id="cb119-28"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-28"></a></span>
<span id="cb119-29"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-29"></a>}</span>
<span id="cb119-30"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-30"></a></span>
<span id="cb119-31"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-31"></a>labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Observed&quot;</span> =<span class="st"> &quot;black&quot;</span>, <span class="st">&quot;Mixture 1&quot;</span> =<span class="st"> &quot;blue&quot;</span>, <span class="st">&quot;Mixture 2&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;Sum of mixtures&quot;</span>=<span class="st">&quot;orange&quot;</span>)</span>
<span id="cb119-32"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-32"></a></span>
<span id="cb119-33"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-33"></a><span class="co"># plot2 &lt;-</span></span>
<span id="cb119-34"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-34"></a><span class="co">#   ggplot(data=my.dt, aes(x=Age)) + </span></span>
<span id="cb119-35"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-35"></a><span class="co">#   geom_line(aes( y= ASFR, group=Year, color = &quot;Observed&quot;))+</span></span>
<span id="cb119-36"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-36"></a><span class="co">#   geom_line(aes( y= fx1, group=Year, color = &quot;Mixture 1&quot;))+</span></span>
<span id="cb119-37"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-37"></a><span class="co">#   geom_line(aes( y= fx2, group=Year, color = &quot;Mixture 2&quot;))+</span></span>
<span id="cb119-38"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-38"></a><span class="co">#   geom_line(aes( y= fx1fx2, group=Year, color = &quot;Sum of mixtures&quot;))+</span></span>
<span id="cb119-39"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-39"></a><span class="co">#   labs(color = &quot;Legend&quot;) +</span></span>
<span id="cb119-40"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-40"></a><span class="co">#   scale_color_manual(values = labels)+</span></span>
<span id="cb119-41"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-41"></a><span class="co">#   theme_bw()#+</span></span>
<span id="cb119-42"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-42"></a><span class="co">#   transition_time(Year)+</span></span>
<span id="cb119-43"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-43"></a><span class="co">#   labs(title = &quot;Year: {frame_time}&quot;)</span></span>
<span id="cb119-44"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-44"></a></span>
<span id="cb119-45"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb119-45"></a><span class="co"># anim_save(&quot;plot2.gif&quot;, plot2)</span></span></code></pre></div>
<p><img src="plot2.gif" /></p>
<p>The animation shows how the distributions operate under the ASFR curve. There could be two separate normal distributions with distinct mean ages of childbearing.</p>
<p>Let’s do tempo adjustment:</p>
<p><strong>NOTE: Help! I don’t know how to interpret these graphs</strong></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb120-1"></a>rt.mat &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(mu.mat, <span class="dv">1</span>, center.diff))</span>
<span id="cb120-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb120-2"></a>tfr.vec &lt;-<span class="st"> </span><span class="kw">apply</span>(my.fat, <span class="dv">2</span>, sum)</span>
<span id="cb120-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb120-3"></a>tfr.mat &lt;-<span class="st"> </span>lambda.mat <span class="op">*</span><span class="st"> </span>tfr.vec</span>
<span id="cb120-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb120-4"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb120-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb120-5"></a></span>
<span id="cb120-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb120-6"></a><span class="kw">matplot</span>(my.year.vec, <span class="kw">t</span>(tfr.mat), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>))</span>
<span id="cb120-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb120-7"></a>tfr.star.mat &lt;-<span class="st"> </span>tfr.mat <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rt.mat)</span>
<span id="cb120-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb120-8"></a><span class="kw">matplot</span>(my.year.vec, <span class="kw">t</span>(tfr.star.mat), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-91-1"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-91-1.png" alt="Tempo Adjustment" width="672" />
<p class="caption">
Figure 7.6: Tempo Adjustment
</p>
</div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb121-1"></a>tfr.star.vec &lt;-<span class="st"> </span><span class="kw">colSums</span>(tfr.star.mat)</span>
<span id="cb121-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb121-2"></a></span>
<span id="cb121-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb121-3"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb121-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb121-4"></a><span class="kw">plot</span>(my.year.vec, tfr.vec, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb121-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb121-5"></a>     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb121-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb121-6"></a></span>
<span id="cb121-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb121-7"></a><span class="kw">lines</span>(my.year.vec, tfr.star.vec, <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-91-2"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-91-2.png" alt="Tempo Adjustment" width="672" />
<p class="caption">
Figure 7.7: Tempo Adjustment
</p>
</div>
<div id="mixture" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Mixture</h3>
<p>Let’s look at 1st births, again as if their are two latent groups: <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>. (These could be “early moms” / “late moms”, non-college / college, pre-marital / marital, lower-class / upper class, <span class="math inline">\(\ldots\)</span>)</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-1"></a><span class="kw">library</span>(mixtools)</span>
<span id="cb122-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-2"></a>  <span class="co">## simulate 2 normals </span></span>
<span id="cb122-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-3"></a>  N &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb122-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-4"></a>  x1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dt">mean =</span> <span class="dv">22</span>, <span class="dt">sd =</span> <span class="dv">3</span>) <span class="co">##</span></span>
<span id="cb122-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-5"></a>  x2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">2</span><span class="op">*</span>N, <span class="dt">mean =</span> <span class="dv">30</span>, <span class="dt">sd =</span> <span class="dv">4</span>)</span>
<span id="cb122-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-6"></a>  <span class="co">## combine them</span></span>
<span id="cb122-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-7"></a>  x &lt;-<span class="st"> </span><span class="kw">c</span>(x1,x2)</span>
<span id="cb122-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-8"></a>  <span class="co">## use EM to infer mixture</span></span>
<span id="cb122-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-9"></a>  out &lt;-<span class="st"> </span><span class="kw">normalmixEM</span>(x,</span>
<span id="cb122-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-10"></a>                     <span class="dt">lambda =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.5</span>),</span>
<span id="cb122-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-11"></a>                     <span class="dt">mu =</span> <span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">35</span>),</span>
<span id="cb122-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb122-12"></a>                     <span class="dt">sigma =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>))</span></code></pre></div>
<pre><code>## number of iterations= 284</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb124-1"></a>  <span class="kw">print</span>(out<span class="op">$</span>mu)</span></code></pre></div>
<pre><code>## [1] 21.82989 29.86819</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb126-1"></a>  <span class="kw">print</span>(out<span class="op">$</span>sigma)</span></code></pre></div>
<pre><code>## [1] 2.809958 4.145025</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb128-1"></a>  <span class="kw">print</span>(out<span class="op">$</span>lambda)</span></code></pre></div>
<pre><code>## [1] 0.3024403 0.6975597</code></pre>
<p>Seems to work great.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb130-1"></a>  ages &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">:</span><span class="dv">49</span></span>
<span id="cb130-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb130-2"></a>  dens1 &lt;-<span class="st"> </span><span class="kw">dnorm</span>(<span class="dt">x =</span> ages, <span class="dt">mean =</span> out<span class="op">$</span>mu[<span class="dv">1</span>], <span class="dt">sd =</span> out<span class="op">$</span>sigma[<span class="dv">1</span>]) <span class="op">*</span><span class="st"> </span>out<span class="op">$</span>lambda[<span class="dv">1</span>]</span>
<span id="cb130-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb130-3"></a>  dens2 &lt;-<span class="st"> </span><span class="kw">dnorm</span>(<span class="dt">x =</span> ages, <span class="dt">mean =</span> out<span class="op">$</span>mu[<span class="dv">2</span>], <span class="dt">sd =</span> out<span class="op">$</span>sigma[<span class="dv">2</span>]) <span class="op">*</span><span class="st"> </span>out<span class="op">$</span>lambda[<span class="dv">2</span>]</span>
<span id="cb130-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb130-4"></a>  <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb130-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb130-5"></a>  <span class="kw">hist</span>(x, <span class="dt">probability =</span> T, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Ages&quot;</span>)</span>
<span id="cb130-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb130-6"></a>  <span class="kw">lines</span>(ages, dens1, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb130-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb130-7"></a>  <span class="kw">lines</span>(ages, dens2, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb130-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb130-8"></a>  <span class="kw">lines</span>(ages, dens1 <span class="op">+</span><span class="st"> </span>dens2, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-93"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-93-1.png" alt="Histogram of ages (x)" width="672" />
<p class="caption">
Figure 7.8: Histogram of ages (x)
</p>
</div>
</div>
<div id="an-algorithm-for-tempo-adjustment-of-mixtures" class="section level3">
<h3><span class="header-section-number">7.5.2</span> An algorithm for tempo adjustment of mixtures</h3>
<ul>
<li><p>Fit normal mixture to each year.</p></li>
<li><p>Refit using constant variance (average). This assures shape invariance of each component, fulfilling BF assumption.</p></li>
<li><p>Estimate BF separately for <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, and combine.</p></li>
<li><p>tempo_mixed_results_figure.pdf <strong>NOTE: not sure about this…</strong></p></li>
</ul>
</div>
</div>
<div id="conclusions-4" class="section level2">
<h2><span class="header-section-number">7.6</span> Conclusions</h2>
<ul>
<li>Postponement dilutes period births, lowers TFR</li>
<li>Tempo-adjustment tries to ``put births back in’’</li>
<li>Changes in mean work fine if ``shape’’ doesn’t change</li>
<li>Shape can change through heterogeneity</li>
<li>With strong assumptions, we can identify heterogeneity</li>
<li>Declining quantum for young and postponement for old appears to be the story</li>
</ul>
<div id="caveats" class="section level3">
<h3><span class="header-section-number">7.6.1</span> Caveats</h3>
<ul>
<li>Who are these latent groups? Do you start out in one and end up in the other? Do you stay in one your whole life?</li>
<li>How do we project forward?</li>
<li>Can we use other indicators (e.g., social class, education, marriage) to get same results?</li>
</ul>
<hr />
<hr />
</div>
</div>
<div id="questions-3" class="section level2">
<h2><span class="header-section-number">7.7</span> Questions</h2>
<ol style="list-style-type: decimal">
<li>Using the tempo_simu.R file,
<ol style="list-style-type: lower-alpha">
<li>Try with N of 4 million – does it still work? What happens?</li>
<li>Try with a shift function that goes up and down. Are the adjusted counts ever LESS than the observed counts? If so, when?<br />
</li>
<li>If the cumulative shift was Rt = a + 0.1*t, what would be a formula for tempo-adjusted counts of births? Sketch the 4 panels without the computer and then check to see if you’re right.</li>
</ol></li>
<li>Calculate the age profile of fertility change predicted by the BongaartsFeeney model by taking time derivatives of the log schedules. You will end up with three terms. Describe each of these in words.<br />
</li>
<li>Use simulation based on tempo simu.R to check your answer.<br />
</li>
<li>Is there a diagnostic plot that you could do to compare observed agespecific changes to those predicted by the BF model? Hint: use normalized schedules that sum to 1.0<br />
</li>
<li>Use this diagnostic plot to all-order fertility change during the Great Recession.<br />
</li>
<li>Use this diagnostic plot to 1st, 2nd, and 3rd births.<br />
</li>
<li>Fit the two-part normal mixture model to fertility from another country based on what looks interesting in the Burkimsher paper. (E.g., Canada, Portugal, or the Netherlands). I recommend doing this for 1 year, but once you get your code running, you could iterate over years. Use graphs to discuss the goodness of fit. And if you do more than 1 year, discuss whether the time trends in the parameters make substantive sense)</li>
</ol>
</div>
<div id="solutions-3" class="section level2">
<h2><span class="header-section-number">7.8</span> Solutions</h2>
<ol style="list-style-type: decimal">
<li><em>Using the tempo_simu.R file,</em>
<ol style="list-style-type: lower-alpha">
<li><em>Try with N of 4 million – does it still work? What happens?</em>
This simulation will first sample from a normal distribution draws of ages that represent the ages of women when giving birth for the first time. It also creates as shift function <span class="math inline">\(R(t)\)</span> which affects all women of a given year.</li>
</ol></li>
</ol>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-1"></a><span class="kw">library</span>(data.table)</span>
<span id="cb131-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-2"></a><span class="kw">source</span>(<span class="st">&quot;functions/utility_functions.R&quot;</span>)</span>
<span id="cb131-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-3"></a><span class="kw">source</span>(<span class="st">&quot;functions/tempo_functions.R&quot;</span>)</span>
<span id="cb131-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-4"></a></span>
<span id="cb131-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-5"></a>million =<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span></span>
<span id="cb131-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-6"></a>thousand =<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">3</span></span>
<span id="cb131-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-7"></a>N &lt;-<span class="st">  </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>million</span>
<span id="cb131-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-8"></a>year.vec &lt;-<span class="st"> </span><span class="dv">1990</span><span class="op">:</span><span class="dv">2020</span></span>
<span id="cb131-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-9"></a></span>
<span id="cb131-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-10"></a><span class="co">#######################################</span></span>
<span id="cb131-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-11"></a><span class="co">## simulate originally timed births  ##</span></span>
<span id="cb131-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-12"></a><span class="co">#######################################</span></span>
<span id="cb131-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-13"></a></span>
<span id="cb131-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-14"></a><span class="co">## we&#39;ll assume normal with age and uniform with time</span></span>
<span id="cb131-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-15"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dt">mean =</span> <span class="dv">30</span>, <span class="dt">sd =</span> <span class="dv">4</span>)</span>
<span id="cb131-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-16"></a>t &lt;-<span class="st"> </span><span class="kw">runif</span>(N, <span class="dt">min =</span> <span class="kw">min</span>(year.vec), <span class="kw">max</span>(year.vec)<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb131-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-17"></a>dt &lt;-<span class="st"> </span><span class="kw">data.table</span>(x, t)</span>
<span id="cb131-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-18"></a></span>
<span id="cb131-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-19"></a><span class="co">#########################</span></span>
<span id="cb131-20"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-20"></a><span class="co">## shifting the births ##</span></span>
<span id="cb131-21"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-21"></a><span class="co">#########################</span></span>
<span id="cb131-22"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-22"></a></span>
<span id="cb131-23"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-23"></a><span class="co">## we&#39;ll assume a continuous S-shaped cumulative shift</span></span>
<span id="cb131-24"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-24"></a>shift.t &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span><span class="kw">plogis</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">length.out =</span> <span class="kw">length</span>(year.vec)))</span>
<span id="cb131-25"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-25"></a></span>
<span id="cb131-26"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-26"></a></span>
<span id="cb131-27"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-27"></a><span class="kw">plot</span>(year.vec, shift.t, <span class="dt">type =</span> <span class="st">&quot;o&quot;</span>,</span>
<span id="cb131-28"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb131-28"></a>     <span class="dt">main =</span> <span class="st">&quot;Cumulative shifts&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-1"></a><span class="co">## include shifts as a column</span></span>
<span id="cb132-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-2"></a>Rt &lt;-<span class="st"> </span><span class="kw">approx</span>(<span class="dt">x =</span> year.vec, <span class="dt">y =</span> shift.t, <span class="dt">xout =</span> t)<span class="op">$</span>y</span>
<span id="cb132-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-3"></a>dt[, Rt <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">approx</span>(<span class="dt">x =</span> year.vec, <span class="dt">y =</span> shift.t, <span class="dt">xout =</span> t)<span class="op">$</span>y]</span>
<span id="cb132-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-4"></a><span class="co">## calculate shifted times and ages of births</span></span>
<span id="cb132-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-5"></a>dt[, t.obs <span class="op">:</span><span class="er">=</span><span class="st"> </span>t <span class="op">+</span><span class="st"> </span>Rt]</span>
<span id="cb132-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-6"></a>dt[, x.obs <span class="op">:</span><span class="er">=</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>Rt]</span>
<span id="cb132-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-7"></a><span class="co">## retain only the original time window (for convenience)</span></span>
<span id="cb132-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-8"></a>dt &lt;-<span class="st"> </span>dt[<span class="kw">floor</span>(t.obs) <span class="op">%in%</span><span class="st"> </span>year.vec]</span>
<span id="cb132-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-9"></a></span>
<span id="cb132-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-10"></a></span>
<span id="cb132-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-11"></a><span class="co">##########################################</span></span>
<span id="cb132-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-12"></a><span class="co">## observed births counts and mean ages ##</span></span>
<span id="cb132-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-13"></a><span class="co">##########################################</span></span>
<span id="cb132-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-14"></a></span>
<span id="cb132-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-15"></a>out &lt;-<span class="st"> </span>dt[, .(<span class="dt">Bt =</span> .N,                   <span class="co">## count the events</span></span>
<span id="cb132-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-16"></a>              <span class="dt">mut =</span> <span class="kw">mean</span>(x.obs)),      <span class="co">## get mean age</span></span>
<span id="cb132-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-17"></a>          by =<span class="st"> </span>.(<span class="dt">year =</span> <span class="kw">floor</span>(t.obs))] <span class="co">## by whole years</span></span>
<span id="cb132-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-18"></a>out &lt;-<span class="st"> </span>out[<span class="kw">order</span>(year)]</span>
<span id="cb132-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-19"></a></span>
<span id="cb132-20"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-20"></a><span class="co">############################################</span></span>
<span id="cb132-21"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-21"></a><span class="co">## change in mean age and adjusted counts ##</span></span>
<span id="cb132-22"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-22"></a><span class="co">############################################</span></span>
<span id="cb132-23"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-23"></a></span>
<span id="cb132-24"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-24"></a>out[, rt.hat <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">center.diff</span>(mut, <span class="dt">end.fill =</span> T)]</span>
<span id="cb132-25"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-25"></a>out[, Rt.hat <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">cumsum</span>(rt.hat)]</span>
<span id="cb132-26"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-26"></a>out[, Bt.adj <span class="op">:</span><span class="er">=</span><span class="st"> </span>Bt <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rt.hat)]</span>
<span id="cb132-27"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-27"></a></span>
<span id="cb132-28"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-28"></a></span>
<span id="cb132-29"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-29"></a><span class="co">## function version of tabulating and plotting</span></span>
<span id="cb132-30"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-30"></a></span>
<span id="cb132-31"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-31"></a>tempo_simu_plot_fun &lt;-<span class="st"> </span><span class="cf">function</span>(dt)</span>
<span id="cb132-32"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-32"></a>{</span>
<span id="cb132-33"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-33"></a></span>
<span id="cb132-34"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-34"></a>    <span class="co">## requires x.obs and t.obs and</span></span>
<span id="cb132-35"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-35"></a>    <span class="co">## (optionally) t, the original unshifted birth times</span></span>
<span id="cb132-36"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-36"></a></span>
<span id="cb132-37"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-37"></a><span class="co">##########################################</span></span>
<span id="cb132-38"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-38"></a><span class="co">## observed births counts and mean ages ##</span></span>
<span id="cb132-39"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-39"></a><span class="co">##########################################</span></span>
<span id="cb132-40"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-40"></a></span>
<span id="cb132-41"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-41"></a>out &lt;-<span class="st"> </span>dt[, .(<span class="dt">Bt =</span> .N,                   <span class="co">## count the events</span></span>
<span id="cb132-42"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-42"></a>              <span class="dt">mut =</span> <span class="kw">mean</span>(x.obs)),      <span class="co">## get mean age</span></span>
<span id="cb132-43"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-43"></a>          by =<span class="st"> </span>.(<span class="dt">year =</span> <span class="kw">floor</span>(t.obs))] <span class="co">## by whole years</span></span>
<span id="cb132-44"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-44"></a>out &lt;-<span class="st"> </span>out[<span class="kw">order</span>(year)]</span>
<span id="cb132-45"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-45"></a></span>
<span id="cb132-46"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-46"></a><span class="co">############################################</span></span>
<span id="cb132-47"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-47"></a><span class="co">## change in mean age and adjusted counts ##</span></span>
<span id="cb132-48"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-48"></a><span class="co">############################################</span></span>
<span id="cb132-49"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-49"></a></span>
<span id="cb132-50"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-50"></a>out[, rt.hat <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">center.diff</span>(mut, <span class="dt">end.fill =</span> T)]</span>
<span id="cb132-51"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-51"></a>out[, Rt.hat <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">cumsum</span>(rt.hat)]</span>
<span id="cb132-52"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-52"></a>out[, Bt.adj <span class="op">:</span><span class="er">=</span><span class="st"> </span>Bt <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rt.hat)]</span>
<span id="cb132-53"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-53"></a></span>
<span id="cb132-54"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-54"></a></span>
<span id="cb132-55"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-55"></a><span class="co">######################</span></span>
<span id="cb132-56"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-56"></a><span class="co">## plot the results ##</span></span>
<span id="cb132-57"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-57"></a><span class="co">######################</span></span>
<span id="cb132-58"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-58"></a></span>
<span id="cb132-59"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-59"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb132-60"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-60"></a>out[, <span class="kw">plot</span>(year, Bt, <span class="dt">ylim =</span> <span class="kw">c</span>(.<span class="dv">8</span>, <span class="fl">1.2</span>) <span class="op">*</span><span class="st"> </span><span class="kw">range</span>(Bt),</span>
<span id="cb132-61"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-61"></a>           <span class="dt">main =</span> <span class="st">&quot;Observed Births&quot;</span>)]</span>
<span id="cb132-62"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-62"></a>out[, <span class="kw">plot</span>(year, mut,</span>
<span id="cb132-63"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-63"></a>           <span class="dt">main =</span> <span class="st">&quot;Mean age of birth&quot;</span>)]</span>
<span id="cb132-64"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-64"></a>out[, <span class="kw">plot</span>(year, <span class="kw">center.diff</span>(mut),</span>
<span id="cb132-65"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-65"></a>           <span class="dt">main =</span> <span class="st">&quot;Change in mean age of birth&quot;</span>)]</span>
<span id="cb132-66"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-66"></a><span class="co">## observed, adjusted, and original births</span></span>
<span id="cb132-67"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-67"></a>Bt.orig.vec &lt;-<span class="st"> </span>dt[, <span class="kw">table</span>(<span class="kw">floor</span>(t))]</span>
<span id="cb132-68"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-68"></a>out[, <span class="kw">plot</span>(year, Bt, <span class="dt">ylim =</span> <span class="kw">c</span>(.<span class="dv">8</span>, <span class="fl">1.5</span>) <span class="op">*</span><span class="st"> </span><span class="kw">range</span>(Bt),</span>
<span id="cb132-69"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-69"></a>           <span class="dt">main =</span> <span class="st">&quot;Observed and Adjusted Births&quot;</span>)]</span>
<span id="cb132-70"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-70"></a>out[, <span class="kw">lines</span>(year, Bt.adj, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)]</span>
<span id="cb132-71"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-71"></a><span class="kw">points</span>(<span class="kw">names</span>(Bt.orig.vec), Bt.orig.vec, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb132-72"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-72"></a><span class="kw">legend</span>(<span class="st">&quot;top&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;observed&quot;</span>, <span class="st">&quot;adjusted&quot;</span>, <span class="st">&quot;original&quot;</span>),</span>
<span id="cb132-73"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-73"></a>       <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb132-74"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-74"></a>       <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb132-75"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-75"></a>       <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb132-76"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-76"></a>}</span>
<span id="cb132-77"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-77"></a></span>
<span id="cb132-78"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb132-78"></a><span class="kw">tempo_simu_plot_fun</span>(dt)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-94-2.png" width="672" />
Yes, it still works. In fact, we see that the adjusted births are very close to the observed births when using this number of simulations. (I continue to use an N of 4 million for the rest of this problem).<br />
b. <em>Try with a shift function that goes up and down. Are the adjusted counts ever LESS than the observed counts? If so, when?</em><br />
<img src="bookdown-demo_files/figure-html/unnamed-chunk-95-1.png" width="672" /><img src="bookdown-demo_files/figure-html/unnamed-chunk-95-2.png" width="672" />
The adjusted counts are not always less than the observed. Naturally, this only happens when we have spikes on the observed counts that become smoother after the adjusting of the birth counts.<br />
c. <em>If the cumulative shift was <span class="math inline">\(R_t = a + 0.1\times t\)</span>, what would be a formula for tempo-adjusted counts of births? Sketch the 4 panels without the computer and then check to see if you’re right.</em><br />
Let <span class="math inline">\(a = -199\)</span>, so we get a shift of 0 to about 3 years depending on the time period:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-1"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dt">mean =</span> <span class="dv">30</span>, <span class="dt">sd =</span> <span class="dv">4</span>)</span>
<span id="cb133-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-2"></a>t &lt;-<span class="st"> </span><span class="kw">runif</span>(N, <span class="dt">min =</span> <span class="kw">min</span>(year.vec), <span class="kw">max</span>(year.vec)<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb133-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-3"></a>dt &lt;-<span class="st"> </span><span class="kw">data.table</span>(x, t)</span>
<span id="cb133-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-4"></a></span>
<span id="cb133-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-5"></a><span class="co">#########################</span></span>
<span id="cb133-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-6"></a><span class="co">## shifting the births ##</span></span>
<span id="cb133-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-7"></a><span class="co">#########################</span></span>
<span id="cb133-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-8"></a></span>
<span id="cb133-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-9"></a></span>
<span id="cb133-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-10"></a><span class="co">#linear shift</span></span>
<span id="cb133-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-11"></a>alpha =<span class="st"> </span><span class="dv">-199</span></span>
<span id="cb133-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-12"></a></span>
<span id="cb133-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-13"></a>shift.t &lt;-<span class="st">  </span>alpha <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span><span class="op">*</span>year.vec</span>
<span id="cb133-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-14"></a></span>
<span id="cb133-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-15"></a></span>
<span id="cb133-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-16"></a><span class="kw">plot</span>(year.vec, shift.t, <span class="dt">type =</span> <span class="st">&quot;o&quot;</span>,</span>
<span id="cb133-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb133-17"></a>     <span class="dt">main =</span> <span class="st">&quot;Cumulative shifts&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-96-1.png" width="672" /></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-1"></a><span class="co">## include shifts as a column</span></span>
<span id="cb134-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-2"></a>Rt &lt;-<span class="st"> </span><span class="kw">approx</span>(<span class="dt">x =</span> year.vec, <span class="dt">y =</span> shift.t, <span class="dt">xout =</span> t)<span class="op">$</span>y</span>
<span id="cb134-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-3"></a>dt[, Rt <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">approx</span>(<span class="dt">x =</span> year.vec, <span class="dt">y =</span> shift.t, <span class="dt">xout =</span> t)<span class="op">$</span>y]</span>
<span id="cb134-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-4"></a><span class="co">## calculate shifted times and ages of births</span></span>
<span id="cb134-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-5"></a>dt[, t.obs <span class="op">:</span><span class="er">=</span><span class="st"> </span>t <span class="op">+</span><span class="st"> </span>Rt]</span>
<span id="cb134-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-6"></a>dt[, x.obs <span class="op">:</span><span class="er">=</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>Rt]</span>
<span id="cb134-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-7"></a><span class="co">## retain only the original time window (for convenience)</span></span>
<span id="cb134-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-8"></a>dt &lt;-<span class="st"> </span>dt[<span class="kw">floor</span>(t.obs) <span class="op">%in%</span><span class="st"> </span>year.vec]</span>
<span id="cb134-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-9"></a></span>
<span id="cb134-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-10"></a></span>
<span id="cb134-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-11"></a><span class="co">##########################################</span></span>
<span id="cb134-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-12"></a><span class="co">## observed births counts and mean ages ##</span></span>
<span id="cb134-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-13"></a><span class="co">##########################################</span></span>
<span id="cb134-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-14"></a></span>
<span id="cb134-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-15"></a>out &lt;-<span class="st"> </span>dt[, .(<span class="dt">Bt =</span> .N,                   <span class="co">## count the events</span></span>
<span id="cb134-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-16"></a>              <span class="dt">mut =</span> <span class="kw">mean</span>(x.obs)),      <span class="co">## get mean age</span></span>
<span id="cb134-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-17"></a>          by =<span class="st"> </span>.(<span class="dt">year =</span> <span class="kw">floor</span>(t.obs))] <span class="co">## by whole years</span></span>
<span id="cb134-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-18"></a>out &lt;-<span class="st"> </span>out[<span class="kw">order</span>(year)]</span>
<span id="cb134-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-19"></a></span>
<span id="cb134-20"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-20"></a><span class="co">############################################</span></span>
<span id="cb134-21"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-21"></a><span class="co">## change in mean age and adjusted counts ##</span></span>
<span id="cb134-22"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-22"></a><span class="co">############################################</span></span>
<span id="cb134-23"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-23"></a></span>
<span id="cb134-24"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-24"></a>out[, rt.hat <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">center.diff</span>(mut, <span class="dt">end.fill =</span> T)]</span>
<span id="cb134-25"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-25"></a>out[, Rt.hat <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">cumsum</span>(rt.hat)]</span>
<span id="cb134-26"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-26"></a>out[, Bt.adj <span class="op">:</span><span class="er">=</span><span class="st"> </span>Bt <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rt.hat)]</span>
<span id="cb134-27"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-27"></a></span>
<span id="cb134-28"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-28"></a></span>
<span id="cb134-29"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-29"></a><span class="co">## function version of tabulating and plotting</span></span>
<span id="cb134-30"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-30"></a></span>
<span id="cb134-31"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-31"></a>tempo_simu_plot_fun &lt;-<span class="st"> </span><span class="cf">function</span>(dt)</span>
<span id="cb134-32"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-32"></a>{</span>
<span id="cb134-33"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-33"></a></span>
<span id="cb134-34"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-34"></a>    <span class="co">## requires x.obs and t.obs and</span></span>
<span id="cb134-35"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-35"></a>    <span class="co">## (optionally) t, the original unshifted birth times</span></span>
<span id="cb134-36"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-36"></a></span>
<span id="cb134-37"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-37"></a><span class="co">##########################################</span></span>
<span id="cb134-38"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-38"></a><span class="co">## observed births counts and mean ages ##</span></span>
<span id="cb134-39"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-39"></a><span class="co">##########################################</span></span>
<span id="cb134-40"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-40"></a></span>
<span id="cb134-41"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-41"></a>out &lt;-<span class="st"> </span>dt[, .(<span class="dt">Bt =</span> .N,                   <span class="co">## count the events</span></span>
<span id="cb134-42"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-42"></a>              <span class="dt">mut =</span> <span class="kw">mean</span>(x.obs)),      <span class="co">## get mean age</span></span>
<span id="cb134-43"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-43"></a>          by =<span class="st"> </span>.(<span class="dt">year =</span> <span class="kw">floor</span>(t.obs))] <span class="co">## by whole years</span></span>
<span id="cb134-44"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-44"></a>out &lt;-<span class="st"> </span>out[<span class="kw">order</span>(year)]</span>
<span id="cb134-45"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-45"></a></span>
<span id="cb134-46"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-46"></a><span class="co">############################################</span></span>
<span id="cb134-47"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-47"></a><span class="co">## change in mean age and adjusted counts ##</span></span>
<span id="cb134-48"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-48"></a><span class="co">############################################</span></span>
<span id="cb134-49"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-49"></a></span>
<span id="cb134-50"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-50"></a>out[, rt.hat <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">center.diff</span>(mut, <span class="dt">end.fill =</span> T)]</span>
<span id="cb134-51"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-51"></a>out[, Rt.hat <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">cumsum</span>(rt.hat)]</span>
<span id="cb134-52"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-52"></a>out[, Bt.adj <span class="op">:</span><span class="er">=</span><span class="st"> </span>Bt <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rt.hat)]</span>
<span id="cb134-53"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-53"></a></span>
<span id="cb134-54"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-54"></a></span>
<span id="cb134-55"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-55"></a><span class="co">######################</span></span>
<span id="cb134-56"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-56"></a><span class="co">## plot the results ##</span></span>
<span id="cb134-57"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-57"></a><span class="co">######################</span></span>
<span id="cb134-58"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-58"></a></span>
<span id="cb134-59"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-59"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb134-60"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-60"></a>out[, <span class="kw">plot</span>(year, Bt, <span class="dt">ylim =</span> <span class="kw">c</span>(.<span class="dv">8</span>, <span class="fl">1.2</span>) <span class="op">*</span><span class="st"> </span><span class="kw">range</span>(Bt),</span>
<span id="cb134-61"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-61"></a>           <span class="dt">main =</span> <span class="st">&quot;Observed Births&quot;</span>)]</span>
<span id="cb134-62"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-62"></a>out[, <span class="kw">plot</span>(year, mut,</span>
<span id="cb134-63"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-63"></a>           <span class="dt">main =</span> <span class="st">&quot;Mean age of birth&quot;</span>)]</span>
<span id="cb134-64"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-64"></a>out[, <span class="kw">plot</span>(year, <span class="kw">center.diff</span>(mut),</span>
<span id="cb134-65"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-65"></a>           <span class="dt">main =</span> <span class="st">&quot;Change in mean age of birth&quot;</span>)]</span>
<span id="cb134-66"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-66"></a><span class="co">## observed, adjusted, and original births</span></span>
<span id="cb134-67"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-67"></a>Bt.orig.vec &lt;-<span class="st"> </span>dt[, <span class="kw">table</span>(<span class="kw">floor</span>(t))]</span>
<span id="cb134-68"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-68"></a>out[, <span class="kw">plot</span>(year, Bt, <span class="dt">ylim =</span> <span class="kw">c</span>(.<span class="dv">8</span>, <span class="fl">1.5</span>) <span class="op">*</span><span class="st"> </span><span class="kw">range</span>(Bt),</span>
<span id="cb134-69"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-69"></a>           <span class="dt">main =</span> <span class="st">&quot;Observed and Adjusted Births&quot;</span>)]</span>
<span id="cb134-70"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-70"></a>out[, <span class="kw">lines</span>(year, Bt.adj, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)]</span>
<span id="cb134-71"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-71"></a><span class="kw">points</span>(<span class="kw">names</span>(Bt.orig.vec), Bt.orig.vec, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb134-72"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-72"></a><span class="kw">legend</span>(<span class="st">&quot;top&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;observed&quot;</span>, <span class="st">&quot;adjusted&quot;</span>, <span class="st">&quot;original&quot;</span>),</span>
<span id="cb134-73"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-73"></a>       <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb134-74"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-74"></a>       <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb134-75"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-75"></a>       <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb134-76"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-76"></a>}</span>
<span id="cb134-77"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-77"></a></span>
<span id="cb134-78"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb134-78"></a><span class="kw">tempo_simu_plot_fun</span>(dt)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-96-2.png" width="672" />
2. <em>Calculate the age profile of fertility change predicted by the BongaartsFeeney model by taking time derivatives of the log schedules. You will end up with three terms. Describe each of these in words.</em><br />
<span class="math display">\[\begin{aligned}
    f(a,t)&amp;=f_0(a-R(t))[1-R&#39;(t)]q(t)\\
    log(f(a,t))&amp;=log(f_0(a-R(t))) + log(1-R&#39;(t)) + log(q(t))\\
    \frac{\partial log(f(a,t))}{\partial t}&amp;=\frac{\partial log(f_0(a-R(t)))}{\partial t} + \frac{\partial
    log(1-R&#39;(t))}{\partial t} + \frac{\partial log(q(t))}{\partial t}\\
    \frac{\partial log(f(a,t))}{\partial t}&amp;=-R&#39;(t)\frac{f_0&#39;(a-R(t))}{f_0(a-R(t))} -\frac{R&#39;&#39;(t)}{1-R&#39;(t)} + \frac{q&#39;(t)}{q(t)}
    \end{aligned}\]</span>
The first term represents the proportional change in the fertility of the equivalent pre-postponement cohort. In particular, it is divided into (how far someone shifts ‘over’ relative to ages on the baseline fertility schedule) and an <span class="math inline">\(R&#39;(t)\)</span> term (how much one shifts ‘up’). The second term represents the proportional change in the rate of change in years of postponement; it is a tempo-effect. The third term represents the proportional change in quantum.
3. <em>Use simulation based on tempo simu.R to check your answer.</em></p>
<p>The <code>tempo_simu.R</code> function computes <span class="math inline">\(R(t)\)</span> but we need to obtain the remaining components of the answer from the previous excercise. For simplicity, let’s assume that there are no tempo effects (<span class="math inline">\(q(t)=0\)</span>) and that <span class="math inline">\(a=25\)</span>, that is, our baseline schedule is that of women aged 25.
a. <span class="math inline">\(R(t)\)</span> components:
Let’s briefly look at <span class="math inline">\(R(t)\)</span>, <span class="math inline">\(R&#39;(t)\)</span>, and <span class="math inline">\(R&#39;&#39;(t)\)</span>. In <code>tempo_simu.R</code> <span class="math inline">\(R(t)\)</span> refers to the cumulative shift object (<code>shift.t</code> ). We can obtain the derivatives by taking the centered difference of this object.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-1"></a>   shift.t.prime &lt;-<span class="st"> </span><span class="kw">center.diff</span>(shift.t)</span>
<span id="cb135-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-2"></a>   shift.t.prime<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">center.diff</span>(shift.t.prime)</span>
<span id="cb135-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-3"></a>   </span>
<span id="cb135-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-4"></a>   <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb135-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-5"></a>   <span class="kw">plot</span>(<span class="dv">1991</span><span class="op">:</span><span class="dv">2020</span>, shift.t, <span class="dt">main =</span> <span class="st">&#39;R(t)&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb135-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-6"></a>   <span class="kw">plot</span>(<span class="dv">1991</span><span class="op">:</span><span class="dv">2020</span>, shift.t.prime, <span class="dt">main =</span> <span class="st">&#39;R</span><span class="ch">\&#39;</span><span class="st">(t)&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb135-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-7"></a>   <span class="kw">plot</span>(<span class="dv">1991</span><span class="op">:</span><span class="dv">2020</span>, shift.t.prime<span class="fl">.2</span>, <span class="dt">main =</span> <span class="st">&#39;R</span><span class="ch">\&#39;\&#39;</span><span class="st">(t)&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb135-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-8"></a>   <span class="kw">plot</span>(<span class="dv">1991</span><span class="op">:</span><span class="dv">2020</span>,<span class="op">-</span>shift.t.prime<span class="fl">.2</span><span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>shift.t.prime), <span class="dt">main =</span> <span class="st">&#39;-R</span><span class="ch">\&#39;\&#39;</span><span class="st">(t) / (1- R</span><span class="ch">\&#39;</span><span class="st">(t))&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;year&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb135-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-9"></a>   <span class="st">```</span></span>
<span id="cb135-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-10"></a><span class="dt">   </span></span>
<span id="cb135-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-11"></a><span class="dt">   &lt;img src=&quot;bookdown-demo_files/figure-html/unnamed-chunk-98-1.png&quot; width=&quot;768&quot; /&gt;</span></span>
<span id="cb135-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-12"></a><span class="dt">   b. $f_0(a-R(t))$ function:</span></span>
<span id="cb135-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-13"></a><span class="dt">   In the Bongaarts and Feeney model, the baseline schedule of women of age $a$ at time $t$ is $f_0(a-R(t))$. That is, it is the fertility schedule that is observed because of the shift. From the simulation, we obtain a table of births at each age and the age-specific fertility rates. Then, we can look at the original and the observed ASFRs. The original ASFR is that from the simulation, which we would not observe. Rather we would only the see the ASFR from births that were postponed by year-specific shifts.</span></span>
<span id="cb135-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-14"></a><span class="dt">   </span></span>
<span id="cb135-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-15"></a><span class="dt">   </span><span class="st">```</span>r</span>
<span id="cb135-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-16"></a>   <span class="co"># floor everything</span></span>
<span id="cb135-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-17"></a>   dt_floored &lt;-<span class="st"> </span>dt <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-18"></a><span class="st">   </span><span class="kw">transmute</span>(<span class="st">&#39;x&#39;</span> =<span class="st"> </span><span class="kw">floor</span>(x), <span class="st">&#39;t&#39;</span> =<span class="st"> </span><span class="kw">floor</span>(t), </span>
<span id="cb135-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-19"></a>             <span class="st">&#39;t.obs&#39;</span> =<span class="st"> </span><span class="kw">floor</span>(t.obs), <span class="st">&#39;x.obs&#39;</span> =<span class="st"> </span><span class="kw">floor</span>(x.obs)) <span class="co"># the .obs values are the ones that go into the baseline function. </span></span>
<span id="cb135-20"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-20"></a>   </span>
<span id="cb135-21"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-21"></a>   <span class="co"># Births to women born at each age. </span></span>
<span id="cb135-22"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-22"></a>   original_sched &lt;-<span class="st"> </span><span class="kw">table</span>(dt_floored<span class="op">$</span>x, dt_floored<span class="op">$</span>t)</span>
<span id="cb135-23"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-23"></a>   observed_sched &lt;-<span class="st"> </span><span class="kw">table</span>(dt_floored<span class="op">$</span>x.obs, dt_floored<span class="op">$</span>t.obs)</span>
<span id="cb135-24"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-24"></a>   </span>
<span id="cb135-25"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-25"></a>   <span class="co"># ASFR (The denominator is 100 person years lived, or 100 women at each age)</span></span>
<span id="cb135-26"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-26"></a>   asfr_original&lt;-<span class="st"> </span>original_sched<span class="op">/</span>(<span class="dv">100</span><span class="op">*</span>thousand) <span class="co">#f(a,t)</span></span>
<span id="cb135-27"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-27"></a>   asfr_observed &lt;-<span class="st"> </span>observed_sched<span class="op">/</span>(<span class="dv">100</span><span class="op">*</span>thousand) <span class="co">#f_0(a,t)</span></span>
<span id="cb135-28"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-28"></a>   </span>
<span id="cb135-29"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-29"></a>   <span class="co">#Graph of ASFRs for observed and original births. The lines get lighter with each year. </span></span>
<span id="cb135-30"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-30"></a>   <span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb135-31"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-31"></a>   <span class="kw">matplot</span>(<span class="kw">rownames</span>(asfr_observed), asfr_observed, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="kw">grey</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">40</span>)), </span>
<span id="cb135-32"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-32"></a>       <span class="dt">xlab =</span> <span class="st">&#39;Age&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;ASFR&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Observed ASFR&#39;</span>)</span>
<span id="cb135-33"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-33"></a>   <span class="kw">abline</span>(<span class="dt">v=</span> <span class="dv">25</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>)</span>
<span id="cb135-34"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-34"></a>   </span>
<span id="cb135-35"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-35"></a>   <span class="kw">matplot</span>(<span class="kw">rownames</span>(asfr_original), asfr_original, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="kw">grey</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">40</span>)), </span>
<span id="cb135-36"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-36"></a>       <span class="dt">xlab =</span> <span class="st">&#39;Age&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;ASFR&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Original ASFR&#39;</span>)</span>
<span id="cb135-37"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-37"></a>   <span class="kw">abline</span>(<span class="dt">v=</span> <span class="dv">25</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>)</span>
<span id="cb135-38"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-38"></a>   <span class="st">```</span></span>
<span id="cb135-39"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-39"></a><span class="dt">   </span></span>
<span id="cb135-40"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-40"></a><span class="dt">   &lt;img src=&quot;bookdown-demo_files/figure-html/unnamed-chunk-99-1.png&quot; width=&quot;672&quot; /&gt;</span></span>
<span id="cb135-41"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-41"></a><span class="dt">   The component that we are interersted in is the first derivative of the baseline schedule ($f_0(a-R(t))$). </span></span>
<span id="cb135-42"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-42"></a><span class="dt">   </span></span>
<span id="cb135-43"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-43"></a><span class="dt">   </span><span class="st">```</span>r</span>
<span id="cb135-44"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-44"></a>   asfr_observed_prime &lt;-<span class="st"> </span><span class="kw">apply</span>(asfr_observed, <span class="dv">1</span>, center.diff)</span>
<span id="cb135-45"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-45"></a>   </span>
<span id="cb135-46"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-46"></a>   <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb135-47"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-47"></a>   <span class="kw">matplot</span>(<span class="kw">rownames</span>(asfr_observed_prime), asfr_observed_prime, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="kw">grey</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">40</span>)), </span>
<span id="cb135-48"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-48"></a>       <span class="dt">xlab =</span> <span class="st">&#39;Year&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;ASFR&#39;</span>, <span class="dt">main =</span> <span class="st">&quot;f&#39;0(a-R(t))&quot;</span> )</span>
<span id="cb135-49"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-49"></a>   <span class="kw">abline</span>(<span class="dt">v=</span> <span class="dv">25</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>)</span>
<span id="cb135-50"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-50"></a>   </span>
<span id="cb135-51"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-51"></a>   <span class="kw">matplot</span>(<span class="kw">rownames</span>(asfr_observed_prime), asfr_observed_prime<span class="op">/</span><span class="kw">t</span>(asfr_observed), <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="kw">grey</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">40</span>)), </span>
<span id="cb135-52"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-52"></a>       <span class="dt">xlab =</span> <span class="st">&#39;Year&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;ASFR&#39;</span>, <span class="dt">main =</span> <span class="st">&quot;f&#39;0(a-R(t))/f0(a-R(t))&quot;</span> )</span>
<span id="cb135-53"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-53"></a>   <span class="kw">abline</span>(<span class="dt">v=</span> <span class="dv">25</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>)</span>
<span id="cb135-54"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-54"></a>   </span>
<span id="cb135-55"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-55"></a>   f &lt;-<span class="st"> </span><span class="op">-</span>shift.t.prime<span class="op">*</span>asfr_observed_prime<span class="op">/</span><span class="kw">t</span>(asfr_observed)</span>
<span id="cb135-56"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-56"></a>   </span>
<span id="cb135-57"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-57"></a>   <span class="kw">matplot</span>(<span class="kw">rownames</span>(asfr_observed_prime),<span class="op">-</span>shift.t.prime<span class="op">*</span>asfr_observed_prime<span class="op">/</span><span class="kw">t</span>(asfr_observed), <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="kw">grey</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">40</span>)), </span>
<span id="cb135-58"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-58"></a>       <span class="dt">xlab =</span> <span class="st">&#39;Year&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;ASFR&#39;</span>, <span class="dt">main =</span> <span class="st">&quot;-R&#39;(t)*f&#39;0(a-R(t))/f0(a-R(t))&quot;</span> )</span>
<span id="cb135-59"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-59"></a>   <span class="kw">abline</span>(<span class="dt">v=</span> <span class="dv">25</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>)</span>
<span id="cb135-60"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-60"></a>   <span class="st">```</span></span>
<span id="cb135-61"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-61"></a><span class="dt">   </span></span>
<span id="cb135-62"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-62"></a><span class="dt">   &lt;img src=&quot;bookdown-demo_files/figure-html/unnamed-chunk-100-1.png&quot; width=&quot;672&quot; /&gt;</span></span>
<span id="cb135-63"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-63"></a><span class="dt">   c. Comparison of terms from original and observed data:</span></span>
<span id="cb135-64"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-64"></a><span class="dt">   We can merge all the terms of the formula from the previous question and compare it to the derivative of the log version of the observed fertility schedules. </span></span>
<span id="cb135-65"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-65"></a><span class="dt">   </span></span>
<span id="cb135-66"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-66"></a><span class="dt">   </span><span class="st">```</span>r</span>
<span id="cb135-67"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-67"></a>   <span class="co">#Observed data (right-hand side)</span></span>
<span id="cb135-68"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-68"></a>   observed_change &lt;-<span class="st"> </span><span class="op">-</span>shift.t.prime<span class="op">*</span>asfr_observed_prime<span class="op">/</span><span class="kw">t</span>(asfr_observed) <span class="op">-</span><span class="st"> </span>shift.t.prime<span class="fl">.2</span><span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>shift.t.prime)</span>
<span id="cb135-69"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-69"></a>   </span>
<span id="cb135-70"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-70"></a>   <span class="co">#Original data (left-hand side)</span></span>
<span id="cb135-71"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-71"></a>   original_change &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="kw">log</span>(<span class="kw">t</span>(asfr_original)),<span class="dv">2</span>,center.diff)</span>
<span id="cb135-72"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-72"></a>   </span>
<span id="cb135-73"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-73"></a>   <span class="co">#Graphs</span></span>
<span id="cb135-74"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-74"></a>   <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb135-75"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-75"></a>   <span class="kw">matplot</span>(<span class="kw">rownames</span>(observed_change), observed_change, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="kw">grey</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">40</span>)), </span>
<span id="cb135-76"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-76"></a>       <span class="dt">xlab =</span> <span class="st">&#39;Year&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;ASFR&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Observed change (RHS)&#39;</span>)</span>
<span id="cb135-77"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-77"></a>   <span class="kw">abline</span>(<span class="dt">v=</span> <span class="dv">25</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>)</span>
<span id="cb135-78"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-78"></a>   </span>
<span id="cb135-79"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-79"></a>   <span class="kw">matplot</span>(<span class="kw">rownames</span>(original_change), original_change, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="kw">grey</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">40</span>)), </span>
<span id="cb135-80"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-80"></a>       <span class="dt">xlab =</span> <span class="st">&#39;Year&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;ASFR&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Original change (LHS)&#39;</span>)</span>
<span id="cb135-81"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-81"></a>   <span class="kw">abline</span>(<span class="dt">v=</span> <span class="dv">25</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>)</span>
<span id="cb135-82"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-82"></a>   <span class="st">```</span></span>
<span id="cb135-83"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-83"></a><span class="dt">   </span></span>
<span id="cb135-84"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-84"></a><span class="dt">   &lt;img src=&quot;bookdown-demo_files/figure-html/unnamed-chunk-101-1.png&quot; width=&quot;672&quot; /&gt;</span></span>
<span id="cb135-85"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-85"></a><span class="dt">   </span></span>
<span id="cb135-86"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-86"></a><span class="dt">   </span><span class="st">```</span>r</span>
<span id="cb135-87"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-87"></a>   <span class="co">#There seems to be a lot of noise here, so let&#39;s look at the mean at each year for the RHS and the LHS</span></span>
<span id="cb135-88"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-88"></a>   observed_change_mean &lt;-<span class="st"> </span><span class="kw">apply</span>(observed_change, <span class="dv">2</span>, mean, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb135-89"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-89"></a>   original_change_mean &lt;-<span class="st"> </span><span class="kw">apply</span>(original_change, <span class="dv">2</span>, mean, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) </span>
<span id="cb135-90"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-90"></a>   </span>
<span id="cb135-91"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-91"></a>   <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb135-92"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-92"></a>   <span class="kw">plot</span>(observed_change_mean[<span class="dv">12</span><span class="op">:</span><span class="dv">39</span>], <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb135-93"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-93"></a>   <span class="kw">plot</span>(original_change_mean[<span class="dv">12</span><span class="op">:</span><span class="dv">39</span>], <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb135-94"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-94"></a>   <span class="st">```</span></span>
<span id="cb135-95"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-95"></a><span class="dt">   </span></span>
<span id="cb135-96"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-96"></a><span class="dt">   &lt;img src=&quot;bookdown-demo_files/figure-html/unnamed-chunk-101-2.png&quot; width=&quot;672&quot; /&gt;</span></span>
<span id="cb135-97"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-97"></a><span class="dt">   </span></span>
<span id="cb135-98"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-98"></a><span class="dt">   </span><span class="st">```</span>r</span>
<span id="cb135-99"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-99"></a>   observed_change_mean</span>
<span id="cb135-100"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-100"></a>   <span class="st">```</span></span>
<span id="cb135-101"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-101"></a><span class="dt">   </span></span>
<span id="cb135-102"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-102"></a><span class="dt">   </span><span class="st">```</span></span>
<span id="cb135-103"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-103"></a>   <span class="co">##             5             6             7             8             9            10 </span></span>
<span id="cb135-104"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-104"></a>   <span class="co">##           Inf           NaN           NaN           NaN           NaN           NaN </span></span>
<span id="cb135-105"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-105"></a>   <span class="co">##            11            12            13            14            15            16 </span></span>
<span id="cb135-106"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-106"></a>   <span class="co">##  0.0346455819  0.0297976453  0.0248332401  0.0239915297  0.0221809649  0.0199164460 </span></span>
<span id="cb135-107"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-107"></a>   <span class="co">##            17            18            19            20            21            22 </span></span>
<span id="cb135-108"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-108"></a>   <span class="co">##  0.0180659826  0.0160980077  0.0144997811  0.0126420118  0.0107639359  0.0089432668 </span></span>
<span id="cb135-109"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-109"></a>   <span class="co">##            23            24            25            26            27            28 </span></span>
<span id="cb135-110"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-110"></a>   <span class="co">##  0.0069456544  0.0051884417  0.0032663876  0.0014198640 -0.0004753358 -0.0022687715 </span></span>
<span id="cb135-111"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-111"></a>   <span class="co">##            29            30            31            32            33            34 </span></span>
<span id="cb135-112"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-112"></a>   <span class="co">## -0.0041667145 -0.0060392014 -0.0079432768 -0.0096843256 -0.0115976736 -0.0133616444 </span></span>
<span id="cb135-113"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-113"></a>   <span class="co">##            35            36            37            38            39            40 </span></span>
<span id="cb135-114"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-114"></a>   <span class="co">## -0.0153737506 -0.0170545337 -0.0189727392 -0.0208894124 -0.0233746760 -0.0249600394 </span></span>
<span id="cb135-115"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-115"></a>   <span class="co">##            41            42            43            44            45            46 </span></span>
<span id="cb135-116"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-116"></a>   <span class="co">## -0.0265662882          -Inf           NaN           NaN           NaN          -Inf </span></span>
<span id="cb135-117"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-117"></a>   <span class="co">##            47            48 </span></span>
<span id="cb135-118"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-118"></a>   <span class="co">##           NaN           NaN</span></span>
<span id="cb135-119"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-119"></a>   <span class="st">```</span></span>
<span id="cb135-120"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-120"></a><span class="dt">   </span></span>
<span id="cb135-121"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-121"></a><span class="dt">   </span><span class="st">```</span>r</span>
<span id="cb135-122"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-122"></a>   original_change_mean</span>
<span id="cb135-123"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-123"></a>   <span class="st">```</span></span>
<span id="cb135-124"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-124"></a><span class="dt">   </span></span>
<span id="cb135-125"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-125"></a><span class="dt">   </span><span class="st">```</span></span>
<span id="cb135-126"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-126"></a>   <span class="co">##           5           6           7           8           9          10          11 </span></span>
<span id="cb135-127"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-127"></a>   <span class="co">##         NaN         NaN         NaN -0.04702751        -Inf        -Inf -0.04966368 </span></span>
<span id="cb135-128"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-128"></a>   <span class="co">##          12          13          14          15          16          17          18 </span></span>
<span id="cb135-129"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-129"></a>   <span class="co">## -0.06108219 -0.05255181 -0.05463626 -0.05422444 -0.04876114 -0.05049269 -0.05189116 </span></span>
<span id="cb135-130"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-130"></a>   <span class="co">##          19          20          21          22          23          24          25 </span></span>
<span id="cb135-131"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-131"></a>   <span class="co">## -0.05168229 -0.05310568 -0.05152007 -0.05163416 -0.05222859 -0.05216303 -0.05147769 </span></span>
<span id="cb135-132"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-132"></a>   <span class="co">##          26          27          28          29          30          31          32 </span></span>
<span id="cb135-133"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-133"></a>   <span class="co">## -0.05243268 -0.05242616 -0.05138857 -0.05216956 -0.05232595 -0.05271028 -0.05269802 </span></span>
<span id="cb135-134"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-134"></a>   <span class="co">##          33          34          35          36          37          38          39 </span></span>
<span id="cb135-135"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-135"></a>   <span class="co">## -0.05278829 -0.05342713 -0.05158280 -0.05298234 -0.04710160 -0.06555547 -0.06775549 </span></span>
<span id="cb135-136"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-136"></a>   <span class="co">##          40          41          42          43          44          45 </span></span>
<span id="cb135-137"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-137"></a>   <span class="co">## -0.03566782 -0.02772589         NaN         NaN         NaN         NaN</span></span>
<span id="cb135-138"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-138"></a>   <span class="st">```</span></span>
<span id="cb135-139"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-139"></a><span class="dt">   </span></span>
<span id="cb135-140"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-140"></a><span class="dt">   </span><span class="st">```</span>r</span>
<span id="cb135-141"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-141"></a>   observed_change_<span class="dv">25</span> &lt;-<span class="st"> </span><span class="op">-</span>shift.t.prime<span class="op">*</span>asfr_observed_prime[,<span class="dv">25</span>]<span class="op">/</span><span class="kw">t</span>(asfr_observed)[,<span class="dv">25</span>] <span class="op">-</span><span class="st"> </span>shift.t.prime<span class="fl">.2</span><span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>shift.t.prime)</span>
<span id="cb135-142"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-142"></a>   original_change_<span class="dv">25</span> &lt;-<span class="st"> </span><span class="kw">center.diff</span>(<span class="kw">log</span>(<span class="kw">t</span>(asfr_original)[,<span class="dv">25</span>]))</span>
<span id="cb135-143"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-143"></a>   </span>
<span id="cb135-144"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-144"></a>   <span class="kw">plot</span>(observed_change_<span class="dv">25</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb135-145"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-145"></a>   <span class="kw">lines</span>(original_change_<span class="dv">25</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb135-146"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-146"></a>   </span>
<span id="cb135-147"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-147"></a>    <span class="kw">plot</span>(observed_change[,<span class="dv">25</span>], <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb135-148"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-148"></a>   <span class="kw">lines</span>(original_change[,<span class="dv">25</span>], <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)  </span>
<span id="cb135-149"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-149"></a>   <span class="st">```</span></span>
<span id="cb135-150"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-150"></a><span class="dt">   </span></span>
<span id="cb135-151"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-151"></a><span class="dt">   &lt;img src=&quot;bookdown-demo_files/figure-html/unnamed-chunk-101-3.png&quot; width=&quot;672&quot; /&gt;</span></span>
<span id="cb135-152"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-152"></a></span>
<span id="cb135-153"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-153"></a></span>
<span id="cb135-154"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-154"></a><span class="dt">&lt;!--chapter:end:06-tempo.Rmd--&gt;</span></span>
<span id="cb135-155"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-155"></a></span>
<span id="cb135-156"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-156"></a></span>
<span id="cb135-157"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-157"></a></span>
<span id="cb135-158"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-158"></a><span class="dt"># Branching Processes </span></span>
<span id="cb135-159"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-159"></a></span>
<span id="cb135-160"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-160"></a><span class="dt">## Outline </span></span>
<span id="cb135-161"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-161"></a><span class="dt"> </span></span>
<span id="cb135-162"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-162"></a><span class="dt">- The Galton-Watson-Bienaym</span><span class="ch">\&#39;</span><span class="dt">e Process: Motivation</span></span>
<span id="cb135-163"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-163"></a><span class="dt">- Simulating a branching process</span></span>
<span id="cb135-164"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-164"></a><span class="dt">- Moment generating functions</span></span>
<span id="cb135-165"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-165"></a><span class="dt">- Extinction probabilities</span></span>
<span id="cb135-166"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-166"></a><span class="dt">- The distribution of offspring of all generations</span></span>
<span id="cb135-167"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-167"></a><span class="dt">- A tractable offspring distribution</span></span>
<span id="cb135-168"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-168"></a><span class="dt"> </span></span>
<span id="cb135-169"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-169"></a><span class="dt">Additional resources:</span></span>
<span id="cb135-170"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-170"></a></span>
<span id="cb135-171"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-171"></a><span class="dt">- @grinstead2006: An intermediate/advanced undergraduate textbook with good section on Branching Processes, with references to Harris and Keyﬁtz below.</span></span>
<span id="cb135-172"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-172"></a><span class="dt"> </span></span>
<span id="cb135-173"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-173"></a><span class="dt">- @harris1964theory: Classic reference, but readable if you take your time. We will only read chapter 1 and will only consider the very easiest material.</span></span>
<span id="cb135-174"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-174"></a><span class="dt"> </span></span>
<span id="cb135-175"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-175"></a><span class="dt">- Surname Extinction: When will we all be &quot;Smiths&quot;?_ &lt;https://www.youtube.com/watch?v=5p-Jdjo7sSQ&gt;: Popular science video providing good motivation, but without authority.</span></span>
<span id="cb135-176"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-176"></a></span>
<span id="cb135-177"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-177"></a><span class="dt">- _Is Your Surname about to Go Extinct?_ &lt;https://blogs.ancestry.com/cm/is-your-rare-surname-about-to-go-extinct/&gt;:A brief blog entry, mentionng of &quot;endangered names&quot;.</span></span>
<span id="cb135-178"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-178"></a></span>
<span id="cb135-179"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-179"></a><span class="dt">- @keyfitz1968: Another introduction to branching process with the details of the empirical example cited by Grinstead and Snell.</span></span>
<span id="cb135-180"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-180"></a></span>
<span id="cb135-181"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-181"></a><span class="dt">- @hellewell2020feasibility: An interesting application to COVID-19</span></span>
<span id="cb135-182"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-182"></a></span>
<span id="cb135-183"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-183"></a><span class="dt">## Motivation</span></span>
<span id="cb135-184"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-184"></a></span>
<span id="cb135-185"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-185"></a><span class="dt">- Until now, we&#39;ve focused on the hidden structures of heterogeneity.</span></span>
<span id="cb135-186"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-186"></a><span class="dt">- Now, we&#39;re switching gears:</span></span>
<span id="cb135-187"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-187"></a><span class="dt"> - Stochastic not deterministic</span></span>
<span id="cb135-188"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-188"></a><span class="dt"> - In small populations, randomness matters. (Even when risks are homogeneous.)</span></span>
<span id="cb135-189"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-189"></a><span class="dt"> - We will look at branching processes (&quot;parents producing children&quot;), next Fisher-Wright (&quot;children choosing parents&quot;), and then historical reconstruction from contemporary diversity (&quot;coalescent&quot;).</span></span>
<span id="cb135-190"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-190"></a></span>
<span id="cb135-191"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-191"></a><span class="dt">### Very brief history of Branching Processes </span></span>
<span id="cb135-192"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-192"></a><span class="dt"> </span></span>
<span id="cb135-193"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-193"></a><span class="dt">- Bienaymé&#39;s lost notes</span></span>
<span id="cb135-194"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-194"></a><span class="dt">- Old motivation: Galton and Watson&#39;s: to see if elites were dying out because of &quot;degeneration&quot; </span></span>
<span id="cb135-195"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-195"></a><span class="dt">- Contemporary motivation: evolution and neutral genetic change. What is the chance that a mutant will survive?</span></span>
<span id="cb135-196"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-196"></a><span class="dt">- War-time motivation: to see how to build the bomb (chain reactions)</span></span>
<span id="cb135-197"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-197"></a><span class="dt">- Sociological: Anywhere &quot;incipient dynamics&quot; matter (will all of S. Korea be &quot;Kim&quot;?)</span></span>
<span id="cb135-198"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-198"></a><span class="dt">- Can we get variance of reproductive success from name disambiguation?</span></span>
<span id="cb135-199"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-199"></a><span class="dt">- It will give us a headstart on other (less realistic but easier) &quot;drift&quot; models.</span></span>
<span id="cb135-200"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-200"></a><span class="dt"> </span></span>
<span id="cb135-201"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-201"></a><span class="dt">### Applicability to the Coronavirus? Yes and no.</span></span>
<span id="cb135-202"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-202"></a></span>
<span id="cb135-203"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-203"></a><span class="dt">- Perhaps the beginning, with first few cases.</span></span>
<span id="cb135-204"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-204"></a><span class="dt">- But once scale gets large, we&#39;ll see that deterministic dynamics take over.</span></span>
<span id="cb135-205"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-205"></a><span class="dt">- One lesson: beyond $R_0$.</span></span>
<span id="cb135-206"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-206"></a><span class="dt"> </span></span>
<span id="cb135-207"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-207"></a><span class="dt">### Simulated examples and the questions they raise</span></span>
<span id="cb135-208"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-208"></a></span>
<span id="cb135-209"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-209"></a><span class="dt"> Here are the chances, $p_k$, that the first carrier passes on the virus to $k$</span></span>
<span id="cb135-210"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-210"></a><span class="dt"> people</span></span>
<span id="cb135-211"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-211"></a><span class="dt"> </span></span>
<span id="cb135-212"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-212"></a></span>
<span id="cb135-213"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-213"></a><span class="st">```</span>r</span>
<span id="cb135-214"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-214"></a><span class="kw">library</span>(kableExtra)</span>
<span id="cb135-215"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-215"></a>table &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="kw">c</span>(.<span class="dv">3</span>,.<span class="dv">4</span>,.<span class="dv">3</span>))</span>
<span id="cb135-216"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-216"></a> knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb135-217"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-217"></a> table,</span>
<span id="cb135-218"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-218"></a> <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&#39;$k$&#39;</span>, <span class="st">&#39;$p_k$&#39;</span>))<span class="op">%&gt;%</span></span>
<span id="cb135-219"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb135-219"></a><span class="st"> </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F) </span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
<span class="math inline">\(k\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(p_k\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
</tbody>
</table>
<ul>
<li><p>What is <span class="math inline">\(R_0\)</span>, (aka <span class="math inline">\(m\)</span>)? This is the expected number of infected cases:
<span class="math display">\[\begin{aligned}
R_{0} &amp; = 0\times 0.3 + 1\times 0.4 + 2\times 0.3 \\
&amp; = 1 
\end{aligned}\]</span> <strong>NOTE: is this correct?</strong></p></li>
<li><p>Now assume that people will infect <span class="math inline">\(k\)</span> other people based on a random number, for instance the last 4 digits of their phone number.</p></li>
</ul>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb136-1"></a>  knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb136-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb136-2"></a>  <span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="kw">c</span>(.<span class="dv">3</span>,.<span class="dv">4</span>,.<span class="dv">3</span>),<span class="kw">c</span>(<span class="st">&quot;0-2&quot;</span>, <span class="st">&quot;3-5&quot;</span>, <span class="st">&quot;6-9&quot;</span>)),</span>
<span id="cb136-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb136-3"></a>  <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&#39;$k$&#39;</span>, <span class="st">&#39;$p_k$&#39;</span>, <span class="st">&#39;digits&#39;</span>)</span>
<span id="cb136-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb136-4"></a>) <span class="op">%&gt;%</span></span>
<span id="cb136-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb136-5"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
<span class="math inline">\(k\)</span>
</th>
<th style="text-align:left;">
<span class="math inline">\(p_k\)</span>
</th>
<th style="text-align:left;">
digits
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0.3
</td>
<td style="text-align:left;">
0-2
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0.4
</td>
<td style="text-align:left;">
3-5
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
0.3
</td>
<td style="text-align:left;">
6-9
</td>
</tr>
</tbody>
</table>
<ul>
<li>Let’s diagram one chance outcome, using my number “(xxx) xxx-9056”.
<ul>
<li>As each of the four digits is associated with a probability of infecting more people, they can be seen as different the carrier generations.</li>
<li>For instance, the first carrier has a probability <span class="math inline">\(p_k=0.3\)</span> of infecting <span class="math inline">\(k=2\)</span> other people. So that first carrier may infect 2.7 people, (3 for simplicity).</li>
<li>Each of these three people will have a <span class="math inline">\(p_k=0.2\)</span> of each infecting <span class="math inline">\(k=0\)</span> people. Since they don’t infect anybody then there are no further carrier generations.</li>
</ul></li>
</ul>
<p>In the table, we include their rows but the expected number of infected people is still 0 because the spreading stopped in generation 2.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb137-1"></a>  knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb137-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb137-2"></a>  <span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),<span class="kw">c</span>(<span class="dv">9</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">6</span>),<span class="kw">c</span>(<span class="fl">0.3</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>), <span class="kw">c</span>(<span class="st">&quot;$2 </span><span class="ch">\\</span><span class="st">times 0.3 = 2.7$&quot;</span>, <span class="st">&quot;$0 </span><span class="ch">\\</span><span class="st">times 0.3 = 0$&quot;</span>, <span class="st">&quot;$0$&quot;</span>,<span class="st">&quot;$0$&quot;</span>)),</span>
<span id="cb137-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb137-3"></a>  <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&#39;carrier generation #&#39;</span>, <span class="st">&#39;random digit&#39;</span>, <span class="st">&#39;$p_k$&#39;</span>, <span class="st">&#39;expected # infected&#39;</span>), <span class="dt">align=</span><span class="st">&quot;cccl&quot;</span></span>
<span id="cb137-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb137-4"></a>) <span class="op">%&gt;%</span></span>
<span id="cb137-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb137-5"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
carrier generation #
</th>
<th style="text-align:center;">
random digit
</th>
<th style="text-align:center;">
<span class="math inline">\(p_k\)</span>
</th>
<th style="text-align:left;">
expected # infected
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
0.3
</td>
<td style="text-align:left;">
<span class="math inline">\(2 \times 0.3 = 2.7\)</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.2
</td>
<td style="text-align:left;">
<span class="math inline">\(0 \times 0.3 = 0\)</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
0.4
</td>
<td style="text-align:left;">
<span class="math inline">\(0\)</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
0.4
</td>
<td style="text-align:left;">
<span class="math inline">\(0\)</span>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE: does this sound reasonable? </strong></p>
<div id="what-is-a-bienayme-galton-watson-branching-process" class="section level3">
<h3><span class="header-section-number">7.8.1</span> What is a (Bienayme)-Galton-Watson branching process?</h3>
<ul>
<li><span class="math inline">\(p_k\)</span>: Each individual in each generation reproduces independently, following same offspring distribution, with <span class="math inline">\(p_k\)</span> as the probability of having <span class="math inline">\(k\)</span> offspring.</li>
<li><span class="math inline">\(Z_n\)</span>: The si<span class="math inline">\(Z\)</span>e of the <span class="math inline">\(n\)</span>’th generation <span class="math inline">\(Z_n\)</span>. (<span class="math inline">\(Z_1 \equiv 1\)</span>)</li>
<li><span class="math inline">\(p_0 &gt; 0\)</span>: Some non-zero probability of no children.</li>
<li>Variance: None of the <span class="math inline">\(p_k\)</span> are 1</li>
</ul>
<div class="figure">
<img src="images/galton.png" alt="" />
<p class="caption">Galton’s original question</p>
</div>
<p>Some questions</p>
<ul>
<li>What is the chance <span class="math inline">\(d\)</span> of eventual extinction (no “outbreak”)?</li>
<li>Or, what is the distribution of surviving family sizes?</li>
<li>What are the aggregate properties of many branching processes? (Mean growth, variance, time-paths, eventual size)?</li>
</ul>
</div>
</div>
<div id="simulations-of-parents-having-children" class="section level2">
<h2><span class="header-section-number">7.9</span> Simulations of parents having children</h2>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb138-1"></a>  k =<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">2</span> <span class="co">#number of possible children</span></span>
<span id="cb138-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb138-2"></a>  p0 =<span class="st"> </span><span class="fl">.3</span>; p1 =<span class="st"> </span><span class="fl">.3</span>; p2 =<span class="st"> </span><span class="fl">.4</span>; </span>
<span id="cb138-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb138-3"></a>  p_k =<span class="st"> </span><span class="kw">c</span>(p0, p1, p2)  <span class="co">#probabilities of having k children</span></span>
<span id="cb138-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb138-4"></a>  Z1 =<span class="st"> </span><span class="dv">1</span>               <span class="co">#initial cohort size</span></span>
<span id="cb138-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb138-5"></a>  <span class="kw">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb138-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb138-6"></a>  kids.of.Z1 =<span class="st"> </span><span class="kw">sample</span>(<span class="dt">x =</span> k, <span class="dt">size =</span> Z1, <span class="dt">replace =</span> T, <span class="dt">prob =</span> p_k)</span>
<span id="cb138-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb138-7"></a>  Z2 =<span class="st"> </span><span class="kw">sum</span>(kids.of.Z1)</span>
<span id="cb138-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb138-8"></a>  kids.of.Z2 =<span class="st"> </span><span class="kw">sample</span>(<span class="dt">x =</span> k, <span class="dt">size =</span> Z2, <span class="dt">replace =</span> T, <span class="dt">prob =</span> p_k)</span>
<span id="cb138-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb138-9"></a>  Z3 =<span class="st"> </span><span class="kw">sum</span>(kids.of.Z2)</span>
<span id="cb138-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb138-10"></a>  kids.of.Z3 =<span class="st"> </span><span class="kw">sample</span>(<span class="dt">x =</span> k, <span class="dt">size =</span> Z3, <span class="dt">replace =</span> T, <span class="dt">prob =</span> p_k)</span>
<span id="cb138-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb138-11"></a>  Z4 =<span class="st"> </span><span class="kw">sum</span>(kids.of.Z3)</span></code></pre></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-1"></a>  gen_size &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(Z1, <span class="dv">1</span>), <span class="kw">rep</span>(Z2, Z2), <span class="kw">rep</span>(Z3, Z3), <span class="kw">rep</span>(Z4, Z4))</span>
<span id="cb139-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-2"></a>  gen &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="kw">rep</span>(<span class="dv">2</span>, Z2), <span class="kw">rep</span>(<span class="dv">3</span>, Z3), <span class="kw">rep</span>(<span class="dv">4</span>, Z4))</span>
<span id="cb139-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-3"></a>  person &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">seq</span>(<span class="fl">2.1</span>,<span class="dt">by=</span><span class="fl">0.1</span>, <span class="dt">to=</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Z2<span class="op">*</span><span class="fl">0.1</span>), </span>
<span id="cb139-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-4"></a>              <span class="kw">seq</span>(<span class="fl">3.1</span>,<span class="dt">by=</span><span class="fl">0.1</span>, <span class="dt">to=</span><span class="dv">3</span> <span class="op">+</span>Z3<span class="op">*</span><span class="fl">0.1</span>),</span>
<span id="cb139-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-5"></a>              <span class="kw">seq</span>(<span class="fl">4.1</span>,<span class="dt">by=</span><span class="fl">0.1</span>, <span class="dt">to=</span><span class="dv">4</span> <span class="op">+</span>Z4<span class="op">*</span><span class="fl">0.1</span>))</span>
<span id="cb139-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-6"></a>  total_children &lt;-<span class="st"> </span><span class="kw">c</span>(kids.of.Z1, kids.of.Z2, kids.of.Z3, <span class="kw">rep</span>(<span class="dv">0</span>, Z4))</span>
<span id="cb139-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-7"></a></span>
<span id="cb139-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-8"></a>  <span class="kw">library</span>(tidyverse)</span>
<span id="cb139-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-9"></a>  growth &lt;-<span class="st"> </span><span class="kw">tibble</span>(gen, person, total_children, gen_size)</span>
<span id="cb139-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-10"></a>  <span class="kw">names</span>(growth) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Generation #&quot;</span>, <span class="st">&quot;Person ID&quot;</span>, <span class="st">&quot;Total children&quot;</span>, <span class="st">&quot;Generation size&quot;</span>)</span>
<span id="cb139-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-11"></a>  knitr<span class="op">::</span><span class="kw">kable</span>(growth)<span class="op">%&gt;%</span></span>
<span id="cb139-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb139-12"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
Generation #
</th>
<th style="text-align:right;">
Person ID
</th>
<th style="text-align:right;">
Total children
</th>
<th style="text-align:right;">
Generation size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3.2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3.3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
</tr>
</tbody>
</table>
<ul>
<li>Here’s a more visual representation.</li>
</ul>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb140-1"></a><span class="co"># install.packages(&#39;DiagrammeR&#39;)</span></span>
<span id="cb140-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb140-2"></a>DiagrammeR<span class="op">::</span><span class="kw">grViz</span>(<span class="st">&quot;</span></span>
<span id="cb140-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb140-3"></a><span class="st">                  digraph rmarkdown{</span></span>
<span id="cb140-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb140-4"></a><span class="st">                  1 -&gt;{2.1 2.2}</span></span>
<span id="cb140-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb140-5"></a><span class="st">                  2.1-&gt;{3.1 3.2}</span></span>
<span id="cb140-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb140-6"></a><span class="st">                  2.2-&gt;{3.3 3.4}</span></span>
<span id="cb140-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb140-7"></a><span class="st">                  3.1-&gt;{4.1 4.2}</span></span>
<span id="cb140-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb140-8"></a><span class="st">                  3.2-&gt;{4.3}</span></span>
<span id="cb140-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb140-9"></a><span class="st">                  3.3-&gt;{4.4 4.5}</span></span>
<span id="cb140-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb140-10"></a><span class="st">                  3.4-&gt;{4.6 4.7}</span></span>
<span id="cb140-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb140-11"></a><span class="st">                  }&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-108"></span>
<div id="htmlwidget-245848e5aa82ca106ea8" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-245848e5aa82ca106ea8">{"x":{"diagram":"\n                  digraph rmarkdown{\n                  1 ->{2.1 2.2}\n                  2.1->{3.1 3.2}\n                  2.2->{3.3 3.4}\n                  3.1->{4.1 4.2}\n                  3.2->{4.3}\n                  3.3->{4.4 4.5}\n                  3.4->{4.6 4.7}\n                  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 7.9: Parents having childrens
</p>
</div>
<ul>
<li>However, we can extend the number of generations in a function:</li>
</ul>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-1"></a>  <span class="co">#A function   </span></span>
<span id="cb141-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-2"></a>  branch &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n_max =</span> <span class="dv">30</span>, <span class="dt">pk =</span> <span class="kw">c</span>(p0, p1, p2), <span class="dt">Z1 =</span> <span class="dv">1</span>)</span>
<span id="cb141-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-3"></a>  {</span>
<span id="cb141-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-4"></a>      Z.vec &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, n_max) <span class="co"># n_max handles the total number of generations</span></span>
<span id="cb141-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-5"></a>      Z.vec[<span class="dv">1</span>] &lt;-<span class="st"> </span>Z1</span>
<span id="cb141-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-6"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(n_max<span class="dv">-1</span>))</span>
<span id="cb141-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-7"></a>      {</span>
<span id="cb141-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-8"></a>          Z.vec[i<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">sample</span>(<span class="dt">x =</span> k,</span>
<span id="cb141-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-9"></a>                                   <span class="dt">size =</span> Z.vec[i],</span>
<span id="cb141-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-10"></a>                                   <span class="dt">replace =</span> T,</span>
<span id="cb141-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-11"></a>                                   <span class="dt">prob =</span> p_k))</span>
<span id="cb141-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-12"></a>      }</span>
<span id="cb141-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-13"></a>      <span class="kw">return</span>(Z.vec) <span class="co"># returns a vector of the number of children at every generation</span></span>
<span id="cb141-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb141-14"></a>  }</span></code></pre></div>
<ul>
<li>Sometimes generations die out:</li>
</ul>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb142-1"></a>  <span class="kw">set.seed</span>(<span class="dv">19</span>) ; <span class="kw">branch</span>()</span></code></pre></div>
<pre><code>##  [1] 1 2 2 4 5 2 2 3 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb144-1"></a>  <span class="kw">set.seed</span>(<span class="dv">99</span>) ; <span class="kw">branch</span>()</span></code></pre></div>
<pre><code>##  [1] 1 1 2 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</code></pre>
<ul>
<li>Let’s see what happens with 20 trials (up to 30 generations). Not all generations go extinct here.</li>
</ul>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb146-1"></a>  n_trials =<span class="st"> </span><span class="dv">20</span></span>
<span id="cb146-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb146-2"></a>  n_gen =<span class="st"> </span><span class="dv">30</span></span>
<span id="cb146-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb146-3"></a>  k =<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">2</span> <span class="co">#number of possible children</span></span>
<span id="cb146-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb146-4"></a>  p0 =<span class="st"> </span><span class="fl">.3</span>; p1 =<span class="st"> </span><span class="fl">.3</span>; p2 =<span class="st"> </span><span class="fl">.4</span>; </span>
<span id="cb146-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb146-5"></a>  p_k =<span class="st"> </span><span class="kw">c</span>(p0, p1, p2)  <span class="co">#probabilities of having k children</span></span>
<span id="cb146-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb146-6"></a>  Z1 =<span class="st"> </span><span class="dv">1</span>               <span class="co">#initial cohort size</span></span>
<span id="cb146-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb146-7"></a>  </span>
<span id="cb146-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb146-8"></a>  Z.mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, n_trials, n_gen)</span>
<span id="cb146-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb146-9"></a>  <span class="kw">set.seed</span>(<span class="dv">131</span>) </span>
<span id="cb146-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb146-10"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_trials)</span>
<span id="cb146-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb146-11"></a>      Z.mat[i,] &lt;-<span class="st"> </span><span class="kw">branch</span>(<span class="dt">n_max =</span> n_gen)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-112"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-112-1.png" alt="Generation size" width="672" />
<p class="caption">
Figure 7.10: Generation size
</p>
</div>
<ul>
<li>How many survive (out of 20)? log-scale</li>
</ul>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb147-1"></a>  <span class="kw">suppressWarnings</span>(<span class="kw">matplot</span>(<span class="kw">t</span>(Z.mat), <span class="dt">log =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">ylab =</span> <span class="st">&quot;Zn&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;n&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-113"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-113-1.png" alt="Generation sizes (log-scale)" width="672" />
<p class="caption">
Figure 7.11: Generation sizes (log-scale)
</p>
</div>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb148-1"></a>  surviving =<span class="st"> </span><span class="kw">ifelse</span>(Z.mat[,n_gen] <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;extinct&quot;</span>, <span class="st">&quot;survive&quot;</span>)</span>
<span id="cb148-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb148-2"></a>  foo &lt;-<span class="st"> </span><span class="kw">prop.table</span>(<span class="kw">table</span>(surviving))</span>
<span id="cb148-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb148-3"></a>  <span class="kw">print</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(surviving)) )</span></code></pre></div>
<pre><code>## surviving
## extinct survive 
##     0.5     0.5</code></pre>
<ul>
<li>How would you describe the time path of the surviving lines? Let’s extend the number of generations to observe any long-term trends.</li>
</ul>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb150-1"></a>  n_trials =<span class="st"> </span><span class="dv">20</span>; n_gen =<span class="st"> </span><span class="dv">100</span></span>
<span id="cb150-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb150-2"></a>  Z.mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, n_trials, n_gen)</span>
<span id="cb150-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb150-3"></a>  <span class="kw">set.seed</span>(<span class="dv">131</span>) </span>
<span id="cb150-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb150-4"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_trials)</span>
<span id="cb150-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb150-5"></a>      Z.mat[i,] &lt;-<span class="st"> </span><span class="kw">branch</span>(<span class="dt">n_max =</span> n_gen)</span></code></pre></div>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb151-1"></a>  <span class="kw">suppressWarnings</span>(<span class="kw">matplot</span>(<span class="kw">t</span>(Z.mat), <span class="dt">log =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">ylab =</span> <span class="st">&quot;Zn&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;n&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-115"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-115-1.png" alt="Generation sizes (log-scale) over many generations" width="672" />
<p class="caption">
Figure 7.12: Generation sizes (log-scale) over many generations
</p>
</div>
<ul>
<li>What does this remind you of? (Hint: “Leslie”). (See <span class="citation">Harris (<a href="#ref-harris1964theory" role="doc-biblioref">1964</a>)</span>, Figure 2, Chapter 1)</li>
</ul>
</div>
<div id="the-probability-generating-function-our-mathematical-tool" class="section level2">
<h2><span class="header-section-number">7.10</span> The Probability Generating Function: Our mathematical tool</h2>
<ul>
<li><p>“Extinction” vs “breakout”</p>
<ul>
<li>We see that in a super-critical (<span class="math inline">\(m &gt; 1\)</span>) branching process, if a line can survive a few generations and reach a large enough size, it will grow exponentially.</li>
<li>What happens if <span class="math inline">\(m &lt; 1\)</span>, if <span class="math inline">\(m = 1\)</span>? Discuss.
<span class="math display">\[
h(z) = p_0 + p_1 z + p_2 z^2 + \ldots
\]</span></li>
<li>The PGF “keeps book” on the probabilities. The chance of <span class="math inline">\(k\)</span> is the coefficient on <span class="math inline">\(z^k\)</span>.
<ul>
<li><span class="math inline">\(h(0)= p_{0}\)</span><br />
</li>
<li><span class="math inline">\(h(1)= p_{0} + p_{1}\)</span><br />
</li>
<li><span class="math inline">\(h&#39;(1)= p_{1} + 2p_{2}\)</span></li>
</ul></li>
<li>The story of two brothers. A father has two sons. The probability generating function of their children combined is:
<span class="math display">\[
h(z)^2 = (p_0  + p_1 z + p_2 z^2) \times (p_0  + p_1 z + p_2 z^2)
\]</span>
<ul>
<li>If we multiply it out we get:
<span class="math display">\[
 \begin{aligned}
 \left[h(z)\right]^2  = &amp; p_0^2  + p_0 p_1 z + p_0 p_2 z^2 +\\
 &amp; p_1 z p_0 + p_1^2 z^2 + p_1 p_2 z^3 + \\
 &amp; p_2 z^2 p_0 + p_2 z^3 p_1 + p_2^2 z^4 \\
 &amp; = p_0^2 + (2p_0 p_1 )z + (2p_0 p_2 + p_1^2)z^2 + (2p_1 p_2)z^3 + p_2^2 z^4
 \end{aligned}
 \]</span></li>
</ul></li>
</ul></li>
<li><p>The coefficients on <span class="math inline">\(z^0, z^1, \ldots\)</span> tell us the probability that the sons will have <span class="math inline">\(k=0,1,2,3,4\)</span> sons.</p></li>
<li><p>What is the probability generating function for the distribution of grandsons?</p>
<ul>
<li>A man has two sons, with probability <span class="math inline">\(p_2\)</span>, so PGF in that case is <span class="math inline">\(p_2 [h(z)]^2\)</span>.</li>
<li>But let’s sum over all possible numbers of sons.
<span class="math display">\[
p_0 + p_1 h(z) + p_2 [h(z)]^2 + p_3 [h(z)]^3 + \ldots
\]</span></li>
<li>This is the cumulative probability of drawing <span class="math inline">\(k\)</span> children within a generation of size <span class="math inline">\(Z\)</span></li>
<li>Which is?
<span class="math display">\[
h(h(z))
\]</span></li>
<li>Can show PGF for the n’th generation is
<span class="math display">\[
h(h(h ... \mbox{$n$ \times}  h(z)))  = h_n(z)
\]</span></li>
<li>For instance, let’s get <span class="math inline">\(h_2(z) = h(h(z))\)</span> for <span class="math inline">\(h(z) = p_0 + p_1 z + p_2 z^2\)</span>
<span class="math display">\[\begin{aligned}
h(h(z)) = &amp;  p_0 + p_1 \left[p_0 + p_1 z + p_2 z^2\right] + p_2 \left[p_0 + p_1 z + p_2 z^2\right]^2\\
 = &amp;  p_0 + p_1 p_0 + p_1^2 z + p_1 p_2 z^2 + p_2p_0^2 + (2p_0 p_1 p_2)z +\\ (2p_0 p_2^2 + p_2p_1^2)z^2 + (2p_1 p_2^2)z^3 + p_2^3 z^4
\end{aligned}\]</span></li>
</ul></li>
</ul>
</div>
<div id="extinction" class="section level2">
<h2><span class="header-section-number">7.11</span> Extinction</h2>
<ul>
<li><p>Extinction</p>
<ul>
<li>“Extinction is forever.”: So, the probability <span class="math inline">\(d_n\)</span> of extinction <em>by</em> generation <span class="math inline">\(n\)</span> can never decline over time. (Must it
always rise?)</li>
</ul></li>
<li><p>Recursive extinction</p>
<ul>
<li>Is non-extinction “forever”?: If <span class="math inline">\(\lim_{n \rightarrow \infty} = d(\infty) &lt; 1\)</span>, then this says there’s a chance <span class="math inline">\(1 - d(\infty)\)</span> of eternal persistence. We’ll try to figure out more about what this means.</li>
</ul></li>
<li><p>If the probability of a female line going extinct in <span class="math inline">\(n\)</span> generations is <span class="math inline">\(d_n\)</span>, then this is equivalent to her daughter(s) line(s) going extinct in <span class="math inline">\(n-1\)</span> generations. With <span class="math inline">\(p_k\)</span> chance of having <span class="math inline">\(k\)</span> daughters, we have
<span class="math display">\[
d_n = p_0 + p_1 d_{n-1} + \mbox{What is next term in series?}
\]</span></p>
<ul>
<li><p>What can we do with
<span class="math display">\[
d_n = h(d_{n-1})?
\]</span></p></li>
<li><p>Well, remember that <span class="math inline">\(d_n\)</span> is non-decreasing, and that it’s maximum can be no greater than <span class="math inline">\(1.0\)</span>. When <span class="math inline">\(d_n\)</span> reaches it’s limit, say <span class="math inline">\(d\)</span>, we won’t need generational subscripts, <span class="math inline">\(d\)</span> will be constant, and will obey
<span class="math display">\[
d = h(d)
\]</span></p></li>
<li><p>Thus, an amazing result: the probability of ultimate extinction is when the argument equals the PGF of the argument.</p></li>
</ul></li>
<li><p>Can <span class="math inline">\(d = 1\)</span>, can <span class="math inline">\(d &lt; 1\)</span></p>
<ul>
<li>Try <span class="math inline">\(d = 1\)</span>. What happens?</li>
<li>If we were to find a solution less than 1.0, how would we
interpret that?</li>
<li>Three cases</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-1"></a>  z =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">1.6</span>, <span class="fl">.01</span>)</span>
<span id="cb152-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-2"></a>  pk =<span class="st"> </span><span class="kw">c</span>(.<span class="dv">3</span>, <span class="fl">.0</span>, <span class="fl">.7</span>); <span class="kw">names</span>(pk) &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">2</span></span>
<span id="cb152-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-3"></a>  d &lt;-<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>]</span>
<span id="cb152-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-4"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb152-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-5"></a>  {</span>
<span id="cb152-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-6"></a>      d &lt;-<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>]  <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;1&quot;</span>]<span class="op">*</span>d <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;2&quot;</span>]<span class="op">*</span>d<span class="op">^</span><span class="dv">2</span></span>
<span id="cb152-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-7"></a>  }</span>
<span id="cb152-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-8"></a>  <span class="co">##  super-critical </span></span>
<span id="cb152-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-9"></a>  hz =<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>]  <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;1&quot;</span>]<span class="op">*</span>z <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;2&quot;</span>]<span class="op">*</span>z<span class="op">^</span><span class="dv">2</span></span>
<span id="cb152-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-10"></a>  plot.fun &lt;-<span class="st"> </span><span class="cf">function</span>(z, hz)</span>
<span id="cb152-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-11"></a>  {</span>
<span id="cb152-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-12"></a>      <span class="kw">plot</span>(z, hz, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.6</span>),</span>
<span id="cb152-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-13"></a>           <span class="dt">ylab =</span> <span class="st">&quot;h(z)&quot;</span>,</span>
<span id="cb152-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-14"></a>           <span class="dt">yaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="dt">xaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="dt">axes =</span> F)</span>
<span id="cb152-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-15"></a>      <span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">1.5</span>, <span class="fl">.5</span>))</span>
<span id="cb152-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-16"></a>      <span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">1.5</span>, <span class="fl">.5</span>))</span>
<span id="cb152-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-17"></a>      <span class="kw">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb152-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-18"></a>      <span class="kw">lines</span>(z, hz)</span>
<span id="cb152-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-19"></a>      <span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> pk[<span class="st">&quot;0&quot;</span>], <span class="dt">labels =</span> <span class="st">&quot;p0&quot;</span>,</span>
<span id="cb152-20"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-20"></a>           <span class="dt">col.axis =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb152-21"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-21"></a>           <span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">las =</span> <span class="dv">2</span>)</span>
<span id="cb152-22"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-22"></a>  }</span>
<span id="cb152-23"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-23"></a>  </span>
<span id="cb152-24"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-24"></a>  <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">pty =</span> <span class="st">&quot;s&quot;</span>)</span>
<span id="cb152-25"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-25"></a>  <span class="kw">plot.fun</span>(z,hz)</span>
<span id="cb152-26"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-26"></a>  <span class="kw">points</span>(<span class="kw">c</span>(d, <span class="dv">1</span>),<span class="kw">c</span>(d, <span class="dv">1</span>))</span>
<span id="cb152-27"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-27"></a>  <span class="kw">title</span>(<span class="st">&quot;Super-critical (m &gt; 1) </span><span class="ch">\n</span><span class="st"> 2 roots&quot;</span>)</span>
<span id="cb152-28"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-28"></a>  <span class="co">## sub-critical</span></span>
<span id="cb152-29"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-29"></a>  pk =<span class="st"> </span><span class="kw">c</span>(.<span class="dv">3</span>, <span class="fl">.55</span>, <span class="fl">.15</span>); <span class="kw">names</span>(pk) &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">2</span></span>
<span id="cb152-30"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-30"></a>  hz =<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>]  <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;1&quot;</span>]<span class="op">*</span>z <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;2&quot;</span>]<span class="op">*</span>z<span class="op">^</span><span class="dv">2</span></span>
<span id="cb152-31"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-31"></a>  <span class="kw">plot.fun</span>(z,hz)</span>
<span id="cb152-32"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-32"></a>  <span class="kw">title</span>(<span class="st">&quot;Sub-critical (m &lt; 1) </span><span class="ch">\n</span><span class="st"> 1 root&quot;</span>)</span>
<span id="cb152-33"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-33"></a>  <span class="kw">points</span>(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb152-34"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-34"></a>  <span class="co">## critical</span></span>
<span id="cb152-35"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-35"></a>  pk =<span class="st"> </span><span class="kw">c</span>(.<span class="dv">3</span>, <span class="fl">.4</span>, <span class="fl">.3</span>); <span class="kw">names</span>(pk) &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">2</span></span>
<span id="cb152-36"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-36"></a>  hz =<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>]  <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;1&quot;</span>]<span class="op">*</span>z <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;2&quot;</span>]<span class="op">*</span>z<span class="op">^</span><span class="dv">2</span></span>
<span id="cb152-37"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-37"></a>  <span class="kw">plot.fun</span>(z, hz)</span>
<span id="cb152-38"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-38"></a>  <span class="kw">title</span>(<span class="st">&quot;Critical (m = 1), </span><span class="ch">\n</span><span class="st"> 1 root&quot;</span>)</span>
<span id="cb152-39"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb152-39"></a>  <span class="kw">points</span>(<span class="dv">1</span>,<span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-116"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-116-1.png" alt="PGF for a variety of z" width="672" />
<p class="caption">
Figure 7.13: PGF for a variety of z
</p>
</div>
<ul>
<li><p>We can prove by answering: What is <span class="math inline">\(h&#39;(1)\)</span>? What is <span class="math inline">\(h(0)\)</span>? Is <span class="math inline">\(h&#39;&#39;(z) &gt; 0\)</span>?</p></li>
<li><p>In the following cobwed diagram (like a staircase), we can see the values of <span class="math inline">\(h(p_0)\)</span>, <span class="math inline">\(h(h(p_0))\)</span>, <span class="math inline">\(h(h(h(p_0)))\)</span>, <span class="math inline">\(\ldots\)</span>?</p>
<ul>
<li>The orange dot is <span class="math inline">\(h(p_0)\)</span>.</li>
<li>The purple dot is <span class="math inline">\(h(h(p_0))\)</span>.</li>
<li>The blue dot is <span class="math inline">\(h(h(h(p_0)))\)</span>.</li>
<li>The points would converge until we reach the intersection between <span class="math inline">\(h(z)\)</span> and the diagonal.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-1"></a>  pk =<span class="st"> </span><span class="kw">c</span>(.<span class="dv">3</span>, <span class="fl">.0</span>, <span class="fl">.7</span>); <span class="kw">names</span>(pk) &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">2</span></span>
<span id="cb153-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-2"></a>  z =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">1.6</span>, <span class="fl">.01</span>)</span>
<span id="cb153-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-3"></a>  hz =<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>]  <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;1&quot;</span>]<span class="op">*</span>z <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;2&quot;</span>]<span class="op">*</span>z<span class="op">^</span><span class="dv">2</span></span>
<span id="cb153-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-4"></a>  <span class="kw">plot.fun</span>(z,hz)</span>
<span id="cb153-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-5"></a>  hzp0 &lt;-<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>]  <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;1&quot;</span>]<span class="op">*</span>pk[<span class="st">&quot;0&quot;</span>] <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;2&quot;</span>]<span class="op">*</span>pk[<span class="st">&quot;0&quot;</span>]<span class="op">^</span><span class="dv">2</span></span>
<span id="cb153-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-6"></a>  hhzp0 &lt;-<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>]  <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;1&quot;</span>]<span class="op">*</span>hzp0 <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;2&quot;</span>]<span class="op">*</span>hzp0<span class="op">^</span><span class="dv">2</span></span>
<span id="cb153-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-7"></a>  hhhzp0 &lt;-<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>]  <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;1&quot;</span>]<span class="op">*</span>hhzp0 <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;2&quot;</span>]<span class="op">*</span>hhzp0<span class="op">^</span><span class="dv">2</span></span>
<span id="cb153-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-8"></a></span>
<span id="cb153-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-9"></a>  <span class="kw">segments</span>(<span class="dt">x0=</span><span class="dv">0</span>, <span class="dt">y0=</span>pk[<span class="st">&quot;0&quot;</span>],<span class="dt">x1=</span>pk[<span class="st">&quot;0&quot;</span>], <span class="dt">y1=</span> pk[<span class="st">&quot;0&quot;</span>], <span class="dt">col =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)<span class="co">#h(p_0)</span></span>
<span id="cb153-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-10"></a>  <span class="kw">segments</span>(<span class="dt">x0=</span>pk[<span class="st">&quot;0&quot;</span>], <span class="dt">y0=</span>pk[<span class="st">&quot;0&quot;</span>], <span class="dt">y1=</span> hzp0, <span class="dt">col =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb153-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-11"></a>  </span>
<span id="cb153-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-12"></a>  <span class="kw">segments</span>(<span class="dt">x0=</span>pk[<span class="st">&quot;0&quot;</span>], <span class="dt">y0=</span>hzp0,<span class="dt">x1=</span>hzp0, <span class="dt">y1=</span> hzp0, <span class="dt">col =</span> <span class="st">&quot;purple&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>) <span class="co">#h(h(p_0))</span></span>
<span id="cb153-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-13"></a>  <span class="kw">segments</span>(<span class="dt">x0=</span>hzp0, <span class="dt">y0=</span>hzp0, <span class="dt">y1=</span> hhzp0, <span class="dt">col =</span> <span class="st">&quot;purple&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb153-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-14"></a></span>
<span id="cb153-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-15"></a>  <span class="kw">segments</span>(<span class="dt">x0=</span>hzp0, <span class="dt">y0=</span>hhzp0,<span class="dt">x1=</span>hhzp0, <span class="dt">y1=</span> hhzp0, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb153-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-16"></a>  <span class="kw">segments</span>(<span class="dt">x0=</span>hhzp0, <span class="dt">y0=</span>hhzp0, <span class="dt">y1=</span> hhhzp0, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb153-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-17"></a>  </span>
<span id="cb153-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-18"></a>  <span class="kw">points</span>(<span class="dt">x=</span> pk[<span class="st">&quot;0&quot;</span>], <span class="dt">y =</span>hzp0, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;orange&quot;</span>) <span class="co">#h(p_0)</span></span>
<span id="cb153-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-19"></a>  <span class="kw">points</span>(<span class="dt">x=</span> hzp0, <span class="dt">y =</span>hhzp0, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;purple&quot;</span>) <span class="co">#h(h(p_0))</span></span>
<span id="cb153-20"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb153-20"></a>  <span class="kw">points</span>(<span class="dt">x=</span> hhzp0, <span class="dt">y =</span>hhhzp0, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>) <span class="co">#h(h(h(p_0)))</span></span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-117"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-117-1.png" alt="Cobwed diagram (staircase)" width="672" />
<p class="caption">
Figure 7.14: Cobwed diagram (staircase)
</p>
</div>
<ul>
<li>So how do we actually get <span class="math inline">\(d\)</span>?
<ul>
<li>Take the case where <span class="math inline">\(p_0 = .3\)</span>, <span class="math inline">\(p_1 = 0\)</span>, and <span class="math inline">\(p_3 = .7\)</span> (the one I just plotted).
<ul>
<li>Can do some algebra</li>
<li>Or we can recursively iterate on the computer.
<ul>
<li>Numerical recursion: below we start at the first value of the probability vector and sequentially try exploring values of <span class="math inline">\(h(z)\)</span> until we find one that doesn’t change as much. We illustrate the case for up to 20 iterations.</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb154-1"></a>  pk =<span class="st"> </span><span class="kw">c</span>(.<span class="dv">3</span>, <span class="fl">.0</span>, <span class="fl">.7</span>); <span class="kw">names</span>(pk) &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">2</span> <span class="co">## our example</span></span>
<span id="cb154-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb154-2"></a>  d &lt;-<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>] <span class="co"># initial value</span></span>
<span id="cb154-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb154-3"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>)</span>
<span id="cb154-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb154-4"></a>  {</span>
<span id="cb154-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb154-5"></a>      d &lt;-<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>]  <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;1&quot;</span>]<span class="op">*</span>d <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;2&quot;</span>]<span class="op">*</span>d<span class="op">^</span><span class="dv">2</span></span>
<span id="cb154-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb154-6"></a>      <span class="cf">if</span> (i <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">19</span>,<span class="dv">20</span>))</span>
<span id="cb154-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb154-7"></a>          <span class="kw">print</span>(<span class="kw">paste</span>(i, d))</span>
<span id="cb154-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb154-8"></a>  }</span></code></pre></div>
<pre><code>## [1] &quot;1 0.363&quot;
## [1] &quot;2 0.3922383&quot;
## [1] &quot;19 0.428565882081349&quot;
## [1] &quot;20 0.428568100698915&quot;</code></pre>
<p>Did we get the right value? Apparently, yes! The green lines take as vertical and horizontal values our <span class="math inline">\(d=0.428568100698915\)</span></p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb156-1"></a>  pk =<span class="st"> </span><span class="kw">c</span>(.<span class="dv">3</span>, <span class="fl">.0</span>, <span class="fl">.7</span>); <span class="kw">names</span>(pk) &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">2</span></span>
<span id="cb156-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb156-2"></a>  z =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">1.6</span>, <span class="fl">.01</span>)</span>
<span id="cb156-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb156-3"></a>  hz =<span class="st"> </span>pk[<span class="st">&quot;0&quot;</span>]  <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;1&quot;</span>]<span class="op">*</span>z <span class="op">+</span><span class="st"> </span>pk[<span class="st">&quot;2&quot;</span>]<span class="op">*</span>z<span class="op">^</span><span class="dv">2</span></span>
<span id="cb156-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb156-4"></a>  <span class="kw">plot.fun</span>(z,hz)</span>
<span id="cb156-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb156-5"></a>  <span class="kw">abline</span>(<span class="dt">h =</span> d, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb156-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb156-6"></a>  <span class="kw">abline</span>(<span class="dt">v =</span> d, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-119"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-119-1.png" alt="??" width="672" />
<p class="caption">
Figure 7.15: ??
</p>
</div>
<ul>
<li>Extinction and non-extinction revisited
<ul>
<li>If <span class="math inline">\(m &gt; 1\)</span>, there exists <span class="math inline">\(d\)</span> bigger than 0 and less than unity.</li>
<li>This means there’s some positive chance of extinction.</li>
<li>But also some chance of never-extinction. (What form does never-extinction take?)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb157-1"></a>    <span class="kw">suppressWarnings</span>(<span class="kw">matplot</span>(<span class="kw">t</span>(Z.mat), <span class="dt">log =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">ylab =</span> <span class="st">&quot;Zn&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;n&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-120"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-120-1.png" alt="Generation sizes (log-scale) over many generations" width="672" />
<p class="caption">
Figure 7.16: Generation sizes (log-scale) over many generations
</p>
</div>
<p>Relevance to Corona virus?</p>
</div>
<div id="good-and-bad-set-ups-for-branching-process" class="section level2">
<h2><span class="header-section-number">7.12</span> Good and bad set-ups for branching process</h2>
<style>
.column-left{
  float: left;
  width: 50%;
  text-align: left;
}
.column-right{
  float: right;
  width: 50%;
  text-align: left;
}
</style>
<div class="column-left">
<p><strong>Good</strong></p>
<ul>
<li><p>Unrestricted growth (frontier, new disease, start of a reaction)</p></li>
<li><p>A “null” model for understanding how apparent structure
is just random outcomes. Families that die out didn’t have to
have low <span class="math inline">\(NRR\)</span>. Just because most new viruses don’t break out,
doesn’t mean they aren’t potentially dangerous (<span class="math inline">\(R_0 &gt;&gt; 1.0\)</span>).</p></li>
<li><p>A model that corresponds our mental model of running a
generative process forward. (cf. Fisher-Wright)</p></li>
</ul>
</div>
<div class="column-right">
<p><strong>Bad</strong></p>
<ul>
<li><p>When offspring of 1 depends on offspring of other (e.g., brothers inheriting a farm)</p></li>
<li><p>When resource constraints slow growth rates (e.g.,
Malthus: fertility of next gen depends on fertility of last;
SIR model in disease spread)</p></li>
<li><p>Analysis. PGF is powerful but still we often have to deal
with listing all possibilities.</p></li>
<li><p>Big populations – law of large numbers means randomness
doesn’t matter.</p></li>
<li></li>
</ul>
</div>
</div>
<div id="the-distribution-of-offspring-of-all-generations" class="section level2">
<h2><span class="header-section-number">7.13</span> The distribution of offspring of all generations</h2>
<ul>
<li>Means of offspring in generation <span class="math inline">\(n\)</span>
<ul>
<li>Is it “meaningful”? It tells you about the average number of offspring but it might be a skewed distributions because of the large number of zeros.</li>
<li>We’ll show that unconditional mean is the expectation of random sum, which in this case is the expectation of a product.
<span class="math display">\[
\mathbb{E} Z_n = m^n
\]</span></li>
<li>What if <span class="math inline">\(m = 1\)</span>?</li>
</ul></li>
<li>Mean size of surviving lines?
<ul>
<li>Total probability is sum of conditional probabilities, times the chance of each condition:
<span class="math display">\[
\mathbb{E} Z_n = \mathbb{E}( Z_n | Z_n &gt; 0) P(Z_n &gt; 0) +
\mathbb{E}( Z_n | Z_n = 0) P(Z_n = 0)
\]</span></li>
<li>where <span class="math inline">\(\mathbb{E}( Z_n | Z_n &gt; 0) P(Z_n &gt; 0)\)</span> is the expected size given no extinction and <span class="math inline">\(\mathbb{E}( Z_n | Z_n = 0) P(Z_n = 0)\)</span> is the expected size given extinction.<br />
</li>
<li>What is mean size of surviving lines? That is, we want to find <span class="math inline">\(\mathbb{E}( Z_n | Z_n &gt; 0)\)</span>
<ul>
<li>Hint 1: <span class="math inline">\(P(Z_n = 0) = d_n\)</span>, So <span class="math inline">\(P(Z_n &gt; 0) = 1- d_n\)</span></li>
<li>Hint 2: <span class="math inline">\(\mathbb{E} Z_n = m^n\)</span></li>
</ul></li>
</ul></li>
</ul>
<p>Also note that by definition, <span class="math inline">\(\mathbb{E}( Z_n | Z_n = 0)=0\)</span></p>
<p><span class="math display">\[
      \begin{aligned}
      \mathbb{E} Z_n = m^n = &amp; \mathbb{E}( Z_n | Z_n &gt; 0) (1- d_n) + (0)d_n\\
      m^n = &amp; \mathbb{E}( Z_n | Z_n &gt; 0) (1- d_n)\\
      \mathbb{E}( Z_n | Z_n &gt; 0) =&amp;\frac{m^n}{(1- d_n)}
      \end{aligned}
      \]</span></p>
<ul>
<li>Let’s check our result using simulation for 1000 trials. Note that for this case <span class="math inline">\(m= 0\times p_0 + 1\times p_1 + 2\times p_2= 1\)</span>, so <span class="math inline">\(m^n= 1\)</span></li>
</ul>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb158-1"></a>  n_trials =<span class="st"> </span><span class="dv">1000</span>; n_gen =<span class="st"> </span><span class="dv">100</span></span>
<span id="cb158-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb158-2"></a>  p0 =<span class="st"> </span><span class="fl">.3</span>; p1 =<span class="st"> </span><span class="fl">.4</span>; p2 =<span class="st"> </span><span class="fl">.3</span> <span class="co">## what is m?</span></span>
<span id="cb158-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb158-3"></a>  p_k &lt;-<span class="st"> </span><span class="kw">c</span>(p0, p1, p2)</span>
<span id="cb158-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb158-4"></a>  k &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span>(<span class="kw">length</span>(p_k)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb158-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb158-5"></a>  Z.mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, n_trials, n_gen)</span>
<span id="cb158-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb158-6"></a>  <span class="kw">set.seed</span>(<span class="dv">131</span>)</span>
<span id="cb158-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb158-7"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_trials)</span>
<span id="cb158-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb158-8"></a>      Z.mat[i,] &lt;-<span class="st"> </span><span class="kw">branch</span>(<span class="dt">n_max =</span> n_gen)</span></code></pre></div>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb159-1"></a>Zn_bar =<span class="st"> </span><span class="kw">apply</span>(Z.mat, <span class="dv">2</span>, mean)</span>
<span id="cb159-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb159-2"></a>  <span class="kw">matplot</span>(<span class="kw">t</span>(Z.mat),</span>
<span id="cb159-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb159-3"></a>          <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">ylab =</span> <span class="st">&quot;Zn&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-122"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-122-1.png" alt="Extinction simulation" width="672" />
<p class="caption">
Figure 7.17: Extinction simulation
</p>
</div>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb160-1"></a>Zn_bar =<span class="st"> </span><span class="kw">apply</span>(Z.mat, <span class="dv">2</span>, mean)  <span class="co">#expected value Z_n (E(Z_n))</span></span>
<span id="cb160-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb160-2"></a>n &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(Z.mat)</span>
<span id="cb160-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb160-3"></a>proportion.zero &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">prop.table</span>(<span class="kw">table</span>(x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>))[<span class="st">&quot;TRUE&quot;</span>]}</span>
<span id="cb160-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb160-4"></a>d_n =<span class="st"> </span><span class="kw">apply</span>(Z.mat, <span class="dv">2</span>, proportion.zero) <span class="co"># fraction extinct </span></span>
<span id="cb160-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb160-5"></a>Z.mat.na &lt;-<span class="st"> </span>Z.mat; Z.mat.na[Z.mat <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span> </span>
<span id="cb160-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb160-6"></a>Zn_surv_bar =<span class="st"> </span><span class="kw">apply</span>(Z.mat.na, <span class="dv">2</span>, mean, <span class="dt">na.rm =</span> T) <span class="co">#expected value of survivors (E(Z_n|Z_n&gt;0))</span></span></code></pre></div>
<p>Using the means for all 1000 simulations, we calculate <span class="math inline">\(\mathbb{E} Z_n\)</span> (left plot), <span class="math inline">\(d_n\)</span> (center plot) and <span class="math inline">\(\mathbb{E}( Z_n | Z_n &gt; 0)\)</span>.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb161-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb161-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb161-2"></a><span class="kw">plot</span>(n, Zn_bar, <span class="dt">main =</span> <span class="st">&quot;Mean Zn&quot;</span>)</span>
<span id="cb161-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb161-3"></a><span class="kw">plot</span>(n, d_n, <span class="dt">main =</span> <span class="st">&quot;Fraction extinct&quot;</span>)</span>
<span id="cb161-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb161-4"></a><span class="kw">plot</span>(n, Zn_surv_bar, <span class="dt">main=</span> <span class="st">&quot;Mean Zn given Zn&gt;0&quot;</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-124"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-124-1.png" alt="Extinction simulations" width="672" />
<p class="caption">
Figure 7.18: Extinction simulations
</p>
</div>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb162-1"></a><span class="co">## insert code here for Zn_surv_bar.hat and add a line</span></span></code></pre></div>
<div id="proving-mathbbe-z_n-mn" class="section level3">
<h3><span class="header-section-number">7.13.1</span> Proving <span class="math inline">\(\mathbb{E} Z_n = m^n\)</span></h3>
<ul>
<li>Ingredients
<ul>
<li><span class="math inline">\(h(z)=p_{0}+p_{1}z+ p_{2} z^2+ \ldots\)</span></li>
<li><span class="math inline">\(h&#39;(z)=p_{1}+ 2zp_{2} + \ldots\)</span><br />
</li>
<li>Specifically, when <span class="math inline">\(z=1\)</span>:
<ul>
<li><span class="math inline">\(h(1)= 1\)</span></li>
<li><span class="math inline">\(h&#39;(1) =(1)p_1+ (2)p_2+(3)p_3+\ldots= \sum_1^k k p_k = m = \bar{Z}\)</span></li>
<li><span class="math inline">\(h_n&#39;(1) = m_n = \bar{Z}_n\)</span></li>
</ul></li>
<li><span class="math inline">\(h_{n+1}(z) = h(h_n(z))\)</span></li>
<li>Derivation:
Take derivative of <span class="math inline">\(h_{n+1}(z)\)</span>
<span class="math display">\[
\begin{aligned}
h&#39;_{n+1}(z)&amp;= h&#39;_n(h(z)) h&#39;(z) \\
h&#39;_{n+1}(1)&amp;= h&#39;_n(h(1)) h&#39;(1) \\
&amp;= h&#39;_n(1) m \\
&amp;= \bar{Z}_n m
\end{aligned}
\]</span> <strong>NOTE: Can’t find the complete derivation. Help!</strong></li>
</ul></li>
</ul>
</div>
<div id="variance-result." class="section level3">
<h3><span class="header-section-number">7.13.2</span> Variance result.</h3>
<ul>
<li>We proved that <span class="math inline">\(\mathbb{E} Z_n = m^n\)</span> using recursion. For the variance, one can also do recursion but this time we start by taking the second derivative of <span class="math inline">\(h(z)\)</span>
<ul>
<li><p>For <span class="math inline">\(m = 1\)</span>,
<span class="math display">\[
\sigma_n^2 = n \sigma^2 
\]</span></p></li>
<li><p>Also a result for <span class="math inline">\(m\neq 1\)</span></p></li>
<li><p>What does increasing variance mean for critical case? (Does
this make sense?)</p></li>
<li><p>What happens to variance of lines that survive? Is it bigger
or smaller than unconditional variance?</p></li>
</ul></li>
</ul>
<p>Variance in our simulation increases with generation number:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb163-1"></a>var_Zn =<span class="st"> </span><span class="kw">apply</span>(Z.mat, <span class="dv">2</span>, var)</span></code></pre></div>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb164-1"></a>n &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(Z.mat)</span>
<span id="cb164-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb164-2"></a><span class="kw">plot</span>(n, var_Zn, <span class="dt">xlab =</span> <span class="st">&#39;variance of Zn&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-126"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-126-1.png" alt="Distribution of $Z_n$" width="672" />
<p class="caption">
Figure 7.19: Distribution of <span class="math inline">\(Z_n\)</span>
</p>
</div>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb165-1"></a>   Z20 &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">table</span>(Z.mat[,<span class="dv">20</span>]))</span>
<span id="cb165-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb165-2"></a>   Z5 &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">table</span>(Z.mat[,<span class="dv">5</span>]))</span>
<span id="cb165-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb165-3"></a>   <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb165-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb165-4"></a>   <span class="kw">plot</span>(Z20[Z20 <span class="op">&lt;</span><span class="st"> </span><span class="dv">100</span>])</span>
<span id="cb165-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb165-5"></a>   <span class="kw">plot</span>(<span class="kw">log</span>(Z20[Z20 <span class="op">&lt;</span><span class="st"> </span><span class="dv">100</span>]))</span>
<span id="cb165-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb165-6"></a>   <span class="kw">plot</span>(Z5[Z5 <span class="op">&lt;</span><span class="st"> </span><span class="dv">100</span>])</span>
<span id="cb165-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb165-7"></a>   <span class="kw">plot</span>(<span class="kw">log</span>(Z5[Z5 <span class="op">&lt;</span><span class="st"> </span><span class="dv">100</span>]))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-127"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-127-1.png" alt="Histogram of selected $Z_n$" width="672" />
<p class="caption">
Figure 7.20: Histogram of selected <span class="math inline">\(Z_n\)</span>
</p>
</div>
</div>
</div>
<div id="geometric-offspring-distribution" class="section level2">
<h2><span class="header-section-number">7.14</span> Geometric offspring distribution</h2>
<p>For <span class="math inline">\(k = 1, 2, \ldots\)</span>,
<span class="math display">\[
  p_k = b c^{k-1}
  \]</span></p>
<p>For <span class="math inline">\(k = 0\)</span>,
<span class="math display">\[
  p_0 = 1 - p_1 - p_2 - \ldots .
  \]</span></p>
<p>Let’s solve for <span class="math inline">\(p_0\)</span>, using the geometric series sum, for <span class="math inline">\(a &lt;  1\)</span>,<br />
<span class="math display">\[
  1 + a + a^2 + \ldots =
  1 / (1-a)
  \]</span>
<span class="math display">\[
\begin{aligned}
p_0 &amp;= 1  - (p_1 + p_2 + p_3 +\ldots) \\
&amp;= 1 - (bc^{0}+ bc^{1} +b c^{2} + \ldots) \\
&amp;= 1 - (b+ bc^{1} +b c^{2} + \ldots) \\
&amp;= 1 - b(1+ c^{1} + c^{2} + \ldots) \\
&amp;= 1-  \frac{b}{1-c} \\
\end{aligned}
\]</span>
So, now we have all <span class="math inline">\(p_k\)</span> used as inputs for <span class="math inline">\(h(z)\)</span> given value for <span class="math inline">\(b\)</span> and <span class="math inline">\(c\)</span>.</p>
<p>A picture, Lotka’s parameters for 1920. The graph shows the probability of having exactly <span class="math inline">\(k\)</span> number of girls. When <span class="math inline">\(k=0\)</span> then all children were boys.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb166-1"></a>b =<span class="st"> </span><span class="fl">0.2126</span> ;   c =<span class="st"> </span><span class="fl">0.5893</span></span>
<span id="cb166-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb166-2"></a>kk =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>  ;   p_kk =<span class="st"> </span>b <span class="op">*</span><span class="st"> </span>c<span class="op">^</span>(kk<span class="dv">-1</span>)</span>
<span id="cb166-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb166-3"></a>p0 =<span class="st"> </span>b<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>c)</span>
<span id="cb166-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb166-4"></a>k =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, kk) ;   p_k =<span class="st"> </span><span class="kw">c</span>(p0, p_kk)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-129"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-129-1.png" alt="probability of having exactly $k$ number of girls" width="672" />
<p class="caption">
Figure 7.21: probability of having exactly <span class="math inline">\(k\)</span> number of girls
</p>
</div>
<p>Realism? See Table 10.3, p 386, <span class="citation">(“Introduction to Probability” <a href="#ref-grinstead2006" role="doc-biblioref">2006</a>)</span></p>
<div id="the-geometric-distributions-simple-pgf" class="section level3">
<h3><span class="header-section-number">7.14.1</span> The Geometric Distribution’s simple PGF</h3>
<p><span class="math display">\[
  h(z) = p_0 + p_1 z + p_2 z^2 + \ldots
  \]</span>
With geometric <span class="math inline">\(p_k\)</span>
<span class="math display">\[
  h(z) = p_0 + \sum_{k= 1}^\infty b c^{k-1} z^k.
  \]</span>
Substituting for <span class="math inline">\(p_0\)</span> and rewriting
<span class="math display">\[
  h(z) = \left( 1 - \frac{b}{(1-c)}\right) + bz \sum_{k= 1}^\infty 
  (cz)^{k-1}.
  \]</span>
Substituting <span class="math inline">\(j = k-1\)</span>,
<span class="math display">\[
  h(z) = \left( 1 - \frac{b}{(1-c)}\right) + bz \sum_{j= 0}^\infty 
  (cz)^{j} = \left( 1 - \frac{b}{(1-c)}\right) + {bz \over (1 - cz)}
  \]</span></p>
<p>The PGF is now “tractable”</p>
<ul>
<li><span class="math inline">\(m\)</span> and extinction
<span class="math display">\[
h(z) =  \left( 1 - {b / 1-c}\right) + {bz \over 1 - cz}
\]</span>
<ul>
<li>Please solve for <span class="math inline">\(m\)</span>. (Hint: <span class="math inline">\(h&#39;(1)\)</span>).
<ul>
<li>We kmow that <span class="math inline">\(h&#39;(1)=m\)</span>, so we start off taking the first derivative of <span class="math inline">\(h(z)\)</span> given the tractable form.
<span class="math display">\[
\begin{aligned}
h&#39;(z) &amp;= \frac{bz(-c)-(1-cz)b}{(1-cz)^2}\\
&amp;= \frac{-1}{(1-cz)^2}\\
h&#39;(1) &amp;= \frac{-1}{(1-c)^2} = m\\
\end{aligned}
\]</span></li>
</ul></li>
<li>What is <span class="math inline">\(m\)</span> with Lotka’s <span class="math inline">\(b\)</span> and <span class="math inline">\(c\)</span>?
<span class="math display">\[
  m= \frac{-1}{(1-0.5893)^2}= 5.928579
  \]</span>
<strong>NOTE: does this look reasonable?</strong></li>
</ul></li>
<li>We solve <span class="math inline">\(z = h(z)\)</span> with a bunch of algebra to get
<span class="math display">\[
d = {1 - b - c \over c(1-c)}
\]</span></li>
<li>How does <span class="math inline">\(d\)</span> depend on <span class="math inline">\(b\)</span> and <span class="math inline">\(c\)</span>? <span class="math inline">\(d\)</span> decreases with <span class="math inline">\(b\)</span> at a rate of <span class="math inline">\(\frac{-1}{c(1-c)}\)</span> and changes at rate <span class="math inline">\(\frac{-(1-b)(1-2c)-c^2}{c^2(1-c)^2}\)</span>.</li>
</ul>
<p>Big payoff: the full distribution of <span class="math inline">\(Z_n\)</span> (See <span class="citation">(“Introduction to Probability” <a href="#ref-grinstead2006" role="doc-biblioref">2006</a>)</span> p. 385)</p>
</div>
<div id="a-plot-of-keyfitzs-numbers-for-generations-1-2-and-3.-is-it-exponential-for-k-0" class="section level3">
<h3><span class="header-section-number">7.14.2</span> A plot of Keyfitz’s numbers for generations 1, 2, and 3. Is it exponential for <span class="math inline">\(k &gt; 0\)</span>?</h3>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-1"></a><span class="co">## b = 0.2126 ;   c = 0.5893 ## lotka</span></span>
<span id="cb167-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-2"></a>b =<span class="st"> </span><span class="fl">0.3666</span>; c =<span class="st"> </span><span class="fl">.5533</span> <span class="co">## Keyfitz (from GS)</span></span>
<span id="cb167-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-3"></a>m =<span class="st"> </span>b <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>c)<span class="op">^</span><span class="dv">2</span> <span class="co">## [1] 1.260416</span></span>
<span id="cb167-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-4"></a>d =<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>b <span class="op">-</span><span class="st"> </span>c) <span class="op">/</span><span class="st"> </span>(c <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>c))           <span class="co">#[1] 0.8185088</span></span>
<span id="cb167-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-5"></a></span>
<span id="cb167-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-6"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb167-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-7"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb167-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-8"></a>{</span>
<span id="cb167-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-9"></a>    n =<span class="st"> </span>i</span>
<span id="cb167-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-10"></a>    p0_n =<span class="st"> </span>d <span class="op">*</span><span class="st"> </span>(m<span class="op">^</span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span><span class="st"> </span>(m<span class="op">^</span>n <span class="op">-</span>d)</span>
<span id="cb167-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-11"></a>    j =<span class="st"> </span>kk</span>
<span id="cb167-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-12"></a>    pj_n =<span class="st"> </span>m<span class="op">^</span>n <span class="op">*</span></span>
<span id="cb167-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-13"></a><span class="st">        </span>((<span class="dv">1</span><span class="op">-</span>d) <span class="op">/</span><span class="st"> </span>(m<span class="op">^</span>n <span class="op">-</span><span class="st"> </span>d))<span class="op">^</span><span class="dv">2</span> <span class="op">*</span></span>
<span id="cb167-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-14"></a><span class="st">        </span>((m<span class="op">^</span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span>(m<span class="op">^</span>n <span class="op">-</span><span class="st"> </span>d))<span class="op">^</span>(j<span class="dv">-1</span>)</span>
<span id="cb167-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-15"></a>    pk_n &lt;-<span class="st"> </span><span class="kw">c</span>(p0_n, pj_n)</span>
<span id="cb167-16"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-16"></a>    <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb167-17"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-17"></a>        <span class="kw">plot</span>(k, pk_n, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">log =</span> <span class="st">&quot;&quot;</span>,  <span class="dt">main=</span><span class="st">&quot;Absolute&quot;</span>)</span>
<span id="cb167-18"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-18"></a>    <span class="cf">if</span> (i <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb167-19"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-19"></a>        <span class="kw">lines</span>(k, pk_n, <span class="dt">col =</span> i)</span>
<span id="cb167-20"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-20"></a>}</span>
<span id="cb167-21"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-21"></a></span>
<span id="cb167-22"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-22"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb167-23"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-23"></a>{</span>
<span id="cb167-24"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-24"></a>    n =<span class="st"> </span>i</span>
<span id="cb167-25"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-25"></a>    p0_n =<span class="st"> </span>d <span class="op">*</span><span class="st"> </span>(m<span class="op">^</span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span><span class="st"> </span>(m<span class="op">^</span>n <span class="op">-</span>d)</span>
<span id="cb167-26"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-26"></a>    j =<span class="st"> </span>kk</span>
<span id="cb167-27"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-27"></a>    pj_n =<span class="st"> </span>m<span class="op">^</span>n <span class="op">*</span><span class="st"> </span>((<span class="dv">1</span><span class="op">-</span>d) <span class="op">/</span><span class="st"> </span>(m<span class="op">^</span>n <span class="op">-</span><span class="st"> </span>d))<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>((m<span class="op">^</span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span>(m<span class="op">^</span>n <span class="op">-</span><span class="st"> </span>d))<span class="op">^</span>(j<span class="dv">-1</span>)</span>
<span id="cb167-28"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-28"></a>    pk_n &lt;-<span class="st"> </span><span class="kw">c</span>(p0_n, pj_n)</span>
<span id="cb167-29"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-29"></a>    <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb167-30"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-30"></a>        <span class="kw">plot</span>(k, pk_n, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">log =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Log scaled&quot;</span>)</span>
<span id="cb167-31"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-31"></a>    <span class="cf">if</span> (i <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb167-32"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-32"></a>        <span class="kw">lines</span>(k, pk_n, <span class="dt">col =</span> i)</span>
<span id="cb167-33"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb167-33"></a>}</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-130"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-130-1.png" alt="Keyfitz’s plot for generations 1, 2, and 3" width="672" />
<p class="caption">
Figure 7.22: Keyfitz’s plot for generations 1, 2, and 3
</p>
</div>
<ul>
<li><p>Applications</p>
<p>We have exponential distribution with a few very large lines, and a lot of small lines.</p>
<ul>
<li>Distribution of neutral alleles</li>
<li>Distribution of family lines (Y-chromosome, mtDNA, last names)</li>
</ul></li>
<li><p>Our result
With geometric <span class="math inline">\(p_k\)</span>, we get geometric <span class="math inline">\(Z_n\)</span>, for all <span class="math inline">\(n\)</span>.</p>
<p>Conjecture: geometric is to BP as gamma is to frailty?</p></li>
</ul>
</div>
</div>
<div id="branching-processes-and-covid-19" class="section level2">
<h2><span class="header-section-number">7.15</span> Branching Processes and Covid-19</h2>
<ul>
<li>What is the BP that they are studying? Is it contagion, social contacts, or ?</li>
<li>What do they assume about the BP?</li>
<li>Do they use any analytical results or just simulation? Why?</li>
<li>Best feature of paper?</li>
<li>Worst feature of paper?</li>
<li>Inspire any other approaches?</li>
</ul>
<hr />
<hr />
</div>
<div id="problems" class="section level2">
<h2><span class="header-section-number">7.16</span> Problems</h2>
<p>For the following problems, let <span class="math inline">\(p_0 = 0.3\)</span>, <span class="math inline">\(p_1=0.3\)</span>, <span class="math inline">\(p_2=0.4\)</span>. Use the function <span class="math inline">\(h(z) = p_0 + p_1 z + p_2 z^2\)</span>. This gives <span class="math inline">\(m= 0.3(0) + 0.3(1) + 0.4(2) = 1.1\)</span>, which is supercritical.</p>
<ol style="list-style-type: decimal">
<li>Multiply out <span class="math inline">\(h(z)^3\)</span> algebraically and explain how the coefficient on <span class="math inline">\(z^4\)</span> consists of all of the possible ways for 3 fathers to produce a total of 4 sons</li>
<li>Multiply out <span class="math inline">\(h_2(z) = h(h(z))\)</span> algebraically and explain how the coefficient on <span class="math inline">\(z^2\)</span> consists of all of the possible ways for a woman to have 2 grand-daughters.</li>
<li>Write an R-program to reproduce 20 entries of the table (This is for our values of <span class="math inline">\(p_0 = 0.3\)</span>, <span class="math inline">\(p_1=0.3\)</span>, <span class="math inline">\(p_2=0.4\)</span>, not the <span class="math inline">\(p_k\)</span> values on wikipedia)</li>
<li>Use the quadratic formula to solve for <span class="math inline">\(d\)</span>, the probability of ultimate extinction: <span class="math inline">\(d = p_0 + p_1d + p_2d^2\)</span>. What do you get for <span class="math inline">\(d\)</span> given our <span class="math inline">\(p_k\)</span> values above? Does it correspond to the same value one gets by using iteration, as in the Wikipedia table?<br />
</li>
<li>Simulate a critical branching process such that m = 1 by reversing the <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span> values we’re using. Check that <span class="math inline">\(m = 1\)</span>. You can use the “branch()” code in the slides.
<ol style="list-style-type: lower-alpha">
<li>See if you can do a big number of trials, 1000? For many generations, 30, 50, 100?<br />
</li>
<li>What fraction of lines become extinct?<br />
</li>
<li>What is the distribution of surviving lines? (Hint: Choose a time that is is not so distant that few lines survive)</li>
<li>What is the mean and variance of of <span class="math inline">\(Z_{10}\)</span>, <span class="math inline">\(Z_{20}\)</span> and <span class="math inline">\(Z_{30}\)</span>? What will happen as <span class="math inline">\(n \to \infty\)</span>?</li>
</ol></li>
</ol>
</div>
<div id="solutions-4" class="section level2">
<h2><span class="header-section-number">7.17</span> Solutions</h2>
<p>For the following problems, let <span class="math inline">\(p_0 = 0.3\)</span>, <span class="math inline">\(p_1=0.3\)</span>, <span class="math inline">\(p_2=0.4\)</span>. Use the function <span class="math inline">\(h(z) = p_0 + p_1 z + p_2 z^2\)</span>. This gives <span class="math inline">\(m= 0.3(0) + 0.3(1) + 0.4(2) = 1.1\)</span>, which is supercritical.<br />
1. <em>Multiply out <span class="math inline">\(h(z)^3\)</span> algebraically and explain how the coefficient on <span class="math inline">\(z^4\)</span> consists of all of the possible ways for 3 fathers to produce a total of 4 sons</em>
Finding <span class="math inline">\(h(z)^2\)</span>:
<span class="math display">\[\begin{aligned} 
    h(z)^2 &amp;= (p_0 + p_1 z + p_2 z^2)\times(p_0 + p_1 z + p_2 z^2) \\
    &amp;= p_0^2+2p_0p_1z+(2p_0p_2+p_1^2)z^2 + 2p_1p_2z^3 + p_2^2z^4
    \end{aligned}\]</span>
Multiplying out again:
<span class="math display">\[\begin{aligned}
    h(z)^3 &amp;= h(z)^2 h(z) \\
    &amp;= [p_0^2+2p_0p_1z+(2p_0p_2+p_1^2)z^2 + 2p_1p_2z^3 + p_2^2z^4]\times(p_0 + p_1 z + p_2 z^2) \\
    &amp;= p_0^3 + (3p_0^2p_1)z + (3p_0^2p_2 + 3p_0p_1^2)z^2 +(6p_0p_1p_2+p_1^3)z^3 + \\
    &amp; (3p_0p_2^2+3p_1^2p_2)z^4+ (3p_1p_2^2)z^5 + (p_2^3)z^6\\
    \end{aligned}\]</span>
To get a total of 4 children, either two of the fathers have 2 sons each and the third has no sons (<span class="math inline">\(p_0p_2^2\)</span>), or one of the fathers has 2 sons and the others each have 1 son (<span class="math inline">\(p_1^2p_2\)</span>). With three fathers, there are 3 ways for each of these combinations to appear; corresponding to the <span class="math inline">\(3p_0p_2^2+3p_1^2p_2\)</span> coefficient on <span class="math inline">\(z^4\)</span>.<br />
2. <em>Multiply out <span class="math inline">\(h_2(z) = h(h(z))\)</span> algebraically and explain how the coefficient on <span class="math inline">\(z^2\)</span> consists of all of the possible ways for a woman to have 2 grand-daughters.</em>
<span class="math display">\[\begin{aligned}
    h(h(z)) &amp; = p_0+p_1h(z)+p_2h(z)^2 \\
    &amp; = p_0 +p_1[p_0 + p_1 z + p_2 z^2] + p_2[p_0^2+2p_0p_1z+(2p_0p_2+p_1^2)z^2 + 2p_1p_2z^3 + p_2^2z^4] \\
    &amp;= [p_0+p_0p_1+p_0^2p_2] + [2p_0p_1p_2+p_1^2]z +\\
    &amp; [2p_0p_2^2+p_1p_2+p_1^2p_2]z^2 + [2p_1p_2^2]z^3+[p_2^3]z^4
    \end{aligned}\]</span>
Here are the ways a woman can end up with 2 granddaughters: first, she can have a single daughter who herself has 2 daughters (<span class="math inline">\(p_1p_2\)</span>). Or, she can have 2 daughters who then each have 1 daughter (<span class="math inline">\(p_1^2 p_2\)</span>). Lastly, she can have 2 daughters, one of which has 2 daughters and one who has no daughters (<span class="math inline">\(2p_0 p_2^2\)</span>; note there are two ways for this to happen because there are two daughters in the second generation). These possibilities correspond to the <span class="math inline">\(2p_0p_2^2+p_1p_2+p_1^2p_2\)</span> coefficient on <span class="math inline">\(z^2\)</span><br />
3. <em>Write an R-program to reproduce 20 entries of the table (This is for our values of <span class="math inline">\(p_0 = 0.3\)</span>, <span class="math inline">\(p_1=0.3\)</span>, <span class="math inline">\(p_2=0.4\)</span>, not the <span class="math inline">\(p_k\)</span> values on wikipedia)</em></p>
<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th>Generation Number</th>
<th>Extinction probability</th>
<th>Generation Number</th>
<th>Extinction probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0.30000</td>
<td>11</td>
<td>0.68599</td>
</tr>
<tr class="even">
<td>2</td>
<td>0.42600</td>
<td>12</td>
<td>0.69403</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0.50039</td>
<td>13</td>
<td>0.70088</td>
</tr>
<tr class="even">
<td>4</td>
<td>0.55027</td>
<td>14</td>
<td>0.70676</td>
</tr>
<tr class="odd">
<td>5</td>
<td>0.58620</td>
<td>15</td>
<td>0.71183</td>
</tr>
<tr class="even">
<td>6</td>
<td>0.61331</td>
<td>16</td>
<td>0.71623</td>
</tr>
<tr class="odd">
<td>7</td>
<td>0.63446</td>
<td>17</td>
<td>0.72006</td>
</tr>
<tr class="even">
<td>8</td>
<td>0.65135</td>
<td>18</td>
<td>0.72342</td>
</tr>
<tr class="odd">
<td>9</td>
<td>0.66511</td>
<td>19</td>
<td>0.72636</td>
</tr>
<tr class="even">
<td>10</td>
<td>0.67648</td>
<td>20</td>
<td>0.72895</td>
</tr>
<tr class="odd">
<td>—</td>
<td>—</td>
<td>—</td>
<td>—</td>
</tr>
</tbody>
</table>
<p>The extinction probability is converging to 0.75 (going out to 50 or 60 generations is helpful for observing this).<br />
Sample code:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-1"></a>d_zero &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb168-2"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-2"></a>p_zero &lt;-<span class="st"> </span><span class="fl">0.3</span></span>
<span id="cb168-3"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-3"></a>p_one &lt;-<span class="st"> </span><span class="fl">0.3</span></span>
<span id="cb168-4"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-4"></a>p_two &lt;-<span class="st"> </span><span class="fl">0.4</span></span>
<span id="cb168-5"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-5"></a>n_gen &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb168-6"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-6"></a></span>
<span id="cb168-7"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-7"></a>value_table &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow =</span> n_gen, <span class="dt">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb168-8"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-8"></a></span>
<span id="cb168-9"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-9"></a>d_prev &lt;-<span class="st"> </span>d_zero</span>
<span id="cb168-10"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-10"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_gen) {</span>
<span id="cb168-11"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-11"></a>  prob_extinction &lt;-<span class="st"> </span>p_zero <span class="op">+</span><span class="st"> </span>d_prev<span class="op">*</span>p_one <span class="op">+</span><span class="st"> </span>(d_prev<span class="op">^</span><span class="dv">2</span>)<span class="op">*</span>p_two</span>
<span id="cb168-12"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-12"></a>  value_table[i,<span class="dv">1</span>] =<span class="st"> </span>i</span>
<span id="cb168-13"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-13"></a>  value_table[i, <span class="dv">2</span>] =<span class="st"> </span>prob_extinction</span>
<span id="cb168-14"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-14"></a>  d_prev &lt;-<span class="st"> </span>prob_extinction</span>
<span id="cb168-15"><a href="fertility-heterogeneity-tempo-distortions-and-distorted-tempo.html#cb168-15"></a>}</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><em>Use the quadratic formula to solve for <span class="math inline">\(d\)</span>, the probability of ultimate extinction: <span class="math inline">\(d = p_0 + p_1d + p_2d^2\)</span>. What do you get for <span class="math inline">\(d\)</span> given our <span class="math inline">\(p_k\)</span> values above? Does it correspond to the same value one gets by using iteration, as in the Wikipedia table?</em><br />
Do some rearranging of <span class="math inline">\(d = p_0 + p_1d + p_2d^2\)</span> to get: <span class="math display">\[0 = p_2d^2 +(p_1-1)d + p_0  \]</span><br />
Solving with the quadratic formula: <span class="math display">\[ d^* = {(1-p_1) \pm \sqrt{(p_1-1)^2 - 4p_2p_0}  \over 2p_2 } \]</span>
Filling in our given <span class="math inline">\(p_k\)</span> values:
<span class="math display">\[\begin{aligned}
 d^* &amp;= \frac{(1-0.3) \pm \sqrt{(0.3-1)^2 -4(0.4)(0.3)}}{2(0.4)} \\
 &amp;= \{0.75, 1\} 
 \end{aligned}\]</span><br />
Since <span class="math inline">\(m&gt;1\)</span>, there are two roots: 1 and 0.75. <span class="math inline">\(d=0.75\)</span> is the solution we are interested in, and it indeed agrees with the probability of the extinction that our iterative solution converges to.</li>
<li><em>Simulate a critical branching process such that m = 1 by reversing the <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span> values we’re using. Check that <span class="math inline">\(m = 1\)</span>. You can use the “branch()” code in the slides.</em><br />
Let <span class="math inline">\(p_0=0.3\)</span>, <span class="math inline">\(p_1 =0.4\)</span>, <span class="math inline">\(p_2=0.3:\)</span>m = 0(0.3) + 1(0.4)+2(0.3) = 1$.
<ol style="list-style-type: lower-alpha">
<li><em>See if you can do a big number of trials, 1000? For many generations, 30, 50, 100?</em><br />
Sample simulation with 1000 trials for 100 generations (seed set to 91):
<div class="figure"><span id="fig:unnamed-chunk-132"></span>
<img src="figures/branch_simulation.png" alt="Branch simulation" width="100%" />
<p class="caption">
Figure 7.23: Branch simulation
</p>
</div></li>
<li><em>What fraction of lines become extinct?</em><br />
96.6% of lines become extinct by generation 100 with the above simulation. The following plot shows extinction at each generation:
<div class="figure"><span id="fig:unnamed-chunk-133"></span>
<img src="figures/extinctionplot.png" alt="Rate of extinction" width="100%" />
<p class="caption">
Figure 7.24: Rate of extinction
</p>
</div></li>
<li><em>What is the distribution of surviving lines? (Hint: Choose a time that is is not so distant that few lines survive)</em><br />
The following histograms show surviving lines’ sizes at select generations. At each generation, we can see something resembling a geometric distribution.
<div class="figure"><span id="fig:unnamed-chunk-134"></span>
<img src="figures/generation_dist.png" alt="Surviving generations" width="100%" />
<p class="caption">
Figure 7.25: Surviving generations
</p>
</div></li>
<li><em>What is the mean and variance of of <span class="math inline">\(Z_{10}\)</span>, <span class="math inline">\(Z_{20}\)</span> and <span class="math inline">\(Z_{30}\)</span>? What will happen as <span class="math inline">\(n \to \infty\)</span>?</em></li>
</ol></li>
</ol>
<table>
<thead>
<tr class="header">
<th>Generation <span class="math inline">\(n\)</span></th>
<th>Mean <span class="math inline">\(Z_n\)</span></th>
<th>Var <span class="math inline">\(Z_n\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>1.009</td>
<td>5.20001</td>
</tr>
<tr class="even">
<td>20</td>
<td>1.012</td>
<td>10.7426</td>
</tr>
<tr class="odd">
<td>30</td>
<td>0.991</td>
<td>17.53045</td>
</tr>
</tbody>
</table>
<pre><code> &lt;div class=&quot;figure&quot;&gt;
    &lt;img src=&quot;/hdir/0/andreamg/Year2_2019_2020/Random_demography/random_demography/bookdown-master/figures/meanvar.png&quot; alt=&quot;Survival mean and variance&quot; width=&quot;100%&quot; /&gt;
    &lt;p class=&quot;caption&quot;&gt;(\#fig:unnamed-chunk-135)Survival mean and variance&lt;/p&gt;
    &lt;/div&gt;
    The mean and variance calculated above account for all lines, not just surviving ones. In this simulation, the mean tends to hover around 1 and the variance tends to increase with generation number, at least up to a certain point.</code></pre>
<p>As <span class="math inline">\(n\to \infty\)</span>, the mean and variance theoretically will go to zero (since <span class="math inline">\(m=1\)</span> is critical, all lines must eventually die out).</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-bongaarts1998quantum">
<p>Bongaarts, John, and Griffith Feeney. 1998. “On the Quantum and Tempo of Fertility.” <em>Population and Development Review</em>, 271–91.</p>
</div>
<div id="ref-burkimsher2017evolution">
<p>Burkimsher, Marion. 2017. “Evolution of the Shape of the Fertility Curve: Why Might Some Countries Develop a Bimodal Curve?” <em>Demographic Research</em> 37: 295–324.</p>
</div>
<div id="ref-harris1964theory">
<p>Harris, Theodore Edward. 1964. “The Theory of Branching Process.” <a href="https://www.rand.org/content/dam/rand/pubs/reports/%0A2009/R381.pdf">https://www.rand.org/content/dam/rand/pubs/reports/
2009/R381.pdf</a>.</p>
<div id="ref-hastie2009elements">
<p>Hastie, Trevor, Robert Tibshirani, and Jerome Friedman. 2009. <em>The Elements of Statistical Learning: Data Mining, Inference, and Prediction</em>. Springer Science &amp; Business Media.</p>
</div>
<div id="ref-grinstead2006">
<p>“Introduction to Probability.” 2006. <a href="https://math.dartmouth.edu/~prob/prob/prob.pdf">https://math.dartmouth.edu/~prob/prob/prob.pdf</a>.</p>
</div>
<div id="ref-sullivan2005age">
<p>Sullivan, Rachel. 2005. “The Age Pattern of First-Birth Rates Among Us Women: The Bimodal 1990s.” <em>Demography</em> 42 (2): 259–73.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mortality-plateaus.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="fisher-wright.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/07-branching.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
