<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Coalescent | Mathematical Demography</title>
  <meta name="description" content="This is a book from the Mathematical Demography lecture notes." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Coalescent | Mathematical Demography" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a book from the Mathematical Demography lecture notes." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Coalescent | Mathematical Demography" />
  
  <meta name="twitter:description" content="This is a book from the Mathematical Demography lecture notes." />
  

<meta name="author" content="Josh R. Goldstein" />


<meta name="date" content="2020-07-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="fisher-wright.html"/>
<link rel="next" href="student-presentations.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Random Demography</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction to Demographic Heterogeneity</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#outline"><i class="fa fa-check"></i><b>2.1</b> Outline</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#part-i.-conceptual-introduction"><i class="fa fa-check"></i><b>2.2</b> Part I. Conceptual Introduction</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#what-is-demographic-heterogeneity"><i class="fa fa-check"></i><b>2.2.1</b> What is Demographic Heterogeneity?</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#an-example"><i class="fa fa-check"></i><b>2.2.2</b> An example</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#a-2nd-example-exponential-growth-two-countries"><i class="fa fa-check"></i><b>2.2.3</b> A 2nd example: Exponential growth, two countries</a></li>
<li class="chapter" data-level="2.2.4" data-path="intro.html"><a href="intro.html#more-examples-to-work"><i class="fa fa-check"></i><b>2.2.4</b> More examples to work</a></li>
<li class="chapter" data-level="2.2.5" data-path="intro.html"><a href="intro.html#application"><i class="fa fa-check"></i><b>2.2.5</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#part-ii.-formal-analysis"><i class="fa fa-check"></i><b>2.3</b> Part II. Formal Analysis</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#outline-1"><i class="fa fa-check"></i><b>2.3.1</b> Outline</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro.html"><a href="intro.html#keyfitz-result"><i class="fa fa-check"></i><b>2.3.2</b> Keyfitz result</a></li>
<li class="chapter" data-level="2.3.3" data-path="intro.html"><a href="intro.html#us-mexico-example"><i class="fa fa-check"></i><b>2.3.3</b> US-Mexico Example</a></li>
<li class="chapter" data-level="2.3.4" data-path="intro.html"><a href="intro.html#the-origin-of-professor-wachters-poisson-exponential-model"><i class="fa fa-check"></i><b>2.3.4</b> The Origin of Professor Wachter’s Poisson-Exponential Model</a></li>
<li class="chapter" data-level="2.3.5" data-path="intro.html"><a href="intro.html#some-commentary"><i class="fa fa-check"></i><b>2.3.5</b> Some commentary</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#conclusions"><i class="fa fa-check"></i><b>2.4</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="frailty.html"><a href="frailty.html"><i class="fa fa-check"></i><b>3</b> Multiplicative Fixed Frailty</a><ul>
<li class="chapter" data-level="3.1" data-path="frailty.html"><a href="frailty.html#outline-2"><i class="fa fa-check"></i><b>3.1</b> Outline</a><ul>
<li class="chapter" data-level="3.1.1" data-path="frailty.html"><a href="frailty.html#review-of-mortality-mathematics"><i class="fa fa-check"></i><b>3.1.1</b> Review of mortality mathematics</a></li>
<li class="chapter" data-level="3.1.2" data-path="frailty.html"><a href="frailty.html#application-what-is-ellx"><i class="fa fa-check"></i><b>3.1.2</b> Application: what is <span class="math inline">\(\ell&#39;(x)\)</span>?</a></li>
<li class="chapter" data-level="3.1.3" data-path="frailty.html"><a href="frailty.html#extending-keyfitz-to-mortality"><i class="fa fa-check"></i><b>3.1.3</b> Extending Keyfitz to mortality</a></li>
<li class="chapter" data-level="3.1.4" data-path="frailty.html"><a href="frailty.html#fragile"><i class="fa fa-check"></i><b>3.1.4</b> fragile</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="frailty.html"><a href="frailty.html#part-i.-results-from-fixed-frailty"><i class="fa fa-check"></i><b>3.2</b> Part I. Results from Fixed Frailty</a><ul>
<li class="chapter" data-level="3.2.1" data-path="frailty.html"><a href="frailty.html#a-simulation"><i class="fa fa-check"></i><b>3.2.1</b> A simulation</a></li>
<li class="chapter" data-level="3.2.2" data-path="frailty.html"><a href="frailty.html#lets-derive-pop-survival-note-bars-barell"><i class="fa fa-check"></i><b>3.2.2</b> Let’s derive pop survival (Note: <span class="math inline">\(\bar{s} = \bar{\ell}\)</span>)</a></li>
<li class="chapter" data-level="3.2.3" data-path="frailty.html"><a href="frailty.html#now-population-hazards-stepping-stones"><i class="fa fa-check"></i><b>3.2.3</b> Now population hazards (stepping stones)</a></li>
<li class="chapter" data-level="3.2.4" data-path="frailty.html"><a href="frailty.html#rodriguez-question"><i class="fa fa-check"></i><b>3.2.4</b> Rodriguez question</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="frailty.html"><a href="frailty.html#part-ii.-introduction-to-gamma-frailty"><i class="fa fa-check"></i><b>3.3</b> Part II. Introduction to Gamma Frailty</a><ul>
<li class="chapter" data-level="3.3.1" data-path="frailty.html"><a href="frailty.html#the-gamma-distribution"><i class="fa fa-check"></i><b>3.3.1</b> The Gamma distribution</a></li>
<li class="chapter" data-level="3.3.2" data-path="frailty.html"><a href="frailty.html#gamma-in-r"><i class="fa fa-check"></i><b>3.3.2</b> Gamma in R</a></li>
<li class="chapter" data-level="3.3.3" data-path="frailty.html"><a href="frailty.html#population-survival-of-gamma-frailty"><i class="fa fa-check"></i><b>3.3.3</b> Population Survival of Gamma Frailty</a></li>
<li class="chapter" data-level="3.3.4" data-path="frailty.html"><a href="frailty.html#interpreting-gamma-frailty-survival"><i class="fa fa-check"></i><b>3.3.4</b> Interpreting Gamma-frailty survival</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="frailty.html"><a href="frailty.html#conclusions-1"><i class="fa fa-check"></i><b>3.4</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html"><i class="fa fa-check"></i><b>4</b> Gamma Frailty with Applications</a><ul>
<li class="chapter" data-level="4.1" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#from-pop-survival-to-pop-hazards"><i class="fa fa-check"></i><b>4.1</b> From pop survival to pop hazards</a><ul>
<li class="chapter" data-level="4.1.1" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#what-happens-to-frailty-of-survivors"><i class="fa fa-check"></i><b>4.1.1</b> What happens to frailty of survivors?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#selection-and-observed-frailty-in-censoc"><i class="fa fa-check"></i><b>4.2</b> Selection and observed frailty in CenSoc</a><ul>
<li class="chapter" data-level="4.2.1" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#data"><i class="fa fa-check"></i><b>4.2.1</b> Data</a></li>
<li class="chapter" data-level="4.2.2" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#estimation"><i class="fa fa-check"></i><b>4.2.2</b> Estimation</a></li>
<li class="chapter" data-level="4.2.3" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#discuss-our-conclusions-and-possible-future-directions-to-follow."><i class="fa fa-check"></i><b>4.2.3</b> Discuss our conclusions and possible future directions to follow.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html"><i class="fa fa-check"></i><b>5</b> Convergence and cross-overs</a><ul>
<li class="chapter" data-level="5.1" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#outline-3"><i class="fa fa-check"></i><b>5.1</b> Outline</a></li>
<li class="chapter" data-level="5.2" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#what-happens-to-mortality-disparities-at-older-ages"><i class="fa fa-check"></i><b>5.2</b> What happens to mortality disparities at older ages?</a><ul>
<li class="chapter" data-level="5.2.1" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#a-possible-null-model"><i class="fa fa-check"></i><b>5.2.1</b> A possible null-model</a></li>
<li class="chapter" data-level="5.2.2" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#a-result-5e"><i class="fa fa-check"></i><b>5.2.2</b> A result: (5E)</a></li>
<li class="chapter" data-level="5.2.3" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#inversion"><i class="fa fa-check"></i><b>5.2.3</b> Inversion</a></li>
<li class="chapter" data-level="5.2.4" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#an-example-1"><i class="fa fa-check"></i><b>5.2.4</b> An example</a></li>
<li class="chapter" data-level="5.2.5" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#application-1"><i class="fa fa-check"></i><b>5.2.5</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#student-presentation"><i class="fa fa-check"></i><b>5.3</b> Student Presentation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html"><i class="fa fa-check"></i><b>6</b> Mortality plateaus</a><ul>
<li class="chapter" data-level="6.1" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#outline-4"><i class="fa fa-check"></i><b>6.1</b> Outline</a></li>
<li class="chapter" data-level="6.2" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#heterogeneity-slows-mortality-improvement"><i class="fa fa-check"></i><b>6.2</b> Heterogeneity slows mortality improvement</a><ul>
<li class="chapter" data-level="6.2.1" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#an-example-2"><i class="fa fa-check"></i><b>6.2.1</b> An example</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#conclusions-2"><i class="fa fa-check"></i><b>6.3</b> Conclusions</a></li>
<li class="chapter" data-level="6.4" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#kens-class---hazards-and-plateaus"><i class="fa fa-check"></i><b>6.4</b> Ken’s class - Hazards and Plateaus</a><ul>
<li class="chapter" data-level="6.4.1" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#extremes-of-longevity-in-humans-and-other-species"><i class="fa fa-check"></i><b>6.4.1</b> Extremes of Longevity in Humans and Other Species</a></li>
<li class="chapter" data-level="6.4.2" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#gamma-gompertz-fixed-frailty-hazards"><i class="fa fa-check"></i><b>6.4.2</b> Gamma-Gompertz Fixed Frailty Hazards</a></li>
<li class="chapter" data-level="6.4.3" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#less-restrictive-frailty-models"><i class="fa fa-check"></i><b>6.4.3</b> Less Restrictive Frailty Models</a></li>
<li class="chapter" data-level="6.4.4" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#mutation-accumulation-gompertz-hazards-with-plateaus"><i class="fa fa-check"></i><b>6.4.4</b> Mutation Accumulation, Gompertz Hazards with Plateaus</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#key-points"><i class="fa fa-check"></i><b>6.5</b> Key points</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tempo.html"><a href="tempo.html"><i class="fa fa-check"></i><b>7</b> Tempo</a><ul>
<li class="chapter" data-level="7.1" data-path="tempo.html"><a href="tempo.html#outline-5"><i class="fa fa-check"></i><b>7.1</b> Outline</a></li>
<li class="chapter" data-level="7.2" data-path="tempo.html"><a href="tempo.html#introduction-1"><i class="fa fa-check"></i><b>7.2</b> Introduction</a><ul>
<li class="chapter" data-level="7.2.1" data-path="tempo.html"><a href="tempo.html#fertility-postponement-a-very-simple-example"><i class="fa fa-check"></i><b>7.2.1</b> Fertility postponement, a very simple example</a></li>
<li class="chapter" data-level="7.2.2" data-path="tempo.html"><a href="tempo.html#continuous-postponement-a-shiny-simulation"><i class="fa fa-check"></i><b>7.2.2</b> Continuous postponement, a shiny simulation</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="tempo.html"><a href="tempo.html#period-shifts-bongaarts-and-feeneys-model"><i class="fa fa-check"></i><b>7.3</b> Period Shifts: Bongaarts and Feeney’s model</a><ul>
<li class="chapter" data-level="7.3.1" data-path="tempo.html"><a href="tempo.html#a-derivation-due-to-rodriguez-note-not-sure-what-the-reference-is-here"><i class="fa fa-check"></i><b>7.3.1</b> A derivation: due to Rodriguez <em>NOTE: not sure what the reference is here</em></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="tempo.html"><a href="tempo.html#an-application-to-the-united-states"><i class="fa fa-check"></i><b>7.4</b> An Application to the United States</a><ul>
<li class="chapter" data-level="7.4.1" data-path="tempo.html"><a href="tempo.html#conclusions-3"><i class="fa fa-check"></i><b>7.4.1</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="tempo.html"><a href="tempo.html#two-americas"><i class="fa fa-check"></i><b>7.5</b> Two Americas</a><ul>
<li class="chapter" data-level="7.5.1" data-path="tempo.html"><a href="tempo.html#mixture"><i class="fa fa-check"></i><b>7.5.1</b> Mixture</a></li>
<li class="chapter" data-level="7.5.2" data-path="tempo.html"><a href="tempo.html#an-algorithm-for-tempo-adjustment-of-mixtures"><i class="fa fa-check"></i><b>7.5.2</b> An algorithm for tempo adjustment of mixtures</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="tempo.html"><a href="tempo.html#conclusions-4"><i class="fa fa-check"></i><b>7.6</b> Conclusions</a><ul>
<li class="chapter" data-level="7.6.1" data-path="tempo.html"><a href="tempo.html#caveats"><i class="fa fa-check"></i><b>7.6.1</b> Caveats</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="branching-processes.html"><a href="branching-processes.html"><i class="fa fa-check"></i><b>8</b> Branching Processes</a><ul>
<li class="chapter" data-level="8.1" data-path="branching-processes.html"><a href="branching-processes.html#outline-6"><i class="fa fa-check"></i><b>8.1</b> Outline</a></li>
<li class="chapter" data-level="8.2" data-path="branching-processes.html"><a href="branching-processes.html#motivation"><i class="fa fa-check"></i><b>8.2</b> Motivation</a><ul>
<li class="chapter" data-level="8.2.1" data-path="branching-processes.html"><a href="branching-processes.html#very-brief-history-of-branching-processes"><i class="fa fa-check"></i><b>8.2.1</b> Very brief history of Branching Processes</a></li>
<li class="chapter" data-level="8.2.2" data-path="branching-processes.html"><a href="branching-processes.html#applicability-to-the-coronavirus-yes-and-no."><i class="fa fa-check"></i><b>8.2.2</b> Applicability to the Coronavirus? Yes and no.</a></li>
<li class="chapter" data-level="8.2.3" data-path="branching-processes.html"><a href="branching-processes.html#simulated-examples-and-the-questions-they-raise"><i class="fa fa-check"></i><b>8.2.3</b> Simulated examples and the questions they raise</a></li>
<li class="chapter" data-level="8.2.4" data-path="branching-processes.html"><a href="branching-processes.html#what-is-a-bienayme-galton-watson-branching-process"><i class="fa fa-check"></i><b>8.2.4</b> What is a (Bienayme)-Galton-Watson branching process?</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="branching-processes.html"><a href="branching-processes.html#simulations-of-parents-having-children"><i class="fa fa-check"></i><b>8.3</b> Simulations of parents having children</a></li>
<li class="chapter" data-level="8.4" data-path="branching-processes.html"><a href="branching-processes.html#the-probability-generating-function-our-mathematical-tool"><i class="fa fa-check"></i><b>8.4</b> The Probability Generating Function: Our mathematical tool</a></li>
<li class="chapter" data-level="8.5" data-path="branching-processes.html"><a href="branching-processes.html#extinction"><i class="fa fa-check"></i><b>8.5</b> Extinction</a></li>
<li class="chapter" data-level="8.6" data-path="branching-processes.html"><a href="branching-processes.html#good-and-bad-set-ups-for-branching-process"><i class="fa fa-check"></i><b>8.6</b> Good and bad set-ups for branching process</a></li>
<li class="chapter" data-level="8.7" data-path="branching-processes.html"><a href="branching-processes.html#the-distribution-of-offspring-of-all-generations"><i class="fa fa-check"></i><b>8.7</b> The distribution of offspring of all generations</a></li>
<li class="chapter" data-level="8.8" data-path="branching-processes.html"><a href="branching-processes.html#geometric-offspring-distribution"><i class="fa fa-check"></i><b>8.8</b> Geometric offspring distribution</a><ul>
<li class="chapter" data-level="8.8.1" data-path="branching-processes.html"><a href="branching-processes.html#the-geometric-distributions-simple-pgf"><i class="fa fa-check"></i><b>8.8.1</b> The Geometric Distribution’s simple PGF</a></li>
<li class="chapter" data-level="8.8.2" data-path="branching-processes.html"><a href="branching-processes.html#a-plot-of-keyfitzs-numbers-for-generations-1-2-and-3.-is-it-exponential-for-k-0"><i class="fa fa-check"></i><b>8.8.2</b> A plot of Keyfitz’s numbers for generations 1, 2, and 3. Is it exponential for <span class="math inline">\(k &gt; 0\)</span>?</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="branching-processes.html"><a href="branching-processes.html#branching-processes-and-covid-19"><i class="fa fa-check"></i><b>8.9</b> Branching Processes and Covid-19</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="fisher-wright.html"><a href="fisher-wright.html"><i class="fa fa-check"></i><b>9</b> Fisher-Wright</a><ul>
<li class="chapter" data-level="9.1" data-path="fisher-wright.html"><a href="fisher-wright.html#outline-7"><i class="fa fa-check"></i><b>9.1</b> Outline</a></li>
<li class="chapter" data-level="9.2" data-path="fisher-wright.html"><a href="fisher-wright.html#parallel"><i class="fa fa-check"></i><b>9.2</b> Parallel</a><ul>
<li class="chapter" data-level="9.2.1" data-path="fisher-wright.html"><a href="fisher-wright.html#another-cell-phone-example"><i class="fa fa-check"></i><b>9.2.1</b> Another cell phone example</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="fisher-wright.html"><a href="fisher-wright.html#mutation"><i class="fa fa-check"></i><b>9.3</b> Mutation</a></li>
<li class="chapter" data-level="9.4" data-path="fisher-wright.html"><a href="fisher-wright.html#fixation"><i class="fa fa-check"></i><b>9.4</b> Fixation</a><ul>
<li class="chapter" data-level="9.4.1" data-path="fisher-wright.html"><a href="fisher-wright.html#path-to-fixation-a-measure-of-homogeneityheterogeneity"><i class="fa fa-check"></i><b>9.4.1</b> Path to fixation: a measure of homogeneity/heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="fisher-wright.html"><a href="fisher-wright.html#baby-names"><i class="fa fa-check"></i><b>9.5</b> Baby Names</a><ul>
<li class="chapter" data-level="9.5.1" data-path="fisher-wright.html"><a href="fisher-wright.html#whats-the-basic-idea"><i class="fa fa-check"></i><b>9.5.1</b> What’s the basic idea?</a></li>
<li class="chapter" data-level="9.5.2" data-path="fisher-wright.html"><a href="fisher-wright.html#fisher-wright-simulation-of-baby-names-hahn-and-bentley"><i class="fa fa-check"></i><b>9.5.2</b> Fisher-Wright simulation of Baby Names (Hahn and Bentley)</a></li>
<li class="chapter" data-level="9.5.3" data-path="fisher-wright.html"><a href="fisher-wright.html#drawing-their-picture-with-simulation"><i class="fa fa-check"></i><b>9.5.3</b> Drawing their picture with simulation</a></li>
<li class="chapter" data-level="9.5.4" data-path="fisher-wright.html"><a href="fisher-wright.html#fw-babyname-simulation-of-equilibrium-frequencies"><i class="fa fa-check"></i><b>9.5.4</b> FW babyname simulation of equilibrium frequencies</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="fisher-wright.html"><a href="fisher-wright.html#now-we-can-simulate-babyynmes"><i class="fa fa-check"></i><b>9.6</b> Now we can simulate babyynmes</a></li>
<li class="chapter" data-level="9.7" data-path="fisher-wright.html"><a href="fisher-wright.html#conclusions-5"><i class="fa fa-check"></i><b>9.7</b> Conclusions</a><ul>
<li class="chapter" data-level="9.7.1" data-path="fisher-wright.html"><a href="fisher-wright.html#some-potential-criticism"><i class="fa fa-check"></i><b>9.7.1</b> Some potential criticism</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="coalescent.html"><a href="coalescent.html"><i class="fa fa-check"></i><b>10</b> Coalescent</a><ul>
<li class="chapter" data-level="10.1" data-path="coalescent.html"><a href="coalescent.html#outline-8"><i class="fa fa-check"></i><b>10.1</b> Outline</a></li>
<li class="chapter" data-level="10.2" data-path="coalescent.html"><a href="coalescent.html#big-picture-the-coalescent-expectations-of-the-past"><i class="fa fa-check"></i><b>10.2</b> Big picture: The Coalescent: Expectations of the Past</a></li>
<li class="chapter" data-level="10.3" data-path="coalescent.html"><a href="coalescent.html#our-first-question-when-was-mrca"><i class="fa fa-check"></i><b>10.3</b> Our first question: When was MRCA?</a></li>
<li class="chapter" data-level="10.4" data-path="coalescent.html"><a href="coalescent.html#mutation-and-inference-of-tmrca-and-n"><i class="fa fa-check"></i><b>10.4</b> Mutation and inference of TMRCA and <span class="math inline">\(N\)</span></a></li>
<li class="chapter" data-level="10.5" data-path="coalescent.html"><a href="coalescent.html#inference-of-population-size-simulation"><i class="fa fa-check"></i><b>10.5</b> Inference of population size, simulation</a></li>
<li class="chapter" data-level="10.6" data-path="coalescent.html"><a href="coalescent.html#conclusions-6"><i class="fa fa-check"></i><b>10.6</b> Conclusions</a></li>
<li class="chapter" data-level="10.7" data-path="coalescent.html"><a href="coalescent.html#an-application-of-coalescent-theory"><i class="fa fa-check"></i><b>10.7</b> An application of coalescent theory</a><ul>
<li class="chapter" data-level="10.7.1" data-path="coalescent.html"><a href="coalescent.html#coalesence-when-population-is-changing"><i class="fa fa-check"></i><b>10.7.1</b> Coalesence when population is changing</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="coalescent.html"><a href="coalescent.html#inference-from-mrca-times-n-2-comparisons-and-relative-branch-lengths"><i class="fa fa-check"></i><b>10.8</b> Inference from MRCA times: <span class="math inline">\(n &gt; 2\)</span> comparisons and relative branch lengths</a></li>
<li class="chapter" data-level="10.9" data-path="coalescent.html"><a href="coalescent.html#reconstruction-ancient-european-population-sizes-using-batinis-sample-of-mitochondrial-dna"><i class="fa fa-check"></i><b>10.9</b> Reconstruction Ancient European Population Sizes using Batini’s sample of Mitochondrial DNA&quot;</a><ul>
<li class="chapter" data-level="10.9.1" data-path="coalescent.html"><a href="coalescent.html#summary-of-batini-et-al."><i class="fa fa-check"></i><b>10.9.1</b> Summary of Batini et al.</a></li>
<li class="chapter" data-level="10.9.2" data-path="coalescent.html"><a href="coalescent.html#ancient-population-estimates"><i class="fa fa-check"></i><b>10.9.2</b> Ancient population estimates</a></li>
</ul></li>
<li class="chapter" data-level="10.10" data-path="coalescent.html"><a href="coalescent.html#some-exercises"><i class="fa fa-check"></i><b>10.10</b> Some exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="student-presentations.html"><a href="student-presentations.html"><i class="fa fa-check"></i><b>11</b> Student Presentations</a><ul>
<li class="chapter" data-level="11.1" data-path="student-presentations.html"><a href="student-presentations.html#mortality-crossovers"><i class="fa fa-check"></i><b>11.1</b> Mortality Crossovers</a><ul>
<li class="chapter" data-level="11.1.1" data-path="student-presentations.html"><a href="student-presentations.html#outline-9"><i class="fa fa-check"></i><b>11.1.1</b> Outline</a></li>
<li class="chapter" data-level="11.1.2" data-path="student-presentations.html"><a href="student-presentations.html#mortality-crossovers-reality-or-bad-data-coale1986mortality"><i class="fa fa-check"></i><b>11.1.2</b> <em>Mortality Crossovers: Reality or Bad Data?</em> <span class="citation">(Coale and Kisker <span>1986</span>)</span></a></li>
<li class="chapter" data-level="11.1.3" data-path="student-presentations.html"><a href="student-presentations.html#methods-for-evaluating-the-heterogeneity-of-aging-processes-in-human-populations-using-vital-statistics-data-explaining-the-blackwhite-mortality-crossover-by-a-model-of-mortality-selection-manton1981methods"><i class="fa fa-check"></i><b>11.1.3</b> <em>Methods for Evaluating the Heterogeneity of Aging Processes in Human Populations Using Vital Statistics Data: Explaining the Black/White Mortality Crossover by a Model of Mortality Selection</em> <span class="citation">(Manton and Stallard <span>1981</span>)</span></a></li>
<li class="chapter" data-level="11.1.4" data-path="student-presentations.html"><a href="student-presentations.html#censoc-mortality-crossovers"><i class="fa fa-check"></i><b>11.1.4</b> CenSoc Mortality Crossovers</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="student-presentations.html"><a href="student-presentations.html#plateaus"><i class="fa fa-check"></i><b>11.2</b> Plateaus</a></li>
<li class="chapter" data-level="11.3" data-path="student-presentations.html"><a href="student-presentations.html#rising-inequality"><i class="fa fa-check"></i><b>11.3</b> Rising Inequality</a><ul>
<li class="chapter" data-level="11.3.1" data-path="student-presentations.html"><a href="student-presentations.html#trends-in-mortality-differentials-and-life-expectancy-for-male-social-security-covered-workers-by-socioeconomic-status-waldron2007trends"><i class="fa fa-check"></i><b>11.3.1</b> <em>Trends in mortality differentials and life expectancy for male social security-covered workers, by socioeconomic status</em> <span class="citation">(Waldron <span>2007</span>)</span></a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mathematical Demography</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="coalescent" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> Coalescent</h1>
<div id="outline-8" class="section level2">
<h2><span class="header-section-number">10.1</span> Outline</h2>
<ul>
<li>Big picture: What is “coalescent theory”?</li>
<li>Time to (T)MRCA</li>
<li>Simulation: Inferring population size</li>
<li>An application of Coalescent Theory</li>
</ul>
</div>
<div id="big-picture-the-coalescent-expectations-of-the-past" class="section level2">
<h2><span class="header-section-number">10.2</span> Big picture: The Coalescent: Expectations of the Past</h2>
<ul>
<li>Coalescent theory is not a theory.</li>
<li>It’s a model for the probability of different histories</li>
<li>“the” coalescent is a bit confusing. We’re not inferring the
actual history of common ancestry, just the probabilities</li>
</ul>
<p>An actual “picture”
<img src="/hdir/0/fmenares/Book/bookdown-master/images/cutter_diagram.png" /></p>
<ul>
<li>Top panel is a Fisher-Wright instance, ordered so that lines
don’t cross.</li>
<li>Haplotype is a sequence (we are diploids, each
contributing 2 haplotypes). But let’s just think of each line as
an individual, for now.</li>
<li><p>We can find The Most Recent Common Ancestor (TMRCA) of
sample (dark purple). Who and when would the MRCA of the top two individuals be?</p>
<ul>
<li>Our sample <span class="math inline">\(\neq\)</span> even all <em>extant</em> descendants of the MRCA. What
does this mean?</li>
<li>Our sample <span class="math inline">\(\neq\)</span> all of the descendants of the MRCA. What
does this mean?</li>
<li>If we chose two descendants at random, would we always get
same MRCA?</li>
</ul></li>
</ul>
<p>When we model coalescence we are thinking backwards in time.</p>
</div>
<div id="our-first-question-when-was-mrca" class="section level2">
<h2><span class="header-section-number">10.3</span> Our first question: When was MRCA?</h2>
<p>If we sample two individuals (today), how long ago was their MRCA?\
(Note: question is not “who”)</p>
<ul>
<li>Our answer will in terms of the probability of MRCA being 1
generation ago, 2 generations ago, etc.</li>
<li>We’ll assume Fisher-Wright (constant N, each gen randomly
picks parents)</li>
<li>The answer is surprisingly simple</li>
</ul>
<p>Let’s assume we have <span class="math inline">\(N\)</span> lines in Fisher-Wright (Note: I’m not using <span class="math inline">\(2N\)</span>.)</p>
<ul>
<li>The chance that two sampled people have same parent is <span class="math inline">\(1/N\)</span>, right?</li>
<li>Thus <span class="math inline">\(P(T_{MRCA} = 1) = 1/N\)</span>.</li>
<li>What is $P(T_{MRCA} = 2) = $?</li>
<li>What is $P(T_{MRCA} = n) = $?</li>
</ul>
<p>Let’s go to continuous time (reasonable if pop is big and time scale
is long).</p>
<p>Hazard of coalescence = <span class="math inline">\(c = 1/N\)</span>.
Probability of coalescence at time <span class="math inline">\(t\)</span> = <span class="math inline">\(\ell(t) h(t) = e^{-ct} c\)</span></p>
<p>What is expected time of coalescence? Think life expectancy.</p>
<p><span class="math inline">\(E(T_{MRCA})\)</span> if two samples: <span class="math inline">\(1/c = 1/(1/N) = N\)</span></p>
<p>Let’s simulate</p>
<ul>
<li>1 time, without random seed, letting N = 40, ngen = 200, mu = 0</li>
<li>Average over 100 FW simulations</li>
<li>What is variance of outcome? Is it what we would expect from
exponential?</li>
</ul>
</div>
<div id="mutation-and-inference-of-tmrca-and-n" class="section level2">
<h2><span class="header-section-number">10.4</span> Mutation and inference of TMRCA and <span class="math inline">\(N\)</span></h2>
<ul>
<li>Say mutations occur at a constant rate <span class="math inline">\(\mu\)</span> (<span class="math inline">\(10^{-8}\)</span>?)</li>
<li>Each year we would expect <span class="math inline">\(\mu\)</span> mutations, and over <span class="math inline">\(T\)</span> years we
would expect <span class="math inline">\(T\mu\)</span> mutations.</li>
<li>Say we observe that two people differ at <span class="math inline">\(k\)</span> sites of the
genome.
<ul>
<li>When was TMRCA?</li>
<li>How big is the population?</li>
</ul></li>
</ul>
<p>Picture (<span class="math inline">\(\Lambda\)</span>)
Tree length = <span class="math inline">\(2T\)</span>
Expected number of mutations:
<span class="math display">\[
  E(k) = E(2T\mu) = \bar{T} 2 \mu
  \]</span>
Since,
<span class="math display">\[
  \bar{T} = E(TMRCA) = N
  \]</span>
If we observe on average <span class="math inline">\(\bar{k}\)</span> mutations, then
<span class="math display">\[
  E(k) = N 2 \mu \rightarrow \hat{N} = {\bar{k} \over 2 \mu}
  \]</span></p>
</div>
<div id="inference-of-population-size-simulation" class="section level2">
<h2><span class="header-section-number">10.5</span> Inference of population size, simulation</h2>
<ul>
<li>We do FW with mutations</li>
<li>Average pairwise differences</li>
<li>Divide by <span class="math inline">\(2\mu\)</span> to get our estimate</li>
<li>We can repeat a bunch of times and see average estimate
converges to the truth</li>
</ul>
<p>Coalescence of a sample of <span class="math inline">\(n\)</span> individuals</p>
<ul>
<li>This is covered on pages 42 and 43 of Gillespie</li>
<li>We’ll just do one quick example, accepting the result</li>
</ul>
<p>A sample of 3: Note we’re using <span class="math inline">\(N\)</span> (instead of <span class="math inline">\(2N\)</span>)</p>

<p>Question: If we sample 4, how much of time to TMRCA
is do we have 4 branches, 3 branches, and 2 branches?</p>
</div>
<div id="conclusions-6" class="section level2">
<h2><span class="header-section-number">10.6</span> Conclusions</h2>
<ul>
<li>We defined the coalescent as the stochastic process going
back in time to common ancestors</li>
<li>For constant population size, we proved that time to
coalescence for a sample pair is exponential.</li>
<li>We showed (math and simulation) that <span class="math inline">\(E(T) = N\)</span>.</li>
<li>We showed that we could estimate <span class="math inline">\(N\)</span> from observed mutations
if we knew the mutation rate</li>
</ul>
<p>\end{frame}</p>
</div>
<div id="an-application-of-coalescent-theory" class="section level2">
<h2><span class="header-section-number">10.7</span> An application of coalescent theory</h2>
<p>Application to making inferences about the real history of human populations.</p>
<p>Caveat: We’re still using <span class="math inline">\(N\)</span> (not <span class="math inline">\(2N\)</span>) as the number of haploids</p>
<div id="coalesence-when-population-is-changing" class="section level3">
<h3><span class="header-section-number">10.7.1</span> Coalesence when population is changing</h3>
<ul>
<li>Ee said hazard of coalescence was <span class="math inline">\(h = c = 1/N\)</span>.</li>
<li><p>What is hazard of coalesence in one generation for two
different populations: <span class="math inline">\(N = 1000\)</span>? <span class="math inline">\(N = 2000\)</span>?</p></li>
<li><p>What if within the same population <span class="math inline">\(N(t) = 1000\)</span> and <span class="math inline">\(N(t+1) = 2000\)</span>? (Hint: we still follow FW in allowing children to
choose their parents.)</p></li>
<li><p>If the population size changes over time <span class="math inline">\(N(t)\)</span>, then hazards
of coalescence in will change too: <span class="math inline">\(h(t) = 1/N(t)\)</span>.</p></li>
</ul>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">  N_recent =<span class="st"> </span><span class="dv">5000</span> <span class="co">## population last T_thresh years</span></a>
<a class="sourceLine" id="cb124-2" data-line-number="2">  T_thresh =<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb124-3" data-line-number="3">  N_ancient =<span class="st"> </span><span class="dv">500</span> <span class="co">## earlier population</span></a>
<a class="sourceLine" id="cb124-4" data-line-number="4">  n =<span class="st"> </span><span class="dv">1000</span> <span class="co">## sampled individuals</span></a>
<a class="sourceLine" id="cb124-5" data-line-number="5">  <span class="kw">set.seed</span>(<span class="fl">0.4886</span>)</a>
<a class="sourceLine" id="cb124-6" data-line-number="6">  T1 &lt;-<span class="st"> </span><span class="kw">rexp</span>(n, <span class="dt">rate =</span> <span class="dv">1</span><span class="op">/</span>N_recent) <span class="co">## give everyone a chance to coalesce </span></a>
<a class="sourceLine" id="cb124-7" data-line-number="7">  T1[T1 <span class="op">&gt;</span><span class="st"> </span>T_thresh] &lt;-<span class="st"> </span><span class="ot">NA</span> <span class="co">## if they don&#39;t in 1st 1000 years, resample them</span></a>
<a class="sourceLine" id="cb124-8" data-line-number="8">  n2 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(T1))</a>
<a class="sourceLine" id="cb124-9" data-line-number="9">  T2 &lt;-<span class="st"> </span>T_thresh <span class="op">+</span><span class="st"> </span><span class="kw">rexp</span>(n2, <span class="dt">rate =</span> <span class="dv">1</span><span class="op">/</span>N_ancient) <span class="co">## at ancient rate</span></a>
<a class="sourceLine" id="cb124-10" data-line-number="10">  T.vec &lt;-<span class="st"> </span><span class="kw">c</span>(T1, T2)</a>
<a class="sourceLine" id="cb124-11" data-line-number="11">  <span class="kw">hist</span>(T.vec, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">5000</span>, <span class="dv">250</span>))</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-119-1.png" width="672" />
Q: How could we estimate population sizes from this histogram?</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">  T.vec &lt;-<span class="st"> </span><span class="kw">sort</span>(T.vec)</a>
<a class="sourceLine" id="cb125-2" data-line-number="2">  St =<span class="st"> </span>(n<span class="op">:</span><span class="dv">1</span>)<span class="op">/</span>n</a>
<a class="sourceLine" id="cb125-3" data-line-number="3">  <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb125-4" data-line-number="4">  <span class="kw">plot</span>(T.vec, St); <span class="kw">abline</span>(<span class="dt">v =</span> T_thresh); <span class="kw">plot</span>(T.vec, <span class="kw">log</span>(St)); <span class="kw">abline</span>(<span class="dt">v =</span> T_thresh)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-120-1.png" width="672" />
Q: How can we estimate hazards from this histogram?</p>
<p>Our approach</p>
<ul>
<li>Say we have <span class="math inline">\(i\)</span> pairs of haploids</li>
<li>We then compute how many pairwise differences there are,
but instead of computing <span class="math inline">\(\bar{k}\)</span>, we keep the distributional
information <span class="math inline">\(k_i\)</span>.</li>
<li>Each <span class="math inline">\(k_i\)</span> implies a <span class="math inline">\(T_i\)</span></li>
<li>We then have a set of ``death times’’ (coalescence times),
can build a life table, estimate the hazards, and infer
<span class="math inline">\(N(t)\)</span>.</li>
</ul>
</div>
</div>
<div id="inference-from-mrca-times-n-2-comparisons-and-relative-branch-lengths" class="section level2">
<h2><span class="header-section-number">10.8</span> Inference from MRCA times: <span class="math inline">\(n &gt; 2\)</span> comparisons and relative branch lengths</h2>
Detour to length of branches
A sample of 3: Note we’re using <span class="math inline">\(N\)</span> (not <span class="math inline">\(2N\)</span>)

<p>Intuition: when we have more individuals, there’s more chance that
some pair of them will coalesce.</p>
<p>Question: If we sample 4, how much of time to TMRCA
do we have 4 branches, 3 branches, and 2 branches?</p>
</div>
<div id="reconstruction-ancient-european-population-sizes-using-batinis-sample-of-mitochondrial-dna" class="section level2">
<h2><span class="header-section-number">10.9</span> Reconstruction Ancient European Population Sizes using Batini’s sample of Mitochondrial DNA&quot;</h2>
<p>We use real sequences of mitochondrial DNA to estimate
ancient population sizes. The sequences were made available by Batini
et al, who analyzed sub-populations in their paper using software for
Bayesian inference for comparing groups of individuals. Our approach
here is to use a simpler, but less powerful approach. We will simply
look at pairwise differences of random pairs of individuals. For this
we are not going to do subgroups such as the Greeks or Irish, but are
going to use the entire European sample. The population sizes we
estimate are for the entire population represented by the 328
individuals.</p>
<blockquote>
<p>Special thanks to Ken Wachter, who taught me this approach and whose R-code forms the basis of this application</p>
</blockquote>
<div id="summary-of-batini-et-al." class="section level3">
<h3><span class="header-section-number">10.9.1</span> Summary of Batini et al.</h3>
<p>Before we begin our own analysis, let’s look at the inputs to
Batini’s analysis – the mtDNA haplotype sequences, and then at the
resulting population estimates.</p>
<div id="the-mitochondrial-dna" class="section level4">
<h4><span class="header-section-number">10.9.1.1</span> The mitochondrial DNA</h4>
<p>Data preparation begins.</p>
<p>There are 380 individuals grouped into regional sub-populations. I select out the Greeks, whose labels begin with “gre”.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">scan</span>(<span class="st">&quot;/hdir/0/fmenares/Book/bookdown-master/data/mtdna.csv&quot;</span>, <span class="dt">what =</span> <span class="kw">character</span>())</a>
<a class="sourceLine" id="cb126-2" data-line-number="2"><span class="kw">nchar</span>(x)</a></code></pre></div>
<pre><code>##   [1]     4     3     4     2     5    11     1    15 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577
##  [22] 16577 16577 16577 16577 16577 16574 16575 16575 16575 16575 16575 16575 16575 16575 16575 16575 16574 16575 16574 16574 16574
##  [43] 16574 16574 16574 16574 16575 16575 16575 16575 16575 16575 16575 16575 16575 16575 16575 16575 16575 16575 16575 16575 16575
##  [64] 16575 16575 16574 16576 16576 16576 16576 16576 16576 16576 16576 16576 16576 16576 16576 16576 16576 16575 16575 16575 16578
##  [85] 16578 16575 16575 16575 16576 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577
## [106] 16577 16577 16577 16577 16575 16574 16575 16575 16575 16575 16575 16574 16574 16574 16574 16575 16575 16575 16575 16575 16576
## [127] 16576 16576 16575 16575 16576 16576 16574 16574 16575 16575 16575 16575 16575 16574 16575 16575 16575 16575 16575 16575 16575
## [148] 16575 16575 16575 16574 16574 16575 16575 16575 16575 16575 16575 16574 16575 16575 16575 16575 16575 16575 16575 16575 16575
## [169] 16574 16574 16574 16574 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580
## [190] 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580
## [211] 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580
## [232] 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580 16580
## [253] 16575 16576 16576 16576 16576 16577 16577 16577 16576 16576 16576 16576 16576 16576 16576 16576 16576 16576 16576 16576 16576
## [274] 16576 16576 16576 16576 16576 16576 16576 16576 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577 16577
## [295] 16577 16576 16577 16577 16576 16575 16577 16575 16575 16577 16574 16575 16575 16575 16575 16574 16575 16575 16575 16575 16575
## [316] 16575 16575 16574 16575 16574 16574 16574 16574 16574 16575 16575 16574 16575 16575 16575 16576 16575 16575 16575 16575 16575
## [337] 16575 16575 16575 16576 16575 16576 16575 16575 16574 16575 16575 16575 16575 16575 16575 16575 16575 16575 16575 16574 16575
## [358] 16574 16574 16574 16574 16574 16574 16574 16574 16575 16575 16575 16575 16575 16575 16575 16575 16575 16575 16574 16575 16574
## [379] 16574 16574 16574 16574 16574 16574 16576 16576 16576 16576</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="co">## note the strings have different length</span></a>
<a class="sourceLine" id="cb128-2" data-line-number="2"><span class="co">## because there is some header information</span></a>
<a class="sourceLine" id="cb128-3" data-line-number="3"><span class="co">## and then because the labels are mixed with the sequences</span></a>
<a class="sourceLine" id="cb128-4" data-line-number="4"></a>
<a class="sourceLine" id="cb128-5" data-line-number="5"><span class="co">## separate out the sequences</span></a>
<a class="sourceLine" id="cb128-6" data-line-number="6">xx =<span class="st"> </span>x[<span class="kw">nchar</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">10000</span>] <span class="co">## elements that contain both label and sequences</span></a>
<a class="sourceLine" id="cb128-7" data-line-number="7">xx.list =<span class="st"> </span><span class="kw">strsplit</span>(xx, <span class="dt">split =</span> <span class="st">&quot;,&quot;</span>) <span class="co">## list of elements, split into label and sequences</span></a>
<a class="sourceLine" id="cb128-8" data-line-number="8"></a>
<a class="sourceLine" id="cb128-9" data-line-number="9"><span class="co">## now split up this list into a vector of labels and a vector of sequences</span></a>
<a class="sourceLine" id="cb128-10" data-line-number="10">get.first.element =<span class="st"> </span><span class="cf">function</span>(x) {x[<span class="dv">1</span>]}</a>
<a class="sourceLine" id="cb128-11" data-line-number="11">get.second.element =<span class="st"> </span><span class="cf">function</span>(x) {x[<span class="dv">2</span>]}</a>
<a class="sourceLine" id="cb128-12" data-line-number="12">labels =<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(xx.list, get.first.element))</a>
<a class="sourceLine" id="cb128-13" data-line-number="13">seqs =<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(xx.list, get.second.element))</a>
<a class="sourceLine" id="cb128-14" data-line-number="14"></a>
<a class="sourceLine" id="cb128-15" data-line-number="15"><span class="co">## Now use labels to select out the 20 Greeks</span></a>
<a class="sourceLine" id="cb128-16" data-line-number="16">s &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;^gre&quot;</span>, labels)</a>
<a class="sourceLine" id="cb128-17" data-line-number="17">my.labels =<span class="st"> </span>labels[s]</a>
<a class="sourceLine" id="cb128-18" data-line-number="18"></a>
<a class="sourceLine" id="cb128-19" data-line-number="19">my.seqs =<span class="st"> </span>seqs[s]</a>
<a class="sourceLine" id="cb128-20" data-line-number="20"><span class="kw">nchar</span>(my.seqs) <span class="co">## note the sequences all have same number of bases.</span></a></code></pre></div>
<pre><code>##  [1] 16568 16568 16568 16568 16568 16568 16568 16568 16568 16568 16568 16568 16568 16568 16568 16568 16568 16568 16568 16568</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1"><span class="co">## now put the bases in a matrix, with each column an indiviual and</span></a>
<a class="sourceLine" id="cb130-2" data-line-number="2"><span class="co">## each row a base.</span></a>
<a class="sourceLine" id="cb130-3" data-line-number="3">my.list &lt;-<span class="st"> </span><span class="kw">strsplit</span>(my.seqs, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb130-4" data-line-number="4">A &lt;-<span class="st"> </span><span class="kw">do.call</span>(cbind, my.list)</a>
<a class="sourceLine" id="cb130-5" data-line-number="5"><span class="kw">dim</span>(A)</a></code></pre></div>
<pre><code>## [1] 16568    20</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1"><span class="co">## coding region sequences, 576-16023 (according to &quot;Tree construction</span></a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="co">## and haplogroup prediction&quot; section, but not clear if this was used for</span></a>
<a class="sourceLine" id="cb132-3" data-line-number="3"><span class="co">## Intrapopulation diversity</span></a>
<a class="sourceLine" id="cb132-4" data-line-number="4">B &lt;-<span class="st"> </span>A[<span class="dv">576</span><span class="op">:</span><span class="dv">16023</span>,]</a>
<a class="sourceLine" id="cb132-5" data-line-number="5">haps &lt;-<span class="st"> </span>seqs</a></code></pre></div>
<p>Let’s inspect just a bit of one of these sequences</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">nchar</span>(haps[<span class="dv">213</span>]))</a></code></pre></div>
<pre><code>## [1] 16568</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">a_segment =<span class="st"> </span><span class="kw">substr</span>(haps[<span class="dv">213</span>], <span class="dv">1</span>, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb135-2" data-line-number="2"><span class="kw">print</span>(a_segment)</a></code></pre></div>
<pre><code>## [1] &quot;GATCACAGGTCTATCACCCTATTAACCACTCACGGGAGCTCTCCATGCATTTGGTATTTTCGTCTGGGGGGTGTGCACGCGATAGCATTGCGAGACGCTG&quot;</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="co">## tip: don&#39;t try to print the 16,000 character whole string. it will clog up your computer.</span></a></code></pre></div>
<p>Let’s put the haps in a matrix</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1">my.list &lt;-<span class="st"> </span><span class="kw">strsplit</span>(haps, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb138-2" data-line-number="2">H &lt;-<span class="st"> </span><span class="kw">do.call</span>(cbind, my.list)</a>
<a class="sourceLine" id="cb138-3" data-line-number="3"><span class="kw">print</span>(H[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]) <span class="co">## all the same</span></a></code></pre></div>
<pre><code>##       [,1] [,2] [,3] [,4]
##  [1,] &quot;G&quot;  &quot;G&quot;  &quot;G&quot;  &quot;G&quot; 
##  [2,] &quot;A&quot;  &quot;A&quot;  &quot;A&quot;  &quot;A&quot; 
##  [3,] &quot;T&quot;  &quot;T&quot;  &quot;T&quot;  &quot;T&quot; 
##  [4,] &quot;C&quot;  &quot;C&quot;  &quot;C&quot;  &quot;C&quot; 
##  [5,] &quot;A&quot;  &quot;A&quot;  &quot;A&quot;  &quot;A&quot; 
##  [6,] &quot;C&quot;  &quot;C&quot;  &quot;C&quot;  &quot;C&quot; 
##  [7,] &quot;A&quot;  &quot;A&quot;  &quot;A&quot;  &quot;A&quot; 
##  [8,] &quot;G&quot;  &quot;G&quot;  &quot;G&quot;  &quot;G&quot; 
##  [9,] &quot;G&quot;  &quot;G&quot;  &quot;G&quot;  &quot;G&quot; 
## [10,] &quot;T&quot;  &quot;T&quot;  &quot;T&quot;  &quot;T&quot;</code></pre>
<p>Let’s find a site where there’s polymorphism</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1">hap1 =<span class="st"> </span>H[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb140-2" data-line-number="2">hap2 =<span class="st"> </span>H[,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb140-3" data-line-number="3">s &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="kw">which</span>(hap1 <span class="op">!=</span><span class="st"> </span>hap2))</a>
<a class="sourceLine" id="cb140-4" data-line-number="4"><span class="kw">head</span>(H[s <span class="op">+</span><span class="st"> </span><span class="dv">-2</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]) <span class="co">## the polymorphic site in context</span></a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,] &quot;T&quot;  &quot;T&quot;  &quot;T&quot;  &quot;T&quot; 
## [2,] &quot;A&quot;  &quot;A&quot;  &quot;A&quot;  &quot;A&quot; 
## [3,] &quot;A&quot;  &quot;G&quot;  &quot;G&quot;  &quot;G&quot; 
## [4,] &quot;G&quot;  &quot;G&quot;  &quot;G&quot;  &quot;G&quot; 
## [5,] &quot;A&quot;  &quot;A&quot;  &quot;A&quot;  &quot;A&quot;</code></pre>
<p>Let’s see if that’s hap1 is the only “A”</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1"><span class="kw">table</span>(H[s,])</a></code></pre></div>
<pre><code>## 
##   A   G 
##  19 361</code></pre>
<p>We see that there are 19 individuals with this “A” instead of “G”.</p>
<blockquote>
<p>Q: How many pairwise differences in total are there between hap1 and
hap2?</p>
</blockquote>
<p>These are the kind of comparisons <em>we</em> will be doing.</p>
</div>
</div>
<div id="ancient-population-estimates" class="section level3">
<h3><span class="header-section-number">10.9.2</span> Ancient population estimates</h3>
<p>Let’s look at Figure 2 on page 5.</p>
<blockquote>
<p>Q. What was effective population size in Ireland 1 thousand years ago
(according to mtDNA)?</p>
</blockquote>
<blockquote>
<p>Q. What was effective population size in Ireland 50 thousand years ago
(according to mtDNA)?</p>
</blockquote>
<blockquote>
<p>Q. For the “Irish”, what is the annual population growth rate? What’s the NRR?</p>
</blockquote>
<p>The order of magnitude for each these populations appears to be about 10^4
in last few KYA and 10^3 50 KYA. Together, perhaps the size is 10
fold. So we’re looking at European effective population sizes on the
order of 100,000 the last few thousand years and on the order of
10,000 tens of thousands of years ago.</p>
<div id="using-the-coalescent-to-estimate-changing-population-size" class="section level4">
<h4><span class="header-section-number">10.9.2.1</span> Using the Coalescent to estimate changing population size</h4>
<p>Our procedure will involve a four steps:</p>
<ol style="list-style-type: decimal">
<li>Pick 100 <em>pairs</em> of people at random and count their pairwise differences.</li>
</ol>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb144-2" data-line-number="2">hap_ids =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(H)</a>
<a class="sourceLine" id="cb144-3" data-line-number="3">hap_id_sample =<span class="st"> </span><span class="kw">sample</span>(hap_ids,</a>
<a class="sourceLine" id="cb144-4" data-line-number="4">                       <span class="dt">size =</span> <span class="dv">200</span>,</a>
<a class="sourceLine" id="cb144-5" data-line-number="5">                       <span class="dt">replace =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb144-6" data-line-number="6"></a>
<a class="sourceLine" id="cb144-7" data-line-number="7">hap_id.mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(hap_id_sample, <span class="dv">100</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb144-8" data-line-number="8"></a>
<a class="sourceLine" id="cb144-9" data-line-number="9">pairwise_diff_fun &lt;-<span class="st"> </span><span class="cf">function</span>(hap1, hap2)</a>
<a class="sourceLine" id="cb144-10" data-line-number="10">{</a>
<a class="sourceLine" id="cb144-11" data-line-number="11">    h1 &lt;-<span class="st"> </span>hap1</a>
<a class="sourceLine" id="cb144-12" data-line-number="12">    h2 &lt;-<span class="st"> </span>hap2</a>
<a class="sourceLine" id="cb144-13" data-line-number="13"><span class="co">##    h1 &lt;- unlist(strsplit(hap1, &quot;&quot;))</span></a>
<a class="sourceLine" id="cb144-14" data-line-number="14"><span class="co">##    h2 &lt;- unlist(strsplit(hap2, &quot;&quot;))</span></a>
<a class="sourceLine" id="cb144-15" data-line-number="15">    h1[h1 <span class="op">==</span><span class="st"> &quot;N&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span> <span class="co">## note &quot;N&quot; means missing</span></a>
<a class="sourceLine" id="cb144-16" data-line-number="16">    h2[h2 <span class="op">==</span><span class="st"> &quot;N&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span> <span class="co">## making these NA avoids counting as polymorphism</span></a>
<a class="sourceLine" id="cb144-17" data-line-number="17">    k =<span class="st"> </span><span class="kw">sum</span>(h1 <span class="op">!=</span><span class="st"> </span>h2, <span class="dt">na.rm =</span> T)</a>
<a class="sourceLine" id="cb144-18" data-line-number="18">    n_valid =<span class="st"> </span><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(h1) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(h2))</a>
<a class="sourceLine" id="cb144-19" data-line-number="19">    <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">k =</span> k, <span class="dt">n_valid =</span> n_valid))</a>
<a class="sourceLine" id="cb144-20" data-line-number="20">}</a>
<a class="sourceLine" id="cb144-21" data-line-number="21"></a>
<a class="sourceLine" id="cb144-22" data-line-number="22"><span class="kw">pairwise_diff_fun</span>(H[,<span class="dv">1</span>], H[,<span class="dv">2</span>])</a></code></pre></div>
<pre><code>## $k
## [1] 45
## 
## $n_valid
## [1] 16565</code></pre>
<p>Now we’re ready to do pairwise comparisons of all 100 pairs of
haplotypes.</p>
<p>We’ll define the fraction of locii that have mutated (the pairwise differences) as
<span class="math display">\[
\bar{Y} = P/C
\]</span></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1">P.vec =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb146-2" data-line-number="2">C.vec =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb146-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(hap_id.mat))</a>
<a class="sourceLine" id="cb146-4" data-line-number="4">{</a>
<a class="sourceLine" id="cb146-5" data-line-number="5">    hap_id<span class="fl">.1</span> =<span class="st"> </span>hap_id.mat[i,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb146-6" data-line-number="6">    hap_id<span class="fl">.2</span> =<span class="st"> </span>hap_id.mat[i,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb146-7" data-line-number="7">    hap1 =<span class="st"> </span>H[,hap_id<span class="fl">.1</span>]</a>
<a class="sourceLine" id="cb146-8" data-line-number="8">    hap2 =<span class="st"> </span>H[,hap_id<span class="fl">.2</span>]</a>
<a class="sourceLine" id="cb146-9" data-line-number="9">    out =<span class="st"> </span><span class="kw">pairwise_diff_fun</span>(hap1, hap2)</a>
<a class="sourceLine" id="cb146-10" data-line-number="10">    P.vec[i] =<span class="st"> </span>out<span class="op">$</span>k</a>
<a class="sourceLine" id="cb146-11" data-line-number="11">    C.vec[i] =<span class="st"> </span>out<span class="op">$</span>n_valid</a>
<a class="sourceLine" id="cb146-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb146-13" data-line-number="13"></a>
<a class="sourceLine" id="cb146-14" data-line-number="14">Y.bar =<span class="st"> </span>P.vec<span class="op">/</span>C.vec</a>
<a class="sourceLine" id="cb146-15" data-line-number="15"><span class="kw">head</span>(P.vec)</a></code></pre></div>
<pre><code>## [1] 19 36 13 39  5 84</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1"><span class="kw">head</span>(C.vec)</a></code></pre></div>
<pre><code>## [1] 16566 16484 16539 16565 16565 16544</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1"><span class="kw">head</span>(Y.bar)</a></code></pre></div>
<pre><code>## [1] 0.0011469274 0.0021839359 0.0007860209 0.0023543616 0.0003018412 0.0050773694</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Estimate 100 different times of MRCA (<span class="math inline">\(T\)</span>) using assumed mutation rate.</li>
</ol>
<p>And now we’ll use the mutation rate <span class="math inline">\(\theta_m\)</span> given by Batini to
compute time back to MRCA.</p>
<p>First, some background:</p>
<p>Let <span class="math inline">\(a\)</span> index sites and write <span class="math inline">\(Y_a = 1\)</span> if the letters are different,
and $Y_a = 0 otherwise. For 1 site, the probability that it there has been a mutation, is 1
minus the chance that there has been no mutation.
$$
P( Y_a = 1 ) = 1 - e^{-T}</p>
<p><span class="math display">\[
The mean $\bar{Y}$ across the segment is the proportion of $Y_a$ that
equal 1. So, in expectation for the fraction of sites that mutate is
the same as the probability that 1 site mutates (assuming 
independence of mutation probabilities by site). This allows us to write
\]</span>
E{{Y}} = 1 - e^{-2T},
$$
where we’ve added a “2” in order to account that either one of the pairwise branched could have had a mutation, so we our “exposure” is twice the time to MRCA.</p>
<p>Rearranging we get an estimate $ of <span class="math inline">\(T\)</span> to be
<span class="math display">\[
\hat{T} = {-\log (1 - \bar{Y} ) \over \theta}
\]</span></p>
<p>Now we’re ready to estimate the MRCAs</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1">theta_m =<span class="st"> </span><span class="fl">2.21</span> <span class="op">*</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span>(<span class="op">-</span><span class="dv">8</span>) <span class="co">## Batini page 6 (TMRCA estimation)</span></a>
<a class="sourceLine" id="cb152-2" data-line-number="2">T.vec &lt;-<span class="st"> </span><span class="op">-</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>theta_m) <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Y.bar) <span class="co">## TMRCAs in years ago</span></a>
<a class="sourceLine" id="cb152-3" data-line-number="3"><span class="kw">head</span>(T.vec, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>##  [1]  25963.477  49464.349  17790.271  53328.902   6830.018 115165.228  56610.650  12294.775  21863.319  54701.270</code></pre>
<p>Let’s visualize these</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1"><span class="kw">hist</span>(T.vec)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-1.png" width="672" /></p>
<p>We see a lot of coalescence about 50 KYA, which is as far back as
Batini’s estimates go. This means the population was small back
then.</p>
<ol start="3" style="list-style-type: decimal">
<li>Estimate <span class="math inline">\(h(t)\)</span>, the time-varying hazard of coalescence</li>
</ol>
<p>We’ll do this in two ways. First we’ll compute the slope of the
logarithm of the survival curve, but we’ll see that it is noisy and
needs to be smoothed. Second, we’ll construct a “life table” of
coalescence with discrete periods of time.</p>
<p>Let’s start with the more continuous version of estimating slopes.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1"><span class="co">## Plot survival curve by order of T</span></a>
<a class="sourceLine" id="cb155-2" data-line-number="2">St =<span class="st"> </span>(<span class="dv">100</span><span class="op">:</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">100</span> <span class="co">## or more generally (length(T.vec):1)/length(T.vec)</span></a>
<a class="sourceLine" id="cb155-3" data-line-number="3">t =<span class="st"> </span>kya =<span class="st"> </span><span class="kw">sort</span>(T.vec)<span class="op">/</span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb155-4" data-line-number="4"><span class="kw">plot</span>(kya, St, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,</a>
<a class="sourceLine" id="cb155-5" data-line-number="5">     <span class="dt">xlab =</span> <span class="st">&quot;Kilo years ago&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Fraction of pairs without common ancestor&quot;</span>,</a>
<a class="sourceLine" id="cb155-6" data-line-number="6">     <span class="dt">main =</span> <span class="st">&quot;Estimated probability of not coalescing&quot;</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-130-1.png" width="672" /></p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1"><span class="kw">plot</span>(kya, <span class="kw">log</span>(St), <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,</a>
<a class="sourceLine" id="cb156-2" data-line-number="2">     <span class="dt">xlab =</span> <span class="st">&quot;Kilo years ago&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Log fraction of pairs without common ancestor&quot;</span>,</a>
<a class="sourceLine" id="cb156-3" data-line-number="3">     <span class="dt">main =</span> <span class="st">&quot;Etimatated probability of not coalescing, log scale&quot;</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-130-2.png" width="672" /></p>
<blockquote>
<p>Q: What is happening to slope in first from 1,000 to 50,000 years
ago?</p>
</blockquote>
<blockquote>
<p>Q: What does this imply about hazard of coalescence?</p>
</blockquote>
<blockquote>
<p>Q: What does this imply about effective population size?</p>
</blockquote>
<ul>
<li><ol style="list-style-type: lower-alpha">
<li>Estimating hazards from smoothed survival curve</li>
</ol></li>
</ul>
<p>First we smooth.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1">out =<span class="st"> </span><span class="kw">lowess</span>(<span class="dt">x =</span> kya, <span class="dt">y =</span> St, <span class="dt">f =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb157-2" data-line-number="2"></a>
<a class="sourceLine" id="cb157-3" data-line-number="3">St_smooth =<span class="st"> </span>out<span class="op">$</span>y</a>
<a class="sourceLine" id="cb157-4" data-line-number="4">kya_smooth =<span class="st"> </span>out<span class="op">$</span>x</a>
<a class="sourceLine" id="cb157-5" data-line-number="5"><span class="kw">plot</span>(kya, St, <span class="dt">cex =</span> <span class="fl">.5</span>)</a>
<a class="sourceLine" id="cb157-6" data-line-number="6"><span class="kw">lines</span>(kya_smooth, St_smooth, <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-131-1.png" width="672" /></p>
<blockquote>
<p>Q. Is f=1/5 a decent fit? Try a different value.</p>
</blockquote>
<p>Hazards as minus the slope of log</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1">haz_hat =<span class="st"> </span><span class="op">-</span><span class="kw">diff</span>(St_smooth)<span class="op">/</span><span class="kw">diff</span>(kya_smooth)</a>
<a class="sourceLine" id="cb158-2" data-line-number="2"><span class="kw">plot</span>(kya_smooth[<span class="op">-</span><span class="dv">1</span>], haz_hat, <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-132-1.png" width="672" /></p>
<blockquote>
<p>Q. Does this plot tell us anything about uncertainty?</p>
</blockquote>
<ul>
<li><ol start="2" style="list-style-type: lower-alpha">
<li>Life table appraoch</li>
</ol></li>
</ul>
<p>Now let’s estimate the hazards using a “life table”, where again
“death” is coalescence and “survival” is still not having a common
ancestor.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1"><span class="co">## we choose these time boundaries arbitrarily ... not sure if</span></a>
<a class="sourceLine" id="cb159-2" data-line-number="2"><span class="co">## we&#39;ll be able to see the &quot;expansion&quot; after ice age ...</span></a>
<a class="sourceLine" id="cb159-3" data-line-number="3"><span class="co">## x = c(0, 12,  20, 40, 65,  180 )*1000    # time interval boundaries</span></a>
<a class="sourceLine" id="cb159-4" data-line-number="4">x =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>,  <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">65</span>, <span class="dv">180</span>) <span class="op">*</span><span class="st"> </span><span class="dv">1000</span> <span class="co">## time interval boundaries</span></a></code></pre></div>
<p>Define a function to count “exposure” by those pairs that
have MRCA in time intervals</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1">get_nax &lt;-<span class="st"> </span><span class="cf">function</span>(Ti, x)</a>
<a class="sourceLine" id="cb160-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb160-3" data-line-number="3">    <span class="co">## get person years lived in interval by those who die</span></a>
<a class="sourceLine" id="cb160-4" data-line-number="4">    nax &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb160-5" data-line-number="5">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(x)<span class="op">-</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb160-6" data-line-number="6">    {</a>
<a class="sourceLine" id="cb160-7" data-line-number="7">        s &lt;-<span class="st"> </span>Ti <span class="op">&gt;=</span><span class="st"> </span>x[i] <span class="op">&amp;</span><span class="st"> </span>Ti <span class="op">&lt;</span><span class="st"> </span>x[i<span class="op">+</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb160-8" data-line-number="8">        <span class="cf">if</span> (<span class="kw">length</span>(Ti[s]) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb160-9" data-line-number="9">          nax[i] =<span class="st"> </span><span class="kw">mean</span>(Ti[s] <span class="op">-</span><span class="st"> </span>x[i])</a>
<a class="sourceLine" id="cb160-10" data-line-number="10">        }</a>
<a class="sourceLine" id="cb160-11" data-line-number="11">        nax[<span class="kw">is.na</span>(nax)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb160-12" data-line-number="12">    }</a>
<a class="sourceLine" id="cb160-13" data-line-number="13">    <span class="kw">return</span>(nax)</a>
<a class="sourceLine" id="cb160-14" data-line-number="14">}</a></code></pre></div>
<p>Construct the life table</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="kw">diff</span>(x)</a>
<a class="sourceLine" id="cb161-2" data-line-number="2">T.vec.by.cat &lt;-<span class="st"> </span><span class="kw">cut</span>(T.vec, x, <span class="dt">include.lowest =</span> T, <span class="dt">right =</span> F)</a>
<a class="sourceLine" id="cb161-3" data-line-number="3">ndx =<span class="st"> </span><span class="kw">table</span>(T.vec.by.cat)</a>
<a class="sourceLine" id="cb161-4" data-line-number="4">lx =<span class="st"> </span><span class="kw">rev</span>(<span class="kw">cumsum</span>(<span class="kw">rev</span>(ndx)))</a>
<a class="sourceLine" id="cb161-5" data-line-number="5">lxpn =<span class="st"> </span><span class="kw">c</span>(lx[<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb161-6" data-line-number="6">nax =<span class="st"> </span><span class="kw">get_nax</span>(<span class="dt">Ti =</span> T.vec, <span class="dt">x =</span> x)</a>
<a class="sourceLine" id="cb161-7" data-line-number="7">nLx =<span class="st"> </span>n<span class="op">*</span>lxpn <span class="op">+</span><span class="st"> </span>nax <span class="op">*</span><span class="st"> </span>ndx <span class="co">## exposure</span></a>
<a class="sourceLine" id="cb161-8" data-line-number="8">nmx =<span class="st"> </span>ndx<span class="op">/</span>nLx <span class="co">## hazard</span></a>
<a class="sourceLine" id="cb161-9" data-line-number="9">lt &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">x =</span> x[<span class="op">-</span><span class="kw">length</span>(x)], n, ndx, lx, nax, nLx, nmx)</a>
<a class="sourceLine" id="cb161-10" data-line-number="10"><span class="kw">print</span>(lt)</a></code></pre></div>
<pre><code>##                       x      n ndx  lx       nax      nLx          nmx
## [0,2e+03)             0   2000   0 100     0.000 200000.0 0.000000e+00
## [2e+03,5e+03)      2000   3000   0 100     0.000 300000.0 0.000000e+00
## [5e+03,1e+04)      5000   5000   3 100  3651.934 495955.8 6.048926e-06
## [1e+04,2e+04)     10000  10000   7  97  6416.957 944918.7 7.408045e-06
## [2e+04,3e+04)     20000  10000   7  90  3662.324 855636.3 8.181046e-06
## [3e+04,4e+04)     30000  10000  19  83  6798.251 769166.8 2.470206e-05
## [4e+04,6.5e+04)   40000  25000  54  64 11619.224 877438.1 6.154280e-05
## [6.5e+04,1.8e+05] 65000 115000  10  10 24611.455 246114.6 4.063149e-05</code></pre>
<p>Let’s compare the two estimates</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1">x.mid =<span class="st"> </span>x[<span class="op">-</span><span class="kw">length</span>(x)] <span class="op">+</span><span class="st"> </span>n<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb163-2" data-line-number="2"><span class="kw">plot</span>(x.mid, nmx, <span class="dt">type =</span> <span class="st">&#39;o&#39;</span>)</a>
<a class="sourceLine" id="cb163-3" data-line-number="3"><span class="kw">axis</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb163-4" data-line-number="4"><span class="kw">lines</span>(kya_smooth[<span class="op">-</span><span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>, haz_hat<span class="op">/</span><span class="dv">1000</span>, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-1.png" width="672" /></p>
<p>We’re getting basically the same thing, with a little more hint of
rising hazards (shrinking pop size) in first 20 kya. Nearly the same
thing estimate 40 kya ago, and very little signal before that.</p>
<ol start="4" style="list-style-type: decimal">
<li>Estimate the population size <span class="math inline">\(N_e(t)\)</span></li>
</ol>
<p>In order to estimate the population size, we have to think for a minute
about units.</p>
<p>Our hazards are per year, but our logic for why hazards are related to
population size is per generation. Remember, the chance of coalescence
<em>per generation</em> was <span class="math inline">\(1/N\)</span>. This means we will want to multiply the annual
hazard by generation length in order to get hazards per generation unit of time.</p>
<p>Second, mtDNA is inherited only through mothers. So the coalescent
that we are thinking of is only for women. And the effective
population size we’re estimating is for females only. We can get a rough estimate of
both sexes by doubling the number of females.</p>
<p>Putting these two considerations together, we have
<span class="math display">\[
\hat{N_e(both sexes)} = 2 \times {1 \over 25 \cdot h(t)},
\]</span>
where the 2 inflates to both sexes, and the 25 inflates the annual
hazard into geneations of 25 years in length.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1">Ne_smooth =<span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(haz_hat<span class="op">/</span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span><span class="dv">25</span>)</a>
<a class="sourceLine" id="cb164-2" data-line-number="2"></a>
<a class="sourceLine" id="cb164-3" data-line-number="3">Ne_lifetable =<span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(nmx <span class="op">*</span><span class="st"> </span><span class="dv">25</span>)</a>
<a class="sourceLine" id="cb164-4" data-line-number="4"></a>
<a class="sourceLine" id="cb164-5" data-line-number="5"><span class="co">## create step function for plotting</span></a>
<a class="sourceLine" id="cb164-6" data-line-number="6">Ne_lifetable_step =<span class="st"> </span><span class="kw">rep</span>(Ne_lifetable, n<span class="op">/</span><span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb164-7" data-line-number="7">kya_step =<span class="st"> </span><span class="dv">1</span><span class="op">:</span>(<span class="kw">max</span>(x)<span class="op">/</span><span class="dv">1000</span>)</a></code></pre></div>
<p>Plotting the results</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1"><span class="kw">plot</span>(kya_smooth[<span class="op">-</span><span class="dv">1</span>], Ne_smooth, <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">60000</span>), <span class="dt">log =</span> <span class="st">&#39;y&#39;</span>,</a>
<a class="sourceLine" id="cb165-2" data-line-number="2">     <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb165-3" data-line-number="3"><span class="kw">lines</span>(kya_step, Ne_lifetable_step, <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-138-1.png" width="672" /></p>
<p>Uncertainty</p>
<blockquote>
<p>Q. How could we evaluate undercertainty? (Hint: resampling)</p>
</blockquote>
<blockquote>
<p>Q. What does this estimate leave out?</p>
</blockquote>
<p>(We probably won’t do this in class. If we don’t give it a try at
home.)</p>
<p>Let’s loop through and do the whole estimation 40 times</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1">n_trials =<span class="st"> </span><span class="dv">40</span></a>
<a class="sourceLine" id="cb166-2" data-line-number="2">Ne.mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> n_trials, <span class="dt">ncol =</span> <span class="kw">max</span>(x)<span class="op">/</span><span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb166-3" data-line-number="3"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb166-4" data-line-number="4"><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_trials)</a>
<a class="sourceLine" id="cb166-5" data-line-number="5">{</a>
<a class="sourceLine" id="cb166-6" data-line-number="6">  <span class="co">#r = 1</span></a>
<a class="sourceLine" id="cb166-7" data-line-number="7">    <span class="kw">print</span>(r)</a>
<a class="sourceLine" id="cb166-8" data-line-number="8">    <span class="co">## sample</span></a>
<a class="sourceLine" id="cb166-9" data-line-number="9">    hap_id_sample =<span class="st"> </span><span class="kw">sample</span>(hap_ids,</a>
<a class="sourceLine" id="cb166-10" data-line-number="10">                           <span class="dt">size =</span> <span class="dv">200</span>,</a>
<a class="sourceLine" id="cb166-11" data-line-number="11">                           <span class="dt">replace =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb166-12" data-line-number="12">    hap_id.mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(hap_id_sample, <span class="dv">100</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb166-13" data-line-number="13">    <span class="co">## estimate MRCA distribution</span></a>
<a class="sourceLine" id="cb166-14" data-line-number="14">    P.vec =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb166-15" data-line-number="15">    C.vec =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb166-16" data-line-number="16">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(hap_id.mat))</a>
<a class="sourceLine" id="cb166-17" data-line-number="17">    {</a>
<a class="sourceLine" id="cb166-18" data-line-number="18">        hap_id<span class="fl">.1</span> =<span class="st"> </span>hap_id.mat[i,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb166-19" data-line-number="19">        hap_id<span class="fl">.2</span> =<span class="st"> </span>hap_id.mat[i,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb166-20" data-line-number="20">        hap1 =<span class="st"> </span>H[,hap_id<span class="fl">.1</span>]</a>
<a class="sourceLine" id="cb166-21" data-line-number="21">        hap2 =<span class="st"> </span>H[,hap_id<span class="fl">.2</span>]</a>
<a class="sourceLine" id="cb166-22" data-line-number="22">        out =<span class="st"> </span><span class="kw">pairwise_diff_fun</span>(hap1, hap2)</a>
<a class="sourceLine" id="cb166-23" data-line-number="23">        P.vec[i] =<span class="st"> </span>out<span class="op">$</span>k</a>
<a class="sourceLine" id="cb166-24" data-line-number="24">        C.vec[i] =<span class="st"> </span>out<span class="op">$</span>n_valid</a>
<a class="sourceLine" id="cb166-25" data-line-number="25">    }</a>
<a class="sourceLine" id="cb166-26" data-line-number="26">    Y.bar =<span class="st"> </span>P.vec<span class="op">/</span>C.vec</a>
<a class="sourceLine" id="cb166-27" data-line-number="27">    T.vec &lt;-<span class="st"> </span><span class="op">-</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>theta_m) <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Y.bar) <span class="co">## TMRCAs in years ago</span></a>
<a class="sourceLine" id="cb166-28" data-line-number="28">    <span class="co">## estimate Ne</span></a>
<a class="sourceLine" id="cb166-29" data-line-number="29">    T.vec.by.cat &lt;-<span class="st"> </span><span class="kw">cut</span>(T.vec, x, <span class="dt">include.lowest =</span> T, <span class="dt">right =</span> F)</a>
<a class="sourceLine" id="cb166-30" data-line-number="30">    ndx =<span class="st"> </span><span class="kw">table</span>(T.vec.by.cat)</a>
<a class="sourceLine" id="cb166-31" data-line-number="31">    lx =<span class="st"> </span><span class="kw">rev</span>(<span class="kw">cumsum</span>(<span class="kw">rev</span>(ndx)))</a>
<a class="sourceLine" id="cb166-32" data-line-number="32">    lxpn =<span class="st"> </span><span class="kw">c</span>(lx[<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb166-33" data-line-number="33">    nax =<span class="st"> </span><span class="kw">get_nax</span>(<span class="dt">Ti =</span> T.vec, <span class="dt">x =</span> x)</a>
<a class="sourceLine" id="cb166-34" data-line-number="34">    nLx =<span class="st"> </span>n<span class="op">*</span>lxpn <span class="op">+</span><span class="st"> </span>nax <span class="op">*</span><span class="st"> </span>ndx <span class="co">## exposure</span></a>
<a class="sourceLine" id="cb166-35" data-line-number="35">    nmx =<span class="st"> </span>ndx<span class="op">/</span>nLx <span class="co">## hazard</span></a>
<a class="sourceLine" id="cb166-36" data-line-number="36">    Ne_lifetable =<span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(nmx <span class="op">*</span><span class="st"> </span><span class="dv">25</span>)</a>
<a class="sourceLine" id="cb166-37" data-line-number="37">    <span class="co">## create step function for plotting</span></a>
<a class="sourceLine" id="cb166-38" data-line-number="38">    Ne_lifetable_step =<span class="st"> </span><span class="kw">rep</span>(Ne_lifetable, n<span class="op">/</span><span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb166-39" data-line-number="39">    kya_step =<span class="st"> </span><span class="dv">1</span><span class="op">:</span>(<span class="kw">max</span>(x)<span class="op">/</span><span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb166-40" data-line-number="40">    <span class="co">## save result</span></a>
<a class="sourceLine" id="cb166-41" data-line-number="41">    Ne.mat[r,] &lt;-<span class="st"> </span>Ne_lifetable_step</a>
<a class="sourceLine" id="cb166-42" data-line-number="42">}</a></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10
## [1] 11
## [1] 12
## [1] 13
## [1] 14
## [1] 15
## [1] 16
## [1] 17
## [1] 18
## [1] 19
## [1] 20
## [1] 21
## [1] 22
## [1] 23
## [1] 24
## [1] 25
## [1] 26
## [1] 27
## [1] 28
## [1] 29
## [1] 30
## [1] 31
## [1] 32
## [1] 33
## [1] 34
## [1] 35
## [1] 36
## [1] 37
## [1] 38
## [1] 39
## [1] 40</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1">Ne.interval &lt;-<span class="st"> </span><span class="kw">apply</span>(Ne.mat, <span class="dv">2</span>, quantile, <span class="kw">c</span>(.<span class="dv">1</span>,.<span class="dv">5</span>, <span class="fl">.9</span>))</a>
<a class="sourceLine" id="cb168-2" data-line-number="2"><span class="kw">matplot</span>(<span class="kw">t</span>(Ne.interval), <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">log =</span> <span class="st">&#39;y&#39;</span>, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb168-3" data-line-number="3"><span class="kw">lines</span>(Ne.interval[<span class="st">&quot;50%&quot;</span>,], <span class="dt">lwd =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-139-1.png" width="672" /></p>
<p>So it seems fairly clear that effective population size has been
growing the last 50 thousand years, from a low of a few thousand to a
few tens of thousand.</p>
<p>The general trend in growth is consistent with Batini but</p>
<ul>
<li><p>Our total population size seems smaller by a factor of about 4 or 5.</p></li>
<li><p>We don’t have the resolution to see increase between 10 and 20 kya,
the end of the Last Glacial Maximum or the more recent Bronze Age
steppe expansion 2 to 5 kya.</p></li>
</ul>
<p>In order to get more resolution and study sub-group differences, we
would want to turn to methods that do more than pair-wise comparisons,
giving us more detailed information about the effective population
sizes of the past.</p>
</div>
</div>
</div>
<div id="some-exercises" class="section level2">
<h2><span class="header-section-number">10.10</span> Some exercises</h2>
<ol style="list-style-type: decimal">
<li><p>Try doing 150 pairwise comparisons (instead of 100) and see what
happens.</p></li>
<li><p>Try doing 50 pairwise comparisons (instead of 100) and see what
happens.</p></li>
<li><p>Try changing the interval sizes (or the smoothing parameter) to see
if you can see either the post-glaciation population increase or
the Bronze Age increase? (I don’t know if it’s possible with our
methods.)</p></li>
<li><p><em>possible term project</em> Figure out how to use BEAST or some other software and
reproduce their results for one sub-population and tell us what you learned.</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fisher-wright.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="student-presentations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/09-coalescent.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
